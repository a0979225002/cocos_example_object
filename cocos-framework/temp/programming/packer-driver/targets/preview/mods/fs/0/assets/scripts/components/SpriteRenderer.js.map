{"version":3,"sources":["file:///D:/My_Game/%E5%88%A5%E4%BA%BA%E5%AF%AB%E7%9A%84%E5%8F%83%E8%80%83%E7%94%A8/cocos-framework/assets/scripts/components/SpriteRenderer.ts"],"names":["find","UITransform","Vec2","Vec3","SpriteRenderer","getbounds","_areBoundsDirty","_sprite","spriteFrame","_bounds","calculateBounds","entity","transform","position","_localOffset","_origin","scale","rotation","getwidth","getheight","ui_transform","getComponent","width","height","setOrigin","origin","equals","sprite","es","Vector2","setSprite","onAddedToEntity","node","parent","addChild","onRemovedFromEntity","removeFromParent","destroy","uiTransform","originPoint","anchorPoint","newOrigin","x","y","onEntityTransformChanged","comp","ComponentTransform","setPosition","setRotationFromEuler","rotationDegrees","setScale","render","batcher","camera","value","originNormalized","RenderableComponent"],"mappings":"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","sourcesContent":["import { find, Graphics, Size, Sprite, UITransform, utils, Vec2, Vec3 } from \"cc\";\r\nimport { Batcher } from \"../graphics/Batcher\";\r\nimport { SceneEmitType, RenderScene } from \"../scenes/RenderScene\";\r\nimport { component_camera } from \"./component_camera\";\r\n\r\nexport class SpriteRenderer extends es.RenderableComponent {\r\n    public getbounds() {\r\n        if (this._areBoundsDirty) {\r\n            if (this._sprite.spriteFrame != null) {\r\n                this._bounds.calculateBounds(this.entity.transform.position, this._localOffset, this._origin,\r\n                    this.entity.transform.scale, this.entity.transform.rotation,\r\n                    this.getwidth(), this.getheight());\r\n            }\r\n            this._areBoundsDirty = false;\r\n        }\r\n\r\n        return this._bounds;\r\n    }\r\n\r\n    public getwidth() {\r\n        const ui_transform = this._sprite.getComponent(UITransform);\r\n        if (!ui_transform)\r\n            return 0;\r\n\r\n        return ui_transform.width;\r\n    }\r\n\r\n    public getheight() {\r\n        const ui_transform = this._sprite.getComponent(UITransform);\r\n        if (!ui_transform)\r\n            return 0;\r\n\r\n        return ui_transform.height;\r\n    }\r\n\r\n    public get origin() {\r\n        return this._origin;\r\n    }\r\n    public set origin(value: es.Vector2) {\r\n        this.setOrigin(value);\r\n    }\r\n    public setOrigin(origin: es.Vector2) {\r\n        if (!this._origin.equals(origin)) {\r\n            this._origin = origin;\r\n            this._areBoundsDirty = true;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    public get sprite() {\r\n        return this._sprite;\r\n    }\r\n    public set sprite(value: Sprite) {\r\n        this.setSprite(value);\r\n    }\r\n\r\n    public get originNormalized() {\r\n        return new es.Vector2(this._origin.x / this.getwidth() * this.entity.transform.scale.x,\r\n            this._origin.y / this.getheight() * this.entity.transform.scale.y);\r\n    }\r\n    public set originNormalized(value: es.Vector2) {\r\n        this.setOrigin(new es.Vector2(value.x * this.getwidth() / this.entity.transform.scale.x,\r\n            value.y * this.getheight() / this.entity.transform.scale.y));\r\n\r\n        const ui_transform = this._sprite.getComponent(UITransform);\r\n        if (ui_transform) {\r\n            const originNormalized = new Vec2(value.x, value.y)\r\n            ui_transform.anchorPoint = originNormalized;\r\n        }\r\n    }\r\n\r\n    protected _origin: es.Vector2 = new es.Vector2();\r\n    protected _sprite!: Sprite;\r\n\r\n    constructor(sprite: Sprite) {\r\n        super();\r\n        this.setSprite(sprite);\r\n    }\r\n\r\n    onAddedToEntity() {\r\n        super.onAddedToEntity();\r\n        if (!this._sprite.node.parent) {\r\n            find('Canvas')?.addChild(this._sprite.node);\r\n        }\r\n    }\r\n\r\n    onRemovedFromEntity() {\r\n        super.onRemovedFromEntity();\r\n        this._sprite.node.removeFromParent();\r\n        this._sprite.node.destroy();\r\n    }\r\n\r\n    public setSprite(sprite: Sprite) {\r\n        this._sprite = sprite;\r\n        if (this._sprite != null) {\r\n            const uiTransform = this._sprite.getComponent(UITransform);\r\n            if (uiTransform) {\r\n                const originPoint = uiTransform.anchorPoint;\r\n                if (originPoint) {\r\n                    const scale = this.entity ? this.entity.transform.scale : this._sprite.node.scale;\r\n                    const newOrigin = new es.Vector2(originPoint.x * this.getwidth() / scale.x,\r\n                        originPoint.y * this.getheight() / scale.y);\r\n                    this._origin = newOrigin;\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    onEntityTransformChanged(comp: es.ComponentTransform) {\r\n        if (!this._sprite)\r\n            return;\r\n\r\n        switch (comp) {\r\n            case es.ComponentTransform.position:\r\n                this._sprite.node.setPosition(this.entity.position.x, this.entity.position.y, 0);\r\n                break;\r\n            case es.ComponentTransform.rotation:\r\n                this._sprite.node.setRotationFromEuler(0, 0, this.entity.rotationDegrees);\r\n                break;\r\n            case es.ComponentTransform.scale:\r\n                this._sprite.node.setScale(new Vec3(this.entity.scale.x, this.entity.scale.y, 1));\r\n                break;\r\n        }\r\n    }\r\n\r\n    public render(batcher: Batcher, camera: component_camera): void {\r\n\r\n    }\r\n}"]}