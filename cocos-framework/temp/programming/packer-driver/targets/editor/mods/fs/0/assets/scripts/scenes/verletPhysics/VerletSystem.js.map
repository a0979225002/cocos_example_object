{"version":3,"sources":["file:///D:/My_Game/%E5%88%A5%E4%BA%BA%E5%AF%AB%E7%9A%84%E5%8F%83%E8%80%83%E7%94%A8/cocos-framework/assets/scripts/scenes/verletPhysics/VerletSystem.ts"],"names":["VerletSystem","component_camera","Input","Keys","es","RenderableComponent","getwidth","getheight","constructor","world","VerletWorld","Rectangle","onHandleDrag","handleDragging","bind","pos","entity","scene","findEntity","getComponent","mouseToWorldPoint","leftMouseButtonPressed","_draggedParticle","getNearestParticle","leftMouseButtonDown","position","leftMouseButtonRelease","toggleZeroGravity","gravity","y","update","isKeyPressed","z","render","batcher","camera","debugRender"],"mappings":";;;6DAIaA,Y;;;;;;;;;;;;;;;;;;;;;;;;AAJJC,MAAAA,gB,iBAAAA,gB;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,I,iBAAAA,I;;;;;;;8BAEIH,Y,GAAN,MAAMA,YAAN,SAA2BI,EAAE,CAACC,mBAA9B,CAA2E;AACvEC,QAAAA,QAAQ,GAAG;AACd,iBAAO,GAAP;AACH;;AAEMC,QAAAA,SAAS,GAAG;AACf,iBAAO,GAAP;AACH;;AAIDC,QAAAA,WAAW,GAAG;AACV;;AADU;;AAGV,eAAKC,KAAL,GAAa,IAAIL,EAAE,CAACM,WAAP,CAAmB,IAAIN,EAAE,CAACO,SAAP,CAAiB,CAAC,KAAKL,QAAL,EAAD,GAAmB,CAApC,EAAuC,CAAC,KAAKC,SAAL,EAAD,GAAoB,CAA3D,EAA8D,KAAKD,QAAL,KAAkB,CAAhF,EAAmF,KAAKC,SAAL,KAAmB,CAAtG,CAAnB,CAAb;AACA,eAAKE,KAAL,CAAWG,YAAX,GAA0B,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAA1B;AACH;;AAEDD,QAAAA,cAAc,GAAG;AACb,cAAIE,GAAG,GAAI,KAAKC,MAAL,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6B,QAA7B,EAAuCC,YAAvC;AAAA;AAAA,oDAAsEC,iBAAtE,EAAX;;AACA,cAAI;AAAA;AAAA,8BAAMC,sBAAV,EAAkC;AAC9B,iBAAKZ,KAAL,CAAWa,gBAAX,GAA8B,KAAKb,KAAL,CAAWc,kBAAX,CAA8BR,GAA9B,CAA9B;AACH,WAFD,MAEO,IAAG;AAAA;AAAA,8BAAMS,mBAAT,EAA8B;AACjC,gBAAI,KAAKf,KAAL,CAAWa,gBAAX,IAA+B,IAAnC,EAAyC;AACrC,mBAAKb,KAAL,CAAWa,gBAAX,CAA4BG,QAA5B,GAAuCV,GAAvC;AACH;AACJ,WAJM,MAIA,IAAG;AAAA;AAAA,8BAAMW,sBAAT,EAAiC;AACpC,gBAAI,KAAKjB,KAAL,CAAWa,gBAAX,IAA+B,IAAnC,EACI,KAAKb,KAAL,CAAWa,gBAAX,CAA4BG,QAA5B,GAAuCV,GAAvC;AACH,iBAAKN,KAAL,CAAWa,gBAAZ,GAAuC,IAAvC;AACH;AACJ;;AAEDK,QAAAA,iBAAiB,GAAG;AAChB,cAAI,KAAKlB,KAAL,CAAWmB,OAAX,CAAmBC,CAAnB,IAAwB,CAA5B,EAA+B;AAC3B,iBAAKpB,KAAL,CAAWmB,OAAX,CAAmBC,CAAnB,GAAuB,CAAC,GAAxB;AACH,WAFD,MAEO;AACH,iBAAKpB,KAAL,CAAWmB,OAAX,CAAmBC,CAAnB,GAAuB,CAAvB;AACH;AACJ;;AAEDC,QAAAA,MAAM,GAAG;AACL,cAAI;AAAA;AAAA,8BAAMC,YAAN,CAAmB;AAAA;AAAA,4BAAKC,CAAxB,CAAJ,EACI,KAAKL,iBAAL;AAEJ,eAAKlB,KAAL,CAAWqB,MAAX;AACH;;AAEDG,QAAAA,MAAM,CAACC,OAAD,EAAuBC,MAAvB,EAAiD;AACnD,eAAK1B,KAAL,CAAW2B,WAAX,CAAuBF,OAAvB;AACH;;AAlD6E,O","sourcesContent":["import { component_camera } from \"../../components/component_camera\";\r\nimport { Input } from \"../../Input/Input\";\r\nimport { Keys } from \"../../Input/Keys\";\r\n\r\nexport class VerletSystem extends es.RenderableComponent implements es.IUpdatable {\r\n    public getwidth() {\r\n        return 960;\r\n    }\r\n\r\n    public getheight() {\r\n        return 640;\r\n    }\r\n\r\n    public world: es.VerletWorld;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.world = new es.VerletWorld(new es.Rectangle(-this.getwidth() / 2, -this.getheight() / 2, this.getwidth() / 2, this.getheight() / 2));\r\n        this.world.onHandleDrag = this.handleDragging.bind(this);\r\n    }\r\n\r\n    handleDragging() {\r\n        let pos =  this.entity.scene.findEntity('camera').getComponent(component_camera).mouseToWorldPoint();\r\n        if (Input.leftMouseButtonPressed) {\r\n            this.world._draggedParticle = this.world.getNearestParticle(pos);\r\n        } else if(Input.leftMouseButtonDown) {\r\n            if (this.world._draggedParticle != null) {\r\n                this.world._draggedParticle.position = pos;\r\n            }\r\n        } else if(Input.leftMouseButtonRelease) {\r\n            if (this.world._draggedParticle != null)\r\n                this.world._draggedParticle.position = pos;\r\n            (this.world._draggedParticle as any) = null;\r\n        }\r\n    }\r\n\r\n    toggleZeroGravity() {\r\n        if (this.world.gravity.y == 0) {\r\n            this.world.gravity.y = -980;\r\n        } else {\r\n            this.world.gravity.y = 0;\r\n        }\r\n    }\r\n\r\n    update() {\r\n        if (Input.isKeyPressed(Keys.z))\r\n            this.toggleZeroGravity();\r\n\r\n        this.world.update();\r\n    }\r\n\r\n    render(batcher: es.IBatcher, camera: es.ICamera): void {\r\n        this.world.debugRender(batcher);\r\n    }\r\n}"]}