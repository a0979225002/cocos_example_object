{"version":3,"sources":["file:///D:/My_Game/%E5%88%A5%E4%BA%BA%E5%AF%AB%E7%9A%84%E5%8F%83%E8%80%83%E7%94%A8/cocos-framework/assets/scripts/components/SpriteRenderer.ts"],"names":["SpriteRenderer","find","UITransform","Vec2","Vec3","es","RenderableComponent","getbounds","_areBoundsDirty","_sprite","spriteFrame","_bounds","calculateBounds","entity","transform","position","_localOffset","_origin","scale","rotation","getwidth","getheight","ui_transform","getComponent","width","height","origin","value","setOrigin","equals","sprite","setSprite","originNormalized","Vector2","x","y","anchorPoint","constructor","onAddedToEntity","node","parent","addChild","onRemovedFromEntity","removeFromParent","destroy","uiTransform","originPoint","newOrigin","onEntityTransformChanged","comp","ComponentTransform","setPosition","setRotationFromEuler","rotationDegrees","setScale","render","batcher","camera"],"mappings":"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","sourcesContent":["import { find, Graphics, Size, Sprite, UITransform, utils, Vec2, Vec3 } from \"cc\";\r\nimport { Batcher } from \"../graphics/Batcher\";\r\nimport { SceneEmitType, RenderScene } from \"../scenes/RenderScene\";\r\nimport { component_camera } from \"./component_camera\";\r\n\r\nexport class SpriteRenderer extends es.RenderableComponent {\r\n    public getbounds() {\r\n        if (this._areBoundsDirty) {\r\n            if (this._sprite.spriteFrame != null) {\r\n                this._bounds.calculateBounds(this.entity.transform.position, this._localOffset, this._origin,\r\n                    this.entity.transform.scale, this.entity.transform.rotation,\r\n                    this.getwidth(), this.getheight());\r\n            }\r\n            this._areBoundsDirty = false;\r\n        }\r\n\r\n        return this._bounds;\r\n    }\r\n\r\n    public getwidth() {\r\n        const ui_transform = this._sprite.getComponent(UITransform);\r\n        if (!ui_transform)\r\n            return 0;\r\n\r\n        return ui_transform.width;\r\n    }\r\n\r\n    public getheight() {\r\n        const ui_transform = this._sprite.getComponent(UITransform);\r\n        if (!ui_transform)\r\n            return 0;\r\n\r\n        return ui_transform.height;\r\n    }\r\n\r\n    public get origin() {\r\n        return this._origin;\r\n    }\r\n    public set origin(value: es.Vector2) {\r\n        this.setOrigin(value);\r\n    }\r\n    public setOrigin(origin: es.Vector2) {\r\n        if (!this._origin.equals(origin)) {\r\n            this._origin = origin;\r\n            this._areBoundsDirty = true;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    public get sprite() {\r\n        return this._sprite;\r\n    }\r\n    public set sprite(value: Sprite) {\r\n        this.setSprite(value);\r\n    }\r\n\r\n    public get originNormalized() {\r\n        return new es.Vector2(this._origin.x / this.getwidth() * this.entity.transform.scale.x,\r\n            this._origin.y / this.getheight() * this.entity.transform.scale.y);\r\n    }\r\n    public set originNormalized(value: es.Vector2) {\r\n        this.setOrigin(new es.Vector2(value.x * this.getwidth() / this.entity.transform.scale.x,\r\n            value.y * this.getheight() / this.entity.transform.scale.y));\r\n\r\n        const ui_transform = this._sprite.getComponent(UITransform);\r\n        if (ui_transform) {\r\n            const originNormalized = new Vec2(value.x, value.y)\r\n            ui_transform.anchorPoint = originNormalized;\r\n        }\r\n    }\r\n\r\n    protected _origin: es.Vector2 = new es.Vector2();\r\n    protected _sprite!: Sprite;\r\n\r\n    constructor(sprite: Sprite) {\r\n        super();\r\n        this.setSprite(sprite);\r\n    }\r\n\r\n    onAddedToEntity() {\r\n        super.onAddedToEntity();\r\n        if (!this._sprite.node.parent) {\r\n            find('Canvas')?.addChild(this._sprite.node);\r\n        }\r\n    }\r\n\r\n    onRemovedFromEntity() {\r\n        super.onRemovedFromEntity();\r\n        this._sprite.node.removeFromParent();\r\n        this._sprite.node.destroy();\r\n    }\r\n\r\n    public setSprite(sprite: Sprite) {\r\n        this._sprite = sprite;\r\n        if (this._sprite != null) {\r\n            const uiTransform = this._sprite.getComponent(UITransform);\r\n            if (uiTransform) {\r\n                const originPoint = uiTransform.anchorPoint;\r\n                if (originPoint) {\r\n                    const scale = this.entity ? this.entity.transform.scale : this._sprite.node.scale;\r\n                    const newOrigin = new es.Vector2(originPoint.x * this.getwidth() / scale.x,\r\n                        originPoint.y * this.getheight() / scale.y);\r\n                    this._origin = newOrigin;\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    onEntityTransformChanged(comp: es.ComponentTransform) {\r\n        if (!this._sprite)\r\n            return;\r\n\r\n        switch (comp) {\r\n            case es.ComponentTransform.position:\r\n                this._sprite.node.setPosition(this.entity.position.x, this.entity.position.y, 0);\r\n                break;\r\n            case es.ComponentTransform.rotation:\r\n                this._sprite.node.setRotationFromEuler(0, 0, this.entity.rotationDegrees);\r\n                break;\r\n            case es.ComponentTransform.scale:\r\n                this._sprite.node.setScale(new Vec3(this.entity.scale.x, this.entity.scale.y, 1));\r\n                break;\r\n        }\r\n    }\r\n\r\n    public render(batcher: Batcher, camera: component_camera): void {\r\n\r\n    }\r\n}"]}