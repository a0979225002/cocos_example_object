{"version":3,"sources":["file:///D:/My_Game/%E5%88%A5%E4%BA%BA%E5%AF%AB%E7%9A%84%E5%8F%83%E8%80%83%E7%94%A8/cocos-framework/assets/scripts/scenes/verletPhysics/VerletPhysicsScene.ts"],"names":["instantiate","Prefab","resources","Sprite","SpriteRenderer","RenderScene","sampleScene","VerletSystem","VerletPhysicsScene","initialize","verletSystem","createEntity","addComponent","createPolygons","createRope","world","addComposite","es","Tire","Vector2","Cloth","Ragdoll","RandomUtils","randint","Ball","circleEntity","load","err","data","moonTex","getComponent","setPosition","CircleCollider","linePoints","i","line","LineSegments","pinParticleAtIndex","update","Core","emitter","emit","CoreEvents","renderChanged","Time","deltaTime"],"mappings":"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","sourcesContent":["import { instantiate, Prefab, resources, Sprite } from \"cc\";\r\nimport { PolygonMesh } from \"../../components/PolygonMesh\";\r\nimport { PolygonSprite } from \"../../components/PolygonSprite\";\r\nimport { SpriteRenderer } from \"../../components/SpriteRenderer\";\r\nimport { RenderScene, sampleScene } from \"../RenderScene\";\r\nimport { VerletSystem } from \"./VerletSystem\";\r\n\r\n@sampleScene(\"Verlet Physics\")\r\nexport class VerletPhysicsScene extends RenderScene {\r\n    initialize() {\r\n        const verletSystem = this.createEntity(\"verlet-system\")\r\n            .addComponent(new VerletSystem());\r\n\r\n        this.createPolygons();\r\n\r\n        this.createRope(verletSystem.world);\r\n\r\n        verletSystem.world.addComposite(new es.Tire(new es.Vector2(175, 32), 64, 32, 0.3, 0.5));\r\n        verletSystem.world.addComposite(new es.Tire(new es.Vector2(300, 16), 50, 4, 0.2, 0.7));\r\n        verletSystem.world.addComposite(new es.Tire(new es.Vector2(450, 64), 64, 7, 0.1, 0.3));\r\n\r\n        verletSystem.world.addComposite(new es.Cloth(new es.Vector2(200, 200), 200, 200, 20, 0.25, 50));\r\n\r\n        verletSystem.world.addComposite(new es.Ragdoll(200, 20, es.RandomUtils.randint(140, 240)));\r\n        verletSystem.world.addComposite(new es.Ragdoll(250, 20, es.RandomUtils.randint(140, 240)));\r\n        verletSystem.world.addComposite(new es.Ragdoll(300, 20, es.RandomUtils.randint(140, 240)));\r\n\r\n        verletSystem.world.addComposite(new es.Ball(new es.Vector2(100, 60), es.RandomUtils.randint(10, 50)));\r\n        verletSystem.world.addComposite(new es.Ball(new es.Vector2(150, 60), es.RandomUtils.randint(10, 50)));\r\n        verletSystem.world.addComposite(new es.Ball(new es.Vector2(200, 60), es.RandomUtils.randint(10, 50)));\r\n    }\r\n\r\n    createPolygons() {\r\n        // const trianglePoints: es.Vector2[] = [new es.Vector2(0, 0), new es.Vector2(128, 0), new es.Vector2(128, 128)];\r\n        // const triangleEntity = this.createEntity(\"triangle\");\r\n\r\n        // resources.load('prefabs/moon_polygon', Prefab, (err, data) => {\r\n        //     let moonTex = instantiate(data).getComponent(PolygonSprite)!;\r\n        //     triangleEntity.setPosition(50, 150);\r\n        //     triangleEntity.addComponent(new PolygonMesh(trianglePoints, false)).setColor(es.Color.Green).setTexture(moonTex);\r\n        //     triangleEntity.addComponent(new es.PolygonCollider(trianglePoints));\r\n        // });\r\n\r\n        const circleEntity = this.createEntity(\"circle\");\r\n        resources.load('prefabs/moon', Prefab, (err, data) => {\r\n            let moonTex = instantiate(data).getComponent(Sprite);\r\n            if (moonTex) circleEntity.addComponent(new SpriteRenderer(moonTex));\r\n            circleEntity.setPosition(250, 60);\r\n            circleEntity.addComponent(new es.CircleCollider(64));\r\n        });\r\n\r\n\r\n        // const polyPoints = es.Polygon.buildSymmetricalPolygon(5, 140);\r\n        // const polygonEntity = this.createEntity(\"boxCollider\");\r\n        // resources.load('prefabs/moon_polygon', Prefab, (err, data) => {\r\n        //     let moonTex = instantiate(data).getComponent(PolygonSprite)!;\r\n        //     polygonEntity.setPosition(230, 225);\r\n        //     polygonEntity.addComponent(new PolygonMesh(polyPoints)).setColor(es.Color.Green).setTexture(moonTex);\r\n        //     polygonEntity.addComponent(new es.PolygonCollider(polyPoints));\r\n        // });\r\n\r\n        // polygonEntity.tweenRotationDegreesTo(180, 3)\r\n        //     .setLoops(es.LoopType.pingpong, 50)\r\n        //     .setEaseType(es.EaseType.linear)\r\n        //     .start();\r\n    }\r\n\r\n    createRope(world: es.VerletWorld) {\r\n        const linePoints = [];\r\n        for (var i = 0; i < 10; i++)\r\n            linePoints[i] = new es.Vector2(30 * i + 50, 10);\r\n\r\n        const line = new es.LineSegments(linePoints, 0.3)\r\n            .pinParticleAtIndex(0);\r\n        world.addComposite(line);\r\n    }\r\n\r\n    update() {\r\n        super.update();\r\n\r\n        es.Core.emitter.emit(es.CoreEvents.renderChanged, es.Time.deltaTime);\r\n    }\r\n}"]}