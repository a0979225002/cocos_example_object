{"version":3,"sources":["assets\\Scene\\Moving_ghost\\Moving_ghost.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAA0C,gCAAY;IAAtD;QAAA,qEA6CC;QA3CC,qBAAe,GAAgB,EAAE,CAAC;QAElC,UAAI,GAAY,IAAI,CAAC;QAErB,gBAAU,GAAc,IAAI,CAAC;;IAuC/B,CAAC;IArCC,6BAAM,GAAN;QACE,IAAM,UAAU,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC;QAE9B,IAAM,OAAO,GAAG,IAAI,EAAE,CAAC,aAAa,EAAE,CAAC;QACvC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACxD,IAAM,WAAW,GAAG,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;QACzC,WAAW,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QAChC,IAAI,CAAC,UAAU,CAAC,aAAa,GAAG,OAAO,CAAC;QACxC,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,UAAC,KAAK,EAAE,GAAG;YACtC,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YACvB,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,UAAU,GAAG,GAAG,CAAC;YACrC,KAAK,CAAC,IAAI,CAAC,OAAO,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE,CAAC;YACpC,KAAK,CAAC,WAAW,GAAG,WAAW,CAAC;QAClC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,EAAE,GAAG,EAAE,EAAE,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;QAC9D,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;IACxE,CAAC;IAED,qCAAc,GAAd,UAAe,GAAwB;QACrC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,GAAG,CAAC,SAAS,EAAE,CAAC;QAC/B,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,GAAG,CAAC,SAAS,EAAE,CAAC;IACjC,CAAC;IAED,oCAAa,GAAb;QACE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IACpC,CAAC;IAED,kCAAW,GAAX;QAAA,iBAOC;QANC,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,UAAC,KAAK,EAAE,CAAC;YACpC,IAAM,GAAG,GAAI,KAAK,CAAC,IAAI,CAAC,QAAgB,CAAC,GAAG,CAAC,KAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC;YACvE,IAAI,GAAG,GAAG,GAAG;gBAAE,OAAO,CAAC,2CAA2C;YAClE,KAAK,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;YAC5B,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,GAAG,IAAI,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7E,CAAC,CAAC,CAAC;IACL,CAAC;IA1CD;QADC,QAAQ,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;yDACY;IAElC;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;8CACG;IAErB;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;oDACS;IANV,YAAY;QADhC,OAAO;OACa,YAAY,CA6ChC;IAAD,mBAAC;CA7CD,AA6CC,CA7CyC,EAAE,CAAC,SAAS,GA6CrD;kBA7CoB,YAAY","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Moving_ghost extends cc.Component {\r\n  @property([cc.Sprite])\r\n  ghostCanvasList: cc.Sprite[] = [];\r\n  @property(cc.Node)\r\n  role: cc.Node = null;\r\n  @property(cc.Camera)\r\n  roleCamera: cc.Camera = null;\r\n\r\n  onLoad() {\r\n    const roleZindex = 10;\r\n    this.role.zIndex = roleZindex;\r\n\r\n    const texture = new cc.RenderTexture();\r\n    texture.initWithSize(this.node.width, this.node.height);\r\n    const spriteFrame = new cc.SpriteFrame();\r\n    spriteFrame.setTexture(texture);\r\n    this.roleCamera.targetTexture = texture;\r\n    this.ghostCanvasList.forEach((ghost, idx) => {\r\n      ghost.node.scaleY = -1;\r\n      ghost.node.zIndex = roleZindex - idx;\r\n      ghost.node.opacity = 100 - idx * 15;\r\n      ghost.spriteFrame = spriteFrame;\r\n    });\r\n\r\n    this.schedule(this.ghostFollow, 0.1, cc.macro.REPEAT_FOREVER);\r\n    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoveEvent, this);\r\n  }\r\n\r\n  touchMoveEvent(evt: cc.Event.EventTouch) {\r\n    this.role.x += evt.getDeltaX();\r\n    this.role.y += evt.getDeltaY();\r\n  }\r\n\r\n  beforeDestroy() {\r\n    this.unschedule(this.ghostFollow);\r\n  }\r\n\r\n  ghostFollow() {\r\n    this.ghostCanvasList.forEach((ghost, i) => {\r\n      const dis = (ghost.node.position as any).sub(this.role.position).mag();\r\n      if (dis < 0.5) return; // 给个误差范围，涉及到浮点数，dis的计算不可能精准，小于0.5就可以认为是静止了\r\n      ghost.node.stopAllActions();\r\n      ghost.node.runAction(cc.moveTo(i * 0.04 + 0.02, this.role.x, this.role.y));\r\n    });\r\n  }\r\n}\r\n"]}