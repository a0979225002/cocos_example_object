{"version":3,"sources":["assets\\Scene\\Joystick\\Joystick.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Roller extends cc.Component {\r\n  @property({ type: cc.Node, tooltip: '操控杆的控制点' })\r\n  controlDot: cc.Node = null;\r\n  @property({ type: cc.Node, tooltip: '操控杆' })\r\n  joystick: cc.Node = null;\r\n  @property(cc.Node)\r\n  movableStar: cc.Node = null;\r\n\r\n  movableFlag: boolean = false;\r\n  radian: number = 0;\r\n  speed: number = 150;\r\n  onLoad() {\r\n    this.initTouchEvent();\r\n  }\r\n\r\n  initTouchEvent() {\r\n    this.node.on(cc.Node.EventType.TOUCH_START, this.touchStartEvent, this);\r\n    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoveEvent, this);\r\n    this.node.on(cc.Node.EventType.TOUCH_END, this.touchEndEvent, this);\r\n    this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.touchEndEvent, this);\r\n  }\r\n\r\n  touchStartEvent(event) {\r\n    let touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\r\n    const distance = touchPos.len();\r\n    const radius = this.node.width / 2 - this.controlDot.width / 2;\r\n\r\n    // 以x轴正方向为基准，计算偏移量\r\n    this.radian = cc.v2(1, 0).signAngle(touchPos);\r\n    const offsetX = Math.cos(this.radian) * radius;\r\n    const offsetY = Math.sin(this.radian) * radius;\r\n    this.controlDot.setPosition(radius > distance ? touchPos : cc.v2(offsetX, offsetY));\r\n\r\n    this.movableFlag = true;\r\n  }\r\n\r\n  touchMoveEvent(event) {\r\n    let touchPos: cc.Vec2 = this.node.convertToNodeSpaceAR(event.getLocation());\r\n    const distance = touchPos.len();\r\n    const radius = this.node.width / 2 - this.controlDot.width / 2;\r\n\r\n    this.radian = cc.v2(1, 0).signAngle(touchPos);\r\n    const offsetX = Math.cos(this.radian) * radius;\r\n    const offsetY = Math.sin(this.radian) * radius;\r\n\r\n    this.controlDot.setPosition(radius > distance ? touchPos : cc.v2(offsetX, offsetY));\r\n  }\r\n\r\n  touchEndEvent() {\r\n    this.movableFlag = false;\r\n    this.controlDot.setPosition(cc.v2(0, 0));\r\n  }\r\n\r\n  update(dt) {\r\n    if (!this.movableFlag) return;\r\n    this.movableStar.x += Math.cos(this.radian) * dt * this.speed;\r\n    this.movableStar.y += Math.sin(this.radian) * dt * this.speed;\r\n  }\r\n}\r\n"]}