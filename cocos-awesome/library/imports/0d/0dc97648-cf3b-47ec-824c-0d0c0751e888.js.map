{"version":3,"sources":["assets\\Scene\\Moving_ghost\\Moving_ghost.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Moving_ghost extends cc.Component {\n  @property([cc.Sprite])\n  ghostCanvasList: cc.Sprite[] = [];\n  @property(cc.Node)\n  role: cc.Node = null;\n  @property(cc.Camera)\n  roleCamera: cc.Camera = null;\n\n  onLoad() {\n    const roleZindex = 10;\n    this.role.zIndex = roleZindex;\n\n    const texture = new cc.RenderTexture();\n    texture.initWithSize(this.node.width, this.node.height);\n    const spriteFrame = new cc.SpriteFrame();\n    spriteFrame.setTexture(texture);\n    this.roleCamera.targetTexture = texture;\n    this.ghostCanvasList.forEach((ghost, idx) => {\n      ghost.node.scaleY = -1;\n      ghost.node.zIndex = roleZindex - idx;\n      ghost.node.opacity = 100 - idx * 15;\n      ghost.spriteFrame = spriteFrame;\n    });\n\n    this.schedule(this.ghostFollow, 0.1, cc.macro.REPEAT_FOREVER);\n\n    fcc.eventMgr.eventListener(\"SCENE\",(isUpdate:boolean)=>{\n        cc.log(isUpdate)\n        if(isUpdate){\n            this.beforeDestroy();\n        }else {\n          const roleZindex = 10;\n          this.role.zIndex = roleZindex;\n          const texture = new cc.RenderTexture();\n          texture.initWithSize(this.node.width, this.node.height);\n          const spriteFrame = new cc.SpriteFrame();\n          spriteFrame.setTexture(texture);\n          this.roleCamera.targetTexture = texture;\n          this.ghostCanvasList.forEach((ghost, idx) => {\n            ghost.node.scaleY = -1;\n            ghost.node.zIndex = roleZindex - idx;\n            ghost.node.opacity = 100 - idx * 15;\n            ghost.spriteFrame = spriteFrame;\n          });\n          this.schedule(this.ghostFollow, 0.1, cc.macro.REPEAT_FOREVER);\n        }\n    },true)\n\n    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoveEvent, this);\n  }\n\n  touchMoveEvent(evt: cc.Event.EventTouch) {\n    this.role.x += evt.getDeltaX();\n    this.role.y += evt.getDeltaY();\n  }\n\n  beforeDestroy() {\n    this.unschedule(this.ghostFollow);\n  }\n\n  ghostFollow() {\n    this.ghostCanvasList.forEach((ghost, i) => {\n      const dis = (ghost.node.position as any).sub(this.role.position).mag();\n      if (dis < 0.5) return; // 给个误差范围，涉及到浮点数，dis的计算不可能精准，小于0.5就可以认为是静止了\n      ghost.node.stopAllActions();\n      ghost.node.runAction(cc.moveTo(i * 0.04 + 0.02, this.role.x, this.role.y));\n    });\n  }\n}\n"]}