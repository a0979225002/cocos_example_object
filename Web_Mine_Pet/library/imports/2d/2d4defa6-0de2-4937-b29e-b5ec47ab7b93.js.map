{"version":3,"sources":["assets\\script\\controllers\\ui\\UIMessage.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UIBase from \"./UIBase\";\r\nimport { Log } from \"../../common/Log\";\r\nimport DataUIMessage from \"../../data/scene/DataUIMessage\";\r\nimport LangMng from \"../../manager/LangMng\";\r\n\r\nconst { ccclass } = cc._decorator;\r\n\r\nenum PopType {\r\n    All,\r\n    Confirm,\r\n    None\r\n}\r\n\r\nexport interface DialogParams {\r\n    type: number,\r\n    content: string,\r\n    confirmCb?: Function,\r\n    cancelCb?: Function\r\n    canCover?: boolean,\r\n    autoClose?: boolean,\r\n}\r\n\r\n@ccclass\r\nexport default class UIMessage extends UIBase {\r\n\r\n    ui: DataUIMessage = null;\r\n\r\n    protected static prefabUrl = \"message_panel\";\r\n    protected static className = \"UIMessage\";\r\n\r\n    private _isLangSet: boolean = false;\r\n    private _type: number = PopType.None;\r\n    private _content: string;\r\n    private _confirmCb: Function;\r\n    private _cancelCb: Function;\r\n    private _canCover: boolean = true;\r\n    private _autoClose: boolean = false;\r\n    private _timer: number = null;\r\n    private _timerTime: number = 3000;\r\n\r\n\r\n    onInit(params): void {\r\n        cc.game.addPersistRootNode(this.node);\r\n    }\r\n\r\n    onUILoad(): void {\r\n        this.ui = this.node.addComponent(DataUIMessage);\r\n        this.resize();\r\n        this.hide(false);\r\n    }\r\n\r\n    onShow(): void {\r\n        this.onRegisterEvent(this.ui.btn_confirm, this.onConfirmClick, this);\r\n        this.onRegisterEvent(this.ui.btn_cancel, this.onCancelClick, this);\r\n        this.onRegisterEvent(this.ui.node_backBg, this.onBackBgClick, this);\r\n        this.setLang();\r\n    }\r\n\r\n    onHide(): void {\r\n        this.unRegisterEvent(this.ui.btn_cancel, this.onConfirmClick, this);\r\n        this.unRegisterEvent(this.ui.btn_cancel, this.onCancelClick, this);\r\n        this.unRegisterEvent(this.ui.node_backBg, this.onBackBgClick, this);\r\n        this._canCover = true;\r\n    }\r\n\r\n    onConfirmClick(): void {\r\n\r\n        if (this._confirmCb) {\r\n            this._confirmCb();\r\n        }\r\n\r\n        this.hide();\r\n\r\n    }\r\n\r\n    onCancelClick(): void {\r\n\r\n        if (this._cancelCb) {\r\n            this._cancelCb();\r\n        }\r\n\r\n        this.hide();\r\n\r\n    }\r\n\r\n    onBackBgClick(): void {\r\n        this.hide();\r\n    }\r\n\r\n    show(params): void {\r\n\r\n        if (params == undefined) {\r\n            return;\r\n        }\r\n\r\n        let data = params as DialogParams;\r\n        this._type = data.type;\r\n        this._content = data.content;\r\n        this._confirmCb = data.confirmCb;\r\n        this._cancelCb = data.cancelCb;\r\n\r\n        if (data.canCover != undefined) {\r\n            this._canCover = data.canCover;\r\n        }\r\n\r\n        if(!this._canCover && this.node.active) {\r\n            return;\r\n        }\r\n\r\n        if (data.autoClose != undefined) {\r\n            this._autoClose = data.autoClose;\r\n        }\r\n\r\n        if (this._autoClose) {\r\n            this._timer = setTimeout(() => {\r\n                this.hide();\r\n            }, this._timerTime);\r\n        }\r\n\r\n        this.node.active = true;\r\n        this.setIntroTxt();\r\n        this.setBtnsDisplay();\r\n        this.fadeIn();\r\n\r\n    }\r\n\r\n    hide(isAni: boolean = true) {\r\n\r\n        clearTimeout(this._timer);\r\n\r\n        if (!this.node.active) {\r\n            return;\r\n        }\r\n\r\n        if (isAni) {\r\n            this.fadeOut();\r\n            return;\r\n        }\r\n\r\n        this.node.active = false;\r\n\r\n    }\r\n\r\n    fadeIn(): void {\r\n        this.ui.node_main.opacity = 0;\r\n        this.ui.node_main.scale = 1.3;\r\n        this.ui.node_main.stopAllActions();\r\n        this.ui.node_main.runAction(cc.sequence(cc.spawn(\r\n            cc.fadeIn(.15),\r\n            cc.scaleTo(.2, 1).easing(cc.easeBackOut())\r\n            ),\r\n            cc.callFunc(() => {\r\n\r\n            })\r\n        ));\r\n    }\r\n\r\n\r\n    fadeOut(): void {\r\n        this.ui.node_main.stopAllActions();\r\n        this.ui.node_main.runAction(cc.sequence(\r\n            cc.fadeOut(.1),\r\n            cc.callFunc(() => {\r\n                this.node.active = false;\r\n            })\r\n        ));\r\n    }\r\n\r\n    setBtnsDisplay(): void {\r\n\r\n        switch (this._type) {\r\n            case PopType.Confirm:\r\n                this.setBtnCancelActive(false);\r\n                this.setBtnConfirmActive(true);\r\n                break;\r\n            case  PopType.None:\r\n                this.setBtnCancelActive(false);\r\n                this.setBtnConfirmActive(false);\r\n                break;\r\n            default:\r\n                this.setBtnCancelActive(true);\r\n                this.setBtnConfirmActive(true);\r\n        }\r\n\r\n    }\r\n\r\n    setBtnConfirmActive(state: boolean): void {\r\n        this.ui.btn_confirm.active = state;\r\n    }\r\n\r\n    setBtnCancelActive(state: boolean): void {\r\n        this.ui.btn_cancel.active = state;\r\n    }\r\n\r\n    setIntroTxt(): void {\r\n        this.ui.label_msg_txt.string = this._content;\r\n    }\r\n\r\n    setLang(): void {\r\n\r\n        if (this._isLangSet) {\r\n            return;\r\n        }\r\n\r\n        this.ui.label_confirm.string = LangMng.getTxt(\"P_1001\");\r\n        this.ui.label_cancel.string = LangMng.getTxt(\"P_1002\");\r\n\r\n        this._isLangSet = true;\r\n\r\n    }\r\n\r\n    resize(): void {\r\n        const pos = this.getCanvas();\r\n        this.node.setPosition(pos.x, pos.y);\r\n    }\r\n\r\n}"]}