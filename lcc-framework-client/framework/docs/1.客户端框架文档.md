# **lcc-framework客户端框架文档**

## **什么是lcc-framework框架？**

**lcc-framework**是专门为游戏开发引擎cocos creator设计的游戏开发框架，旨在帮助开发者更方便，更快速，模块化的开发单机或者网络游戏。该框架完整包含三个部分：
1. ### 客户端框架及配套cocos creator插件。
    **客户端框架**是基于多分包的模块化游戏内容组织框架，并且提供UI、场景、多语言、配置、数据表、网络等系列便利功能。**配套cocos creator插件**主要为客户端框架服务，提供分包代码声明文件生成、游戏发布时框架裁剪等功能。框架代码提供了非常细致的裁剪功能，可以自定义框架保留的模块，并且对于小型项目也提供自动裁剪功能，即使是小游戏也可以使用该框架。
2. ### 服务器框架及配套服务器发布与控制脚本。
    **服务器框架**是基于**客户端框架**开发的与之配套的框架，主要提供配置、数据库、日志、网络、数据表、工作者管理 等系列便利功能。服务器框架API和客户端框架API大部分一致，并且功能通用，比如网络模块是互通的，学习难度不会太高。**配套服务器发布与控制脚本**提供游戏服务器的发布与控制功能。当前游戏服务器使用typescript开发，在运行前是需要编译为javascript的，发布操作就是编译程序代码并且提取资源文件到发布目录。控制脚本可以控制多个服务器的启动和停止。
3. ### 原始资源配置与构建工具。
    **原始资源配置**用于在外部配置游戏数据，主要提供数据表Excel表、多语言Excel表、通信协议配置等系列功能。该功能主要提供给策划使用Excel表格配置游戏常量数据，提供给开发者配置客户端和服务器之间通信协议(服务器与服务器之间也可以使用这些通信协议)。**资源构建工具**主要编译**原始资源配置**为客户端和服务器需要的解析格式。

该框架的三部分也可以单独或者部分使用。比如`客户端框架及配套cocos creator插件` + `原始资源配置与资源构建工具`适用于纯单机游戏，`服务器框架及配套服务器发布与控制脚本` + `原始资源配置与资源构建工具`适用于独立服务器，完整三个部分一起适用于网络游戏。
<br/>

## **该文档仅介绍客户端框架内容**

如果你已经看过服务器框架，你会发现客户端框架有很多相同模块，这些模块功能与服务器框架完全一致。<br/>
`注意`：当前客户端框架使用typescript作为开发语言并且大量使用`async/await`同步语法，所以使用前需要对其比较熟悉。
<br/>

## **客户端框架安装**

当前客户端框架以cocos creator插件方式发布，安装需要以下步骤：<br/>
1. 安装当前客户端框架插件到cocos creator中。具体方式请查看[**Creator插件包**](https://docs.cocos.com/creator/manual/zh/extension/your-first-extension.html "Creator插件包")。<br/>
2. 由于插件是源码发布，所以需要在客户端框架插件目录执行`npm i`命令，以安装插件依赖。<br/>
3. 在cocos creator顶部菜单栏，依次点击`扩展 -> LCC框架 -> 导入或更新框架`，以导入客户端框架文件到项目中。
4. 在逻辑代码中初始化框架，最好是在初始场景的`start()`里面。如下：<br/>
    ```
        // 可选，配置框架的常量
        lcc.DEBUG.NETWORK = true;
        lcc.WEBSOCKET_HEARTTICK = 10;
        lcc.LOADTABLE_AUTO = true;
        // ... 各种常量
        
        // 初始化框架
        await lcc.initialize();

        // 加载多语言前置配置，2选1。
        //await lcc.langMgr.setLanguage('zh');    // 设置语言，同时会加载前置配置
        await lcc.langMgr.loadPreposeLangs();   // 使用默认语言加载前置配置

        // 加载模块化分包， 比如resources分包
        await lcc.packMgr.loadPack('resources');

        // ... 后面就可以使用resources分包中的资源。
    ```

完成后，就可以在客户端工程中使用框架各个模块。

## **客户端框架使用**

`客户端框架`是基于多分包的模块化游戏内容组织框架。所以，你可以把游戏内容拆分为多个模块化的分包，根据游戏进程选择加载运行。`模块化的分包`表示分包应该是包含完整代码和文件资源的某部分游戏内容模块，也就是此分包会包含某部分游戏内容的UI、场景、多语言、数据表、网络资源和代码等资源。模块化的分包就像是一些游戏的DLC或者MOD，加载后游戏就添加了新的内容。而且在开发时，只要我们把主模块化分包做好，就可以把其他的模块化分包分配给其他的团队开发。<br/>
现在cocos creator已经有分包功能，可以使用`cc.assetManager.loadBundle()`加载。分包中也可以包含基本所有游戏资源。但是，如果把游戏内容拆分为各个分包后，分包内的游戏资源是比较难管理和加载的。所以，客户端框架设计了一张全局资源索引表，游戏的内容由这张索引表构成；模块化分包内也存在自己的包资源索引表，当加载这个模块化分包的时候，分包资源索引表会合并到全局资源索引表中。这样在模块化分包内，我们只需要把暴露的资源挂在包资源索引表内；而在使用时，我们只需要关心全局资源索引表中的内容就可以了。<br/>
当然，虽然框架设计是一个多分包内容的组织框架，你也可以只使用一个分包。比如内置的`resources`。<br/>

当安装完成并且导入游戏工程后，就可以使用框架各个模块，当前框架包含模块为：
* [日志模块](./2.日志模块.md)<br/>
    日志模块可以记录并保存游戏运行过程中产生的各种消息数据与崩溃日志等，它可以方便我们在调试或者线上通过日志排查BUG。`只有原生平台才会产生日志文件`

* [定时器模块](./3.定时器模块.md)<br/>
    定时器模块是对`setTimeout`和`setInterval`的封装升级，增加定时器分组等功能。我们可以把某个模块中使用的定时器进行分组，使用后可以统一移除。

* [包管理模块](./4.包管理模块.md)<br/>
    由于该框架是基于多分包的模块化游戏内容组织框架，所以包管理模块是框架功能的基础模块。包管理模块主要管理模块化分包的加载与释放，和与之对应的资源索引表的合并与重组，同时支持自定义分包加载器。包管理模块也定义了统一资源路径格式，我们可以通过它加载各个模块化分包中的资源。
    
* [配置模块](./5.配置模块.md)<br/>
    配置模块主要对配置文件进行读取管理，并且替换配置中的变量或者引用其他的配置文件。`替换配置中的变量`主要是在程序中可以定义环境变量，然后在读取配置过程中会替换配置中`${变量名称}`字符串，这样可以方便对配置进行动态修改。`引用其他的配置文件`主要针对配置文件分散情况，比如某个配置文件在web服务器上，所以我们读取配置的时候会自动拉取这个文件。再比如，在多个配置文件中存在相同的配置，为了避免需要在每个地方同步修改，我们可以把相同的配置单独列为配置文件，其他配置文件直接引入就可以了。

* [索引模块](./6.索引模块.md)<br/>
    索引模块是该框架的核心模块，它管理全局资源索引表的合并和重组。它管理了游戏当前所有资源的引用，我们可以通过它获取当前游戏的资源；同时我们也可以监听全局资源索引表的改变，以便能及时更新某些依赖于资源的模块。

* [数据表模块](./7.数据表模块.md)<br/>
    数据表主要是保存的游戏内容的一些常量数据，比如物品表，技能表，职业表，角色表和充值表等。数据表的内容各种各样并且一般比较庞大，游戏策划通过配置表构建游戏的数据模型。数据表模块主要管理数据表的加载使用。由于该框架是基于多分包的模块化游戏内容组织框架，所以数据表配置和资源文件会分散到分包中，甚至某张数据表的内容也可以分散到分包中，分包内只应该包含当前分包的数据表配置和资源文件。

* [多语言模块](./8.多语言模块.md)<br/>
    多语言模块可以动态切换游戏中显示的语言，主要是通过多语言配置把对应文本和图片修改为对应语言的文本和图片。由于该框架是基于多分包的模块化游戏内容组织框架，所以多语言的配置和资源文件是分散在分包中的，分包内只应该包含当前分包的多语言配置和资源文件。

* [UI模块](./9.UI模块.md)<br/>
    UI模块管理游戏中使用的UI界面，主要包含UI界面资源的加载与释放、UI界面的生命周期与动画和UI界面的分组层级控制。由于该框架是基于多分包的模块化游戏内容组织框架，所以UI配置和资源文件也是分散在分包中的，分包内只应该包含当前分包的UI配置和资源文件。

* [音频模块](./10.音频模块.md)<br/>
    音频模块主要管理游戏中音频的加载和播放。设计中音频分为音乐和音效；音乐表示游戏的背景音乐(BGM)，一般是循环播放；音效表示界面操作，动画特效等音频。由于该框架是基于多分包的模块化游戏内容组织框架，所以音频配置和资源文件也是分散在分包中的，分包内只应该包含当前分包的音频配置和资源文件。

* [预制体模块](./11.预制体模块.md)<br/>
    预制体模块用于管理游戏中使用预制体，提供预制体创建和释放优化，用于配置的预制体单例对象的管理。特别是需要在跨分包使用预制体的时候，这个模块可以简化管理方式。由于该框架是基于多分包的模块化游戏内容组织框架，所以预制体配置和资源文件也是分散在分包中的，分包内只应该包含当前分包的预制体配置和资源文件。

* [场景模块](./12.场景模块.md)<br/>
    场景模块可以管理游戏中使用到的场景，并且设计了一套栈方式使用场景的框架。当前场景模块并不完善，预想中应该可以绑定其他模块资源加载和释放。

* [网络模块](./13.网络模块.md)<br/>
    网络模块作为网络游戏的核心模块，建立了一套基于网络长连接或者模拟网络长连接的通信框架。你可以使用该模块封装的统一接口解决各种长短连接网络通信问题。客户端网络模块和服务器网络模块用法基本一致，可以直接相互通信。

* [存档模块](./14.存档模块.md)<br/>
    存档模块主要用于单机游戏，提供了一套多存档槽基于事件的分散数据保存和加载机制，你可以在每个模块化分包中实现自身的保存和加载，同时也提供了事件点的检查和修改功能。

* [工具模块](./15.工具模块.md)<br/>
    工具模块主要提供一些关于资源、文件，javascript和数学等功能函数。
