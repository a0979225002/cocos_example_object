{"version":3,"sources":["..\\..\\..\\..\\assets\\src/assets\\src\\enemy-manager.js"],"names":["Primitive","require","cc","Class","extends","Component","properties","enemyCount","enemyColor","color","fromHEX","rotateSpeed","_initMesh","data","primitive","polyhedron","box","mesh","createMesh","_mesh","start","enemies","enemyPool","i","node","createEnemy","push","spawnEnemy","window","game","on","onCollider","createMeshNode","nEnemies","level","pool","enemy","pop","angle","angles","z","distance","seaHeight","playerDefaultY","Math","random","playerYRange","x","cos","y","sin","parent","splice","indexOf","update","dt","length","_eulerAngles","eulerAngles"],"mappings":"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","file":"enemy-manager.js","sourceRoot":"..\\..\\..\\..\\assets\\src","sourcesContent":["const Primitive = require('./primitive/primitive');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        enemyCount: 10,\r\n        enemyColor: cc.color().fromHEX('0xf25346'),\r\n        rotateSpeed: 360,\r\n    },\r\n\r\n    _initMesh () {\r\n        let data = cc.primitive.polyhedron ? cc.primitive.polyhedron(4, 8) : cc.primitive.box(8, 8, 8);\r\n        let mesh = Primitive.createMesh(data, this.enemyColor);\r\n        this._mesh = mesh;\r\n    },\r\n\r\n    start () {\r\n        this._initMesh();\r\n\r\n        this.enemies = [];\r\n        let enemyPool = this.enemyPool = [];\r\n        for (let i = 0; i < this.enemyCount; i++) {\r\n            let node = this.createEnemy();\r\n            enemyPool.push(node);\r\n        }\r\n\r\n        this.spawnEnemy();\r\n\r\n        window.game.node.on('level-upgrade', this.spawnEnemy, this);\r\n        window.game.node.on('collide-enemy', this.onCollider, this);\r\n    },\r\n\r\n    createEnemy () {\r\n        return window.game.createMeshNode('enemy', this._mesh, true);\r\n    },\r\n\r\n    spawnEnemy () {\r\n        let nEnemies = window.game.level;\r\n        let pool = this.enemyPool;\r\n        let enemies = this.enemies;\r\n        for (let i = 0; i < nEnemies; i++) {\r\n            let enemy = pool.pop();\r\n            if (!enemy) {\r\n                enemy = this.createEnemy();\r\n            }\r\n            let angle = -window.game.angles.z - (i*0.1);\r\n            let distance = game.seaHeight + game.playerDefaultY + (-1 + Math.random() * 2) * (game.playerYRange-20);\r\n            enemy.x = Math.cos(angle) * distance;\r\n            enemy.y = Math.sin(angle) * distance;\r\n\r\n            enemy.parent = this.node;\r\n            enemies.push(enemy);\r\n        }\r\n    },\r\n\r\n    onCollider ({enemy}) {\r\n        this.enemies.splice(this.enemies.indexOf(enemy), 1);\r\n        this.enemyPool.push(enemy);\r\n        enemy.parent = null;\r\n    },\r\n\r\n    update (dt) {\r\n        let enemies = this.enemies;\r\n        for (let i = 0; i < enemies.length; i++) {\r\n            let enemy = enemies[i];\r\n            enemy._eulerAngles.x += Math.random() ;\r\n            enemy._eulerAngles.y += Math.random() ;\r\n            enemy.eulerAngles = enemy._eulerAngles;\r\n        }\r\n    }\r\n});\r\n"]}