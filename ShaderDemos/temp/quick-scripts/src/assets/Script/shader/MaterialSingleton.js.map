{"version":3,"sources":["assets\\Script\\shader\\MaterialSingleton.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// @ts-ignore\r\nconst math = cc.vmath;\r\nconst renderEngine = cc.renderer.renderEngine;\r\nconst Material = renderEngine.Material;\r\n\r\nexport default class MaterialSingleton extends Material {\r\n    private static instance: MaterialSingleton = null;\r\n    constructor() {\r\n        super(false);\r\n    }\r\n\r\n    public static getInstance(shaderName:string): MaterialSingleton {\r\n        if (!this.instance) {\r\n            this.instance = new MaterialSingleton();\r\n        }\r\n        this.instance.initWithName(shaderName)\r\n        return this.instance;\r\n    }\r\n\r\n    private initWithName(shaderName: string) {\r\n        let renderer = renderEngine.renderer;\r\n        let gfx = renderEngine.gfx;\r\n\r\n        let pass = new renderer.Pass(shaderName);\r\n        pass.setDepth(false, false);\r\n        pass.setCullMode(gfx.CULL_NONE);\r\n        pass.setBlend(\r\n            gfx.BLEND_FUNC_ADD,\r\n            gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA,\r\n            gfx.BLEND_FUNC_ADD,\r\n            gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA\r\n        );\r\n\r\n        let mainTech = new renderer.Technique(\r\n            ['transparent'],\r\n            [\r\n                { name: 'texture', type: renderer.PARAM_TEXTURE_2D },\r\n                { name: 'pos', type: renderer.PARAM_FLOAT3 },\r\n                { name: 'size', type: renderer.PARAM_FLOAT2 },\r\n                { name: 'iTime', type: renderer.PARAM_FLOAT },\r\n                { name: 'num', type: renderer.PARAM_FLOAT },\r\n                { name: 'resolution', type: renderer.PARAM_FLOAT3 },\r\n            ],\r\n            [pass]\r\n        );\r\n\r\n        // @ts-ignore\r\n        this._texture = null;\r\n        // @ts-ignore\r\n        this._pos = { x: 0.0, y: 0.0, z: 0.0 };\r\n        // @ts-ignore\r\n        this._size = { x: 0.0, y: 0.0 };\r\n        // @ts-ignore\r\n        this._time = 0.0;\r\n        // @ts-ignore\r\n        this._num = 0.0;\r\n        // @ts-ignore\r\n        this._resolution = math.vec3.create();\r\n        // @ts-ignore\r\n        this._effect = this.effect = new renderer.Effect(\r\n            [\r\n                mainTech\r\n            ],\r\n            {\r\n                'pos': this._pos,\r\n                'size': this._size,\r\n                'iTime': this._time,\r\n                'num': this._num,\r\n                'resolution': this._resolution\r\n            },\r\n            []\r\n        );\r\n        // @ts-ignore\r\n        this._mainTech = mainTech;\r\n    }\r\n\r\n    setTexture(texture) {\r\n        if (this._texture !== texture) {\r\n            // @ts-ignore\r\n            this._texture = texture;\r\n            this._texture.update({\r\n                // 有时候需要反转y轴\r\n                flipY: false,\r\n                // 多级渐进纹理\r\n                mipmap: true\r\n            });\r\n            this._effect.setProperty('texture', texture.getImpl());\r\n            this._texIds['texture'] = texture.getId();\r\n        }\r\n    }\r\n\r\n    setPos(x, y, z) {\r\n        this._pos.x = x;\r\n        this._pos.y = y;\r\n        this._pos.z = z;\r\n        this._effect.setProperty('pos', this._pos);\r\n    }\r\n\r\n    setSize(x, y) {\r\n        this._size.x = x;\r\n        this._size.y = y;\r\n        this._effect.setProperty('size', this._size);\r\n    }\r\n\r\n    setTime(time) {\r\n        // @ts-ignore\r\n        this._time = time;\r\n        this._effect.setProperty('iTime', this._time);\r\n    }\r\n\r\n    setNum(num) {\r\n        // @ts-ignore\r\n        this._num = num;\r\n        this._effect.setProperty('num', this._num);\r\n    }\r\n\r\n    setResolution(w, h) {\r\n        this._resolution.x = w;\r\n        this._resolution.y = h;\r\n        this._effect.setProperty('resolution', this._resolution);\r\n    }\r\n\r\n\r\n}"]}