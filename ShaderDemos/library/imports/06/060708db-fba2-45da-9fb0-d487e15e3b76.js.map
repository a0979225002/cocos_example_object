{"version":3,"sources":["assets\\Script\\SearchLightEffect.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Feofox Game\r\n// Author:Lerry\r\n// https://github.com/fylz1125/ShaderDemos\r\nimport SearchLight from './SearchLightFrag';\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SearchLightEffect extends cc.Component {\r\n\r\n    program: cc.GLProgram;\r\n    startTime:number = Date.now();\r\n    time: number = 0;\r\n\r\n    resolution = { x: 0.0, y: 0.0 };\r\n    mouse = { x: 0.0, y: 0.0 };\r\n\r\n    onLoad() {\r\n        this.resolution.x = ( this.node.getContentSize().width );\r\n        this.resolution.y = (this.node.getContentSize().height);\r\n        this.mouse.x = 50.;\r\n        this.mouse.y = 40.;\r\n        let self = this;\r\n        // 添加触摸事件包含鼠标事件\r\n        this.node.on(cc.Node.EventType.TOUCH_START, function (event: cc.Event.EventTouch) {\r\n            // 转化为node的局部坐标\r\n            let touchPos = self.node.convertTouchToNodeSpaceAR(event.touch);\r\n            self.mouse.x = touchPos.x;\r\n            self.mouse.y = touchPos.y;\r\n            self.changeLight();\r\n        }, this);\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function (event:cc.Event.EventTouch) {\r\n            let touchPos = self.node.convertTouchToNodeSpaceAR(event.touch);\r\n            self.mouse.x = touchPos.x;\r\n            self.mouse.y = touchPos.y;\r\n            self.changeLight();\r\n        }, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            // cc.log('touch end');\r\n        }, this);\r\n\r\n\r\n        this.useShader();\r\n    }\r\n\r\n    useShader() {\r\n        this.program = new cc.GLProgram();\r\n        if (cc.sys.isNative) {\r\n            this.program.initWithString(SearchLight.search_light_vert, SearchLight.search_light_frag);\r\n        } else {\r\n            this.program.initWithVertexShaderByteArray(SearchLight.search_light_vert, SearchLight.search_light_frag);\r\n            this.program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\r\n            this.program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\r\n            this.program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\r\n        }\r\n        this.program.link();\r\n        this.program.updateUniforms();\r\n        this.program.use();\r\n\r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this.program);\r\n            glProgram_state.setUniformVec2(\"resolution\", this.resolution);\r\n            glProgram_state.setUniformVec2( \"mouse\", this.mouse );\r\n        } else {\r\n            let res = this.program.getUniformLocationForName( \"resolution\" );\r\n            let ms = this.program.getUniformLocationForName(\"mouse\");\r\n            this.program.setUniformLocationWith2f( res, this.resolution.x,this.resolution.y );\r\n            this.program.setUniformLocationWith2f(ms, this.mouse.x,this.mouse.y);\r\n        }\r\n        this.setProgram(this.node.getComponent(cc.Sprite)._sgNode, this.program);\r\n    }\r\n\r\n    setProgram(node: any, program: any) {\r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);\r\n            node.setGLProgramState(glProgram_state);\r\n        } else {\r\n            node.setShaderProgram(program);\r\n        }\r\n    }\r\n\r\n    changeLight() {\r\n        if (this.program) { \r\n            this.program.use();\r\n            if (cc.sys.isNative) {\r\n                var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this.program);\r\n                glProgram_state.setUniformVec2(\"resolution\", this.resolution);\r\n                glProgram_state.setUniformVec2( \"mouse\", this.mouse );\r\n            } else {\r\n                let res = this.program.getUniformLocationForName( \"resolution\" );\r\n                let ms = this.program.getUniformLocationForName(\"mouse\");\r\n                this.program.setUniformLocationWith2f( res, this.resolution.x,this.resolution.y );\r\n                this.program.setUniformLocationWith2f(ms, this.mouse.x,this.mouse.y);\r\n            }\r\n        }\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}