
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/CircleLight.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'c535fik5e5HHI9MZ9PRxTVf', 'CircleLight');
// Script/CircleLight.js

"use strict";

var _default_vert = require("../Shaders/ccShader_Default_Vert.js");

var _default_vert_no_mvp = require("../Shaders/ccShader_Default_Vert_noMVP.js");

var _glass_frag = require("../Shaders/ccShader_Circle_Light_Frag.js");

cc.Class({
  "extends": cc.Component,
  properties: {
    glassFactor: 1.0
  },
  onLoad: function onLoad() {
    this.parameters = {
      startTime: Date.now(),
      time: 0.0,
      mouse: {
        x: 0.0,
        y: 0.0
      },
      resolution: {
        x: 0.0,
        y: 0.0
      }
    };
    this.node.on(cc.Node.EventType.MOUSE_MOVE, function (event) {
      this.parameters.mouse.x = event.getLocationX();
      this.parameters.mouse.y = event.getLocationY();
    }, this);
    this.node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {
      this.parameters.mouse.x = event.getLocationX();
      this.parameters.mouse.y = event.getLocationY();
    }, this);

    this._use();
  },
  update: function update(dt) {
    if (this.glassFactor >= 40) {
      this.glassFactor = 0;
    }

    this.glassFactor += dt * 3;

    if (this._program) {
      this._program.use();

      this.updateGLParameters();

      if (cc.sys.isNative) {
        var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);
        glProgram_state.setUniformVec2("resolution", this.parameters.resolution);
        glProgram_state.setUniformFloat("time", this.parameters.time);
        glProgram_state.setUniformVec2("mouse_touch", this.parameters.mouse);
      } else {
        this._program.setUniformLocationWith2f(this._resolution, this.parameters.resolution.x, this.parameters.resolution.y);

        this._program.setUniformLocationWith1f(this._time, this.parameters.time);

        this._program.setUniformLocationWith2f(this._mouse, this.parameters.mouse.x, this.parameters.mouse.x);
      }
    }
  },
  updateGLParameters: function updateGLParameters() {
    this.parameters.time = (Date.now() - this.parameters.startTime) / 1000;
    this.parameters.resolution.x = 1.0 / this.node.getContentSize().width;
    this.parameters.resolution.y = 1.0 / this.node.getContentSize().height;
  },
  _use: function _use() {
    if (cc.sys.isNative) {
      cc.log("use native GLProgram");
      this._program = new cc.GLProgram();

      this._program.initWithString(_default_vert_no_mvp, _glass_frag);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);

      this._program.link();

      this._program.updateUniforms();

      this.updateGLParameters();
    } else {
      this._program = new cc.GLProgram();

      this._program.initWithVertexShaderByteArray(_default_vert, _glass_frag);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);

      this._program.link();

      this._program.updateUniforms();

      this._program.use();

      this.updateGLParameters();

      this._program.setUniformLocationWith1f(this._program.getUniformLocationForName('time'), this.parameters.time);

      this._program.setUniformLocationWith2f(this._program.getUniformLocationForName('mouse_touch'), this.parameters.mouse.x, this.parameters.mouse.y);

      this._program.setUniformLocationWith2f(this._program.getUniformLocationForName('resolution'), this.parameters.resolution.x, this.parameters.resolution.y);
    }

    if (cc.sys.isNative) {
      var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);
      glProgram_state.setUniformVec2("resolution", this.parameters.resolution);
      glProgram_state.setUniformFloat("time", this.parameters.time);
      glProgram_state.setUniformVec2("mouse_touch", this.parameters.mouse);
    } else {
      this._resolution = this._program.getUniformLocationForName("resolution");
      this._time = this._program.getUniformLocationForName("time");
      this._mouse = this._program.getUniformLocationForName("mouse_touch");

      this._program.setUniformLocationWith2f(this._resolution, this.parameters.resolution.x, this.parameters.resolution.y);

      this._program.setUniformLocationWith1f(this._time, this.parameters.time);

      this._program.setUniformLocationWith2f(this._mouse, this.parameters.mouse.x, this.parameters.mouse.y);
    }

    this.setProgram(this.node._sgNode, this._program);
  },
  setProgram: function setProgram(node, program) {
    if (cc.sys.isNative) {
      var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);
      node.setGLProgramState(glProgram_state);
    } else {
      node.setShaderProgram(program);
    }

    var children = node.children;
    if (!children) return;

    for (var i = 0; i < children.length; i++) {
      this.setProgram(children[i], program);
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxDaXJjbGVMaWdodC5qcyJdLCJuYW1lcyI6WyJfZGVmYXVsdF92ZXJ0IiwicmVxdWlyZSIsIl9kZWZhdWx0X3ZlcnRfbm9fbXZwIiwiX2dsYXNzX2ZyYWciLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImdsYXNzRmFjdG9yIiwib25Mb2FkIiwicGFyYW1ldGVycyIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJ0aW1lIiwibW91c2UiLCJ4IiwieSIsInJlc29sdXRpb24iLCJub2RlIiwib24iLCJOb2RlIiwiRXZlbnRUeXBlIiwiTU9VU0VfTU9WRSIsImV2ZW50IiwiZ2V0TG9jYXRpb25YIiwiZ2V0TG9jYXRpb25ZIiwiVE9VQ0hfTU9WRSIsIl91c2UiLCJ1cGRhdGUiLCJkdCIsIl9wcm9ncmFtIiwidXNlIiwidXBkYXRlR0xQYXJhbWV0ZXJzIiwic3lzIiwiaXNOYXRpdmUiLCJnbFByb2dyYW1fc3RhdGUiLCJHTFByb2dyYW1TdGF0ZSIsImdldE9yQ3JlYXRlV2l0aEdMUHJvZ3JhbSIsInNldFVuaWZvcm1WZWMyIiwic2V0VW5pZm9ybUZsb2F0Iiwic2V0VW5pZm9ybUxvY2F0aW9uV2l0aDJmIiwiX3Jlc29sdXRpb24iLCJzZXRVbmlmb3JtTG9jYXRpb25XaXRoMWYiLCJfdGltZSIsIl9tb3VzZSIsImdldENvbnRlbnRTaXplIiwid2lkdGgiLCJoZWlnaHQiLCJsb2ciLCJHTFByb2dyYW0iLCJpbml0V2l0aFN0cmluZyIsImFkZEF0dHJpYnV0ZSIsIm1hY3JvIiwiQVRUUklCVVRFX05BTUVfUE9TSVRJT04iLCJWRVJURVhfQVRUUklCX1BPU0lUSU9OIiwiQVRUUklCVVRFX05BTUVfQ09MT1IiLCJWRVJURVhfQVRUUklCX0NPTE9SIiwiQVRUUklCVVRFX05BTUVfVEVYX0NPT1JEIiwiVkVSVEVYX0FUVFJJQl9URVhfQ09PUkRTIiwibGluayIsInVwZGF0ZVVuaWZvcm1zIiwiaW5pdFdpdGhWZXJ0ZXhTaGFkZXJCeXRlQXJyYXkiLCJnZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lIiwic2V0UHJvZ3JhbSIsIl9zZ05vZGUiLCJwcm9ncmFtIiwic2V0R0xQcm9ncmFtU3RhdGUiLCJzZXRTaGFkZXJQcm9ncmFtIiwiY2hpbGRyZW4iLCJpIiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLGFBQWEsR0FBR0MsT0FBTyxDQUFDLHFDQUFELENBQTNCOztBQUNBLElBQUlDLG9CQUFvQixHQUFHRCxPQUFPLENBQUMsMkNBQUQsQ0FBbEM7O0FBQ0EsSUFBSUUsV0FBVyxHQUFHRixPQUFPLENBQUMsMENBQUQsQ0FBekI7O0FBRUFHLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxXQUFXLEVBQUM7QUFESixHQUhQO0FBT0xDLEVBQUFBLE1BQU0sRUFBRSxrQkFBWTtBQUNoQixTQUFLQyxVQUFMLEdBQWdCO0FBQ1pDLE1BQUFBLFNBQVMsRUFBQ0MsSUFBSSxDQUFDQyxHQUFMLEVBREU7QUFFWkMsTUFBQUEsSUFBSSxFQUFDLEdBRk87QUFHWkMsTUFBQUEsS0FBSyxFQUFDO0FBQ0ZDLFFBQUFBLENBQUMsRUFBQyxHQURBO0FBRUZDLFFBQUFBLENBQUMsRUFBQztBQUZBLE9BSE07QUFPWkMsTUFBQUEsVUFBVSxFQUFDO0FBQ1BGLFFBQUFBLENBQUMsRUFBQyxHQURLO0FBRVBDLFFBQUFBLENBQUMsRUFBQztBQUZLO0FBUEMsS0FBaEI7QUFhQSxTQUFLRSxJQUFMLENBQVVDLEVBQVYsQ0FBYWhCLEVBQUUsQ0FBQ2lCLElBQUgsQ0FBUUMsU0FBUixDQUFrQkMsVUFBL0IsRUFBMkMsVUFBVUMsS0FBVixFQUFpQjtBQUN4RCxXQUFLZCxVQUFMLENBQWdCSyxLQUFoQixDQUFzQkMsQ0FBdEIsR0FBMEJRLEtBQUssQ0FBQ0MsWUFBTixFQUExQjtBQUNBLFdBQUtmLFVBQUwsQ0FBZ0JLLEtB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QXNCRixPQUF0QjtBQUNIOztBQUdELFFBQUlHLFFBQVEsR0FBR2xELElBQUksQ0FBQ2tELFFBQXBCO0FBQ0EsUUFBSSxDQUFDQSxRQUFMLEVBQ0k7O0FBRUosU0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHRCxRQUFRLENBQUNFLE1BQTdCLEVBQXFDRCxDQUFDLEVBQXRDO0FBQ0ksV0FBS04sVUFBTCxDQUFnQkssUUFBUSxDQUFDQyxDQUFELENBQXhCLEVBQTZCSixPQUE3QjtBQURKO0FBRUg7QUE1SUksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF9kZWZhdWx0X3ZlcnQgPSByZXF1aXJlKFwiLi4vU2hhZGVycy9jY1NoYWRlcl9EZWZhdWx0X1ZlcnQuanNcIik7XHJcbnZhciBfZGVmYXVsdF92ZXJ0X25vX212cCA9IHJlcXVpcmUoXCIuLi9TaGFkZXJzL2NjU2hhZGVyX0RlZmF1bHRfVmVydF9ub01WUC5qc1wiKTtcclxudmFyIF9nbGFzc19mcmFnID0gcmVxdWlyZShcIi4uL1NoYWRlcnMvY2NTaGFkZXJfQ2lyY2xlX0xpZ2h0X0ZyYWcuanNcIik7XHJcblxyXG5jYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGdsYXNzRmFjdG9yOjEuMCxcclxuICAgIH0sXHJcblxyXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzPXtcclxuICAgICAgICAgICAgc3RhcnRUaW1lOkRhdGUubm93KCksXHJcbiAgICAgICAgICAgIHRpbWU6MC4wLFxyXG4gICAgICAgICAgICBtb3VzZTp7XHJcbiAgICAgICAgICAgICAgICB4OjAuMCxcclxuICAgICAgICAgICAgICAgIHk6MC4wLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXNvbHV0aW9uOntcclxuICAgICAgICAgICAgICAgIHg6MC4wLFxyXG4gICAgICAgICAgICAgICAgeTowLjAsXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuTU9VU0VfTU9WRSwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFyYW1ldGVycy5tb3VzZS54ID0gZXZlbnQuZ2V0TG9jYXRpb25YKCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFyYW1ldGVycy5tb3VzZS55ID0gZXZlbnQuZ2V0TG9jYXRpb25ZKCk7IFxyXG4gICAgICAgIH0sIHRoaXMpO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKCBjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9NT1ZFLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLnggPSBldmVudC5nZXRMb2NhdGlvblgoKTtcclxuICAgICAgICAgICAgdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLnkgPSBldmVudC5nZXRMb2NhdGlvblkoKTsgXHJcbiAgICAgICAgfSwgdGhpcyk7XHJcblxyXG4gICAgICAgIHRoaXMuX3VzZSgpO1xyXG4gICAgfSxcclxuICAgIHVwZGF0ZTpmdW5jdGlvbihkdCl7XHJcbiAgICAgICAgaWYodGhpcy5nbGFzc0ZhY3Rvcj49NDApe1xyXG4gICAgICAgICAgICB0aGlzLmdsYXNzRmFjdG9yPTA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZ2xhc3NGYWN0b3IrPWR0KjM7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX3Byb2dyYW0pe1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS51c2UoKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVHTFBhcmFtZXRlcnMoKTtcclxuICAgICAgICAgICAgaWYoY2Muc3lzLmlzTmF0aXZlKXtcclxuICAgICAgICAgICAgICAgIHZhciBnbFByb2dyYW1fc3RhdGUgPSBjYy5HTFByb2dyYW1TdGF0ZS5nZXRPckNyZWF0ZVdpdGhHTFByb2dyYW0odGhpcy5fcHJvZ3JhbSk7XHJcbiAgICAgICAgICAgICAgICBnbFByb2dyYW1fc3RhdGUuc2V0VW5pZm9ybVZlYzIoIFwicmVzb2x1dGlvblwiLCB0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbiApO1xyXG4gICAgICAgICAgICAgICAgZ2xQcm9ncmFtX3N0YXRlLnNldFVuaWZvcm1GbG9hdCggXCJ0aW1lXCIsIHRoaXMucGFyYW1ldGVycy50aW1lICk7ICAgIFxyXG4gICAgICAgICAgICAgICAgZ2xQcm9ncmFtX3N0YXRlLnNldFVuaWZvcm1WZWMyKCBcIm1vdXNlX3RvdWNoXCIgLCB0aGlzLnBhcmFtZXRlcnMubW91c2UgKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgyZiggdGhpcy5fcmVzb2x1dGlvbiwgdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24ueCx0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbi55ICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgxZiggdGhpcy5fdGltZSwgdGhpcy5wYXJhbWV0ZXJzLnRpbWUgKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uc2V0VW5pZm9ybUxvY2F0aW9uV2l0aDJmKCB0aGlzLl9tb3VzZSwgdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLngsdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLnggKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICB1cGRhdGVHTFBhcmFtZXRlcnMoKXtcclxuICAgICAgICB0aGlzLnBhcmFtZXRlcnMudGltZSA9IChEYXRlLm5vdygpIC0gdGhpcy5wYXJhbWV0ZXJzLnN0YXJ0VGltZSkvMTAwMDtcclxuICAgICAgICB0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbi54ID0gKCAxLjAgLyB0aGlzLm5vZGUuZ2V0Q29udGVudFNpemUoKS53aWR0aCApO1xyXG4gICAgICAgIHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uLnkgPSAoIDEuMCAvIHRoaXMubm9kZS5nZXRDb250ZW50U2l6ZSgpLmhlaWdodCApO1xyXG5cclxuXHJcbiAgICB9LFxyXG5cclxuICAgIF91c2U6IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XHJcbiAgICAgICAgICAgIGNjLmxvZyhcInVzZSBuYXRpdmUgR0xQcm9ncmFtXCIpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtID0gbmV3IGNjLkdMUHJvZ3JhbSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmluaXRXaXRoU3RyaW5nKF9kZWZhdWx0X3ZlcnRfbm9fbXZwLCBfZ2xhc3NfZnJhZyk7XHJcblxyXG5cclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5hZGRBdHRyaWJ1dGUoY2MubWFjcm8uQVRUUklCVVRFX05BTUVfUE9TSVRJT04sIGNjLm1hY3JvLlZFUlRFWF9BVFRSSUJfUE9TSVRJT04pO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmFkZEF0dHJpYnV0ZShjYy5tYWNyby5BVFRSSUJVVEVfTkFNRV9DT0xPUiwgY2MubWFjcm8uVkVSVEVYX0FUVFJJQl9DT0xPUik7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uYWRkQXR0cmlidXRlKGNjLm1hY3JvLkFUVFJJQlVURV9OQU1FX1RFWF9DT09SRCwgY2MubWFjcm8uVkVSVEVYX0FUVFJJQl9URVhfQ09PUkRTKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0ubGluaygpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnVwZGF0ZVVuaWZvcm1zKCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR0xQYXJhbWV0ZXJzKCk7XHJcblxyXG5cclxuICAgICAgICAgICBcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbSA9IG5ldyBjYy5HTFByb2dyYW0oKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5pbml0V2l0aFZlcnRleFNoYWRlckJ5dGVBcnJheShfZGVmYXVsdF92ZXJ0LCBfZ2xhc3NfZnJhZyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uYWRkQXR0cmlidXRlKGNjLm1hY3JvLkFUVFJJQlVURV9OQU1FX1BPU0lUSU9OLCBjYy5tYWNyby5WRVJURVhfQVRUUklCX1BPU0lUSU9OKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5hZGRBdHRyaWJ1dGUoY2MubWFjcm8uQVRUUklCVVRFX05BTUVfQ09MT1IsIGNjLm1hY3JvLlZFUlRFWF9BVFRSSUJfQ09MT1IpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmFkZEF0dHJpYnV0ZShjYy5tYWNyby5BVFRSSUJVVEVfTkFNRV9URVhfQ09PUkQsIGNjLm1hY3JvLlZFUlRFWF9BVFRSSUJfVEVYX0NPT1JEUyk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmxpbmsoKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS51cGRhdGVVbmlmb3JtcygpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnVzZSgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVHTFBhcmFtZXRlcnMoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uc2V0VW5pZm9ybUxvY2F0aW9uV2l0aDFmKCB0aGlzLl9wcm9ncmFtLmdldFVuaWZvcm1Mb2NhdGlvbkZvck5hbWUoJ3RpbWUnKSwgdGhpcy5wYXJhbWV0ZXJzLnRpbWUgKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoMmYoIHRoaXMuX3Byb2dyYW0uZ2V0VW5pZm9ybUxvY2F0aW9uRm9yTmFtZSgnbW91c2VfdG91Y2gnKSwgdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLngsdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLnkgKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoMmYodGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCdyZXNvbHV0aW9uJyksIHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uLngsdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24ueSApO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBcclxuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XHJcbiAgICAgICAgICAgIHZhciBnbFByb2dyYW1fc3RhdGUgPSBjYy5HTFByb2dyYW1TdGF0ZS5nZXRPckNyZWF0ZVdpdGhHTFByb2dyYW0odGhpcy5fcHJvZ3JhbSk7XHJcbiAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtVmVjMiggXCJyZXNvbHV0aW9uXCIsIHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uICk7XHJcbiAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtRmxvYXQoIFwidGltZVwiICwgdGhpcy5wYXJhbWV0ZXJzLnRpbWUgKTtcclxuICAgICAgICAgICAgZ2xQcm9ncmFtX3N0YXRlLnNldFVuaWZvcm1WZWMyKCBcIm1vdXNlX3RvdWNoXCIgLCB0aGlzLnBhcmFtZXRlcnMubW91c2UgKTtcclxuICAgICAgICB9ZWxzZXtcclxuXHJcblxyXG4gICAgICAgICAgICB0aGlzLl9yZXNvbHV0aW9uID0gdGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCBcInJlc29sdXRpb25cIiApO1xyXG4gICAgICAgICAgICB0aGlzLl90aW1lID0gdGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCBcInRpbWVcIiApO1xyXG4gICAgICAgICAgICB0aGlzLl9tb3VzZSA9IHRoaXMuX3Byb2dyYW0uZ2V0VW5pZm9ybUxvY2F0aW9uRm9yTmFtZSggXCJtb3VzZV90b3VjaFwiICk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgyZiggdGhpcy5fcmVzb2x1dGlvbiwgdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24ueCx0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbi55ICk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uc2V0VW5pZm9ybUxvY2F0aW9uV2l0aDFmKCB0aGlzLl90aW1lLCB0aGlzLnBhcmFtZXRlcnMudGltZSApO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgyZiggdGhpcy5fbW91c2UsIHRoaXMucGFyYW1ldGVycy5tb3VzZS54LHRoaXMucGFyYW1ldGVycy5tb3VzZS55ICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNldFByb2dyYW0oIHRoaXMubm9kZS5fc2dOb2RlICx0aGlzLl9wcm9ncmFtICk7XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICBzZXRQcm9ncmFtOmZ1bmN0aW9uIChub2RlLCBwcm9ncmFtKSB7XHJcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xyXG4gICAgICAgICAgICB2YXIgZ2xQcm9ncmFtX3N0YXRlID0gY2MuR0xQcm9ncmFtU3RhdGUuZ2V0T3JDcmVhdGVXaXRoR0xQcm9ncmFtKHByb2dyYW0pO1xyXG4gICAgICAgICAgICBub2RlLnNldEdMUHJvZ3JhbVN0YXRlKGdsUHJvZ3JhbV9zdGF0ZSk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG5vZGUuc2V0U2hhZGVyUHJvZ3JhbShwcm9ncmFtKTsgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgXHJcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjtcclxuICAgICAgICBpZiAoIWNoaWxkcmVuKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICBcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB0aGlzLnNldFByb2dyYW0oY2hpbGRyZW5baV0sIHByb2dyYW0pO1xyXG4gICAgfVxyXG5cclxufSk7XHJcbiJdfQ==