
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Glass2.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'c5c21NQAiVNPpg1XNMoak8k', 'Glass2');
// Script/Glass2.js

"use strict";

var _default_vert = require("../Shaders/ccShader_Default_Vert.js");

var _default_vert_no_mvp = require("../Shaders/ccShader_Default_Vert_noMVP.js");

var _glass_frag = require("../Shaders/ccShader_Glass_Frag.js");

cc.Class({
  "extends": cc.Component,
  properties: {
    glassFactor: 1.0,
    frag_glsl: {
      "default": "Effect10.fs.glsl",
      visible: false
    }
  },
  onLoad: function onLoad() {
    var self = this;
    var now = new Date();
    this.parameters = {
      startTime: Date.now(),
      time: 0.0,
      mouse: {
        x: 0.0,
        y: 0.0,
        z: 0.0,
        w: 0.0
      },
      resolution: {
        x: 0.0,
        y: 0.0,
        z: 1.0
      },
      date: {
        x: now.getYear(),
        //year
        y: now.getMonth(),
        //month
        z: now.getDate(),
        //day
        w: now.getTime() + now.getMilliseconds() / 1000 //time seconds

      },
      isMouseDown: false
    };
    cc.loader.loadRes(self.frag_glsl, function (err, txt) {
      if (err) {
        cc.log(err);
      } else {
        self.frag_glsl = txt;

        self._use();
      }
    });
  },
  update: function update(dt) {
    if (this.glassFactor >= 40) {
      this.glassFactor = 0;
    }

    this.glassFactor += dt * 3;

    if (this._program) {
      this._program.use();

      this.updateGLParameters();

      if (cc.sys.isNative) {
        var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);
        glProgram_state.setUniformFloat("blurRadiusScale", this.glassFactor);
        glProgram_state.setUniformVec3("iResolution", this.parameters.resolution);
        glProgram_state.setUniformFloat("iGlobalTime", this.parameters.time);
        glProgram_state.setUniformVec4("iMouse", this.parameters.mouse);
        glProgram_state.setUniformVec4("iDate", this.parameters.date);
      } else {
        this._program.setUniformLocationWith1f(this._uniBlurRadiusScale, this.glassFactor);

        this._program.setUniformLocationWith3f(this._resolution, this.parameters.resolution.x, this.parameters.resolution.y, this.parameters.resolution.z);

        this._program.setUniformLocationWith1f(this._time, this.parameters.time);

        this._program.setUniformLocationWith4f(this._mouse, this.parameters.mouse.x, this.parameters.mouse.y, this.parameters.mouse.z, this.parameters.mouse.w);

        this._program.setUniformLocationWith4f(this._date, this.parameters.date.x, this.parameters.date.y, this.parameters.date.z, this.parameters.date.w);
      }
    }
  },
  updateGLParameters: function updateGLParameters() {
    this.parameters.time = (Date.now() - this.parameters.startTime) / 1000;
    this.parameters.resolution.x = this.node.getContentSize().width;
    this.parameters.resolution.y = this.node.getContentSize().height;
    var now = new Date();
    this.parameters.date = {
      x: now.getYear(),
      //year
      y: now.getMonth(),
      //month
      z: now.getDate(),
      //day
      w: now.getTime() + now.getMilliseconds() / 1000 //time seconds

    };
  },
  _use: function _use() {
    this._program = new cc.GLProgram();

    if (cc.sys.isNative) {
      cc.log("use native GLProgram");
      this._program = new cc.GLProgram();

      this._program.initWithString(_default_vert_no_mvp, this.frag_glsl);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);

      this._program.link();

      this._program.updateUniforms();

      this.updateGLParameters();
    } else {
      this._program = new cc.GLProgram();

      this._program.initWithVertexShaderByteArray(_default_vert, this.frag_glsl);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);

      this._program.link();

      this._program.updateUniforms();

      this._program.use();

      this.updateGLParameters();

      this._program.setUniformLocationWith3f(this._program.getUniformLocationForName('iResolution'), this.parameters.resolution.x, this.parameters.resolution.y, this.parameters.resolution.z);

      this._program.setUniformLocationWith1f(this._program.getUniformLocationForName('iGlobalTime'), this.parameters.time);

      this._program.setUniformLocationWith4f(this._program.getUniformLocationForName('iMouse'), this.parameters.mouse.x, this.parameters.mouse.y, this.parameters.mouse.z, this.parameters.mouse.w);

      this._program.setUniformLocationWith4f(this._program.getUniformLocationForName('iDate'), this.parameters.date.x, this.parameters.date.y, this.parameters.date.z, this.parameters.date.w);
    }

    if (cc.sys.isNative) {
      var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);
      glProgram_state.setUniformFloat("widthStep", 1.0 / this.node.getContentSize().width);
      glProgram_state.setUniformFloat("heightStep", 1.0 / this.node.getContentSize().height);
      glProgram_state.setUniformFloat("blurRadiusScale", this.glassFactor);
      glProgram_state.setUniformVec3("iResolution", this.parameters.resolution);
      glProgram_state.setUniformFloat("iGlobalTime", this.parameters.time);
      glProgram_state.setUniformVec4("iMouse", this.parameters.mouse);
    } else {
      this._uniWidthStep = this._program.getUniformLocationForName("widthStep");
      this._uniHeightStep = this._program.getUniformLocationForName("heightStep");
      this._uniBlurRadiusScale = this._program.getUniformLocationForName("blurRadiusScale");

      this._program.setUniformLocationWith1f(this._uniWidthStep, 1.0 / this.node.getContentSize().width);

      this._program.setUniformLocationWith1f(this._uniHeightStep, 1.0 / this.node.getContentSize().height);

      this._program.setUniformLocationWith1f(this._uniBlurRadiusScale, this.glassFactor);

      this._resolution = this._program.getUniformLocationForName("iResolution");
      this._time = this._program.getUniformLocationForName("iGlobalTime");
      this._mouse = this._program.getUniformLocationForName("iMouse");

      this._program.setUniformLocationWith3f(this._resolution, this.parameters.resolution.x, this.parameters.resolution.y, this.parameters.resolution.z);

      this._program.setUniformLocationWith1f(this._time, this.parameters.time);

      this._program.setUniformLocationWith4f(this._mouse, this.parameters.mouse.x, this.parameters.mouse.y, this.parameters.mouse.z, this.parameters.mouse.w);

      this._program.setUniformLocationWith4f(this._date, this.parameters.date.x, this.parameters.date.y, this.parameters.date.z, this.parameters.date.w);
    }

    this.setProgram(this.node._sgNode, this._program);
  },
  setProgram: function setProgram(node, program) {
    if (cc.sys.isNative) {
      var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);
      node.setGLProgramState(glProgram_state);
    } else {
      node.setShaderProgram(program);
    }

    var children = node.children;
    if (!children) return;

    for (var i = 0; i < children.length; i++) {
      this.setProgram(children[i], program);
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxHbGFzczIuanMiXSwibmFtZXMiOlsiX2RlZmF1bHRfdmVydCIsInJlcXVpcmUiLCJfZGVmYXVsdF92ZXJ0X25vX212cCIsIl9nbGFzc19mcmFnIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJnbGFzc0ZhY3RvciIsImZyYWdfZ2xzbCIsInZpc2libGUiLCJvbkxvYWQiLCJzZWxmIiwibm93IiwiRGF0ZSIsInBhcmFtZXRlcnMiLCJzdGFydFRpbWUiLCJ0aW1lIiwibW91c2UiLCJ4IiwieSIsInoiLCJ3IiwicmVzb2x1dGlvbiIsImRhdGUiLCJnZXRZZWFyIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0VGltZSIsImdldE1pbGxpc2Vjb25kcyIsImlzTW91c2VEb3duIiwibG9hZGVyIiwibG9hZFJlcyIsImVyciIsInR4dCIsImxvZyIsIl91c2UiLCJ1cGRhdGUiLCJkdCIsIl9wcm9ncmFtIiwidXNlIiwidXBkYXRlR0xQYXJhbWV0ZXJzIiwic3lzIiwiaXNOYXRpdmUiLCJnbFByb2dyYW1fc3RhdGUiLCJHTFByb2dyYW1TdGF0ZSIsImdldE9yQ3JlYXRlV2l0aEdMUHJvZ3JhbSIsInNldFVuaWZvcm1GbG9hdCIsInNldFVuaWZvcm1WZWMzIiwic2V0VW5pZm9ybVZlYzQiLCJzZXRVbmlmb3JtTG9jYXRpb25XaXRoMWYiLCJfdW5pQmx1clJhZGl1c1NjYWxlIiwic2V0VW5pZm9ybUxvY2F0aW9uV2l0aDNmIiwiX3Jlc29sdXRpb24iLCJfdGltZSIsInNldFVuaWZvcm1Mb2NhdGlvbldpdGg0ZiIsIl9tb3VzZSIsIl9kYXRlIiwibm9kZSIsImdldENvbnRlbnRTaXplIiwid2lkdGgiLCJoZWlnaHQiLCJHTFByb2dyYW0iLCJpbml0V2l0aFN0cmluZyIsImFkZEF0dHJpYnV0ZSIsIm1hY3JvIiwiQVRUUklCVVRFX05BTUVfUE9TSVRJT04iLCJWRVJURVhfQVRUUklCX1BPU0lUSU9OIiwiQVRUUklCVVRFX05BTUVfQ09MT1IiLCJWRVJURVhfQVRUUklCX0NPTE9SIiwiQVRUUklCVVRFX05BTUVfVEVYX0NPT1JEIiwiVkVSVEVYX0FUVFJJQl9URVhfQ09PUkRTIiwibGluayIsInVwZGF0ZVVuaWZvcm1zIiwiaW5pdFdpdGhWZXJ0ZXhTaGFkZXJCeXRlQXJyYXkiLCJnZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lIiwiX3VuaVdpZHRoU3RlcCIsIl91bmlIZWlnaHRTdGVwIiwic2V0UHJvZ3JhbSIsIl9zZ05vZGUiLCJwcm9ncmFtIiwic2V0R0xQcm9ncmFtU3RhdGUiLCJzZXRTaGFkZXJQcm9ncmFtIiwiY2hpbGRyZW4iLCJpIiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLGFBQWEsR0FBR0MsT0FBTyxDQUFDLHFDQUFELENBQTNCOztBQUNBLElBQUlDLG9CQUFvQixHQUFHRCxPQUFPLENBQUMsMkNBQUQsQ0FBbEM7O0FBQ0EsSUFBSUUsV0FBVyxHQUFHRixPQUFPLENBQUMsbUNBQUQsQ0FBekI7O0FBRUFHLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxXQUFXLEVBQUMsR0FESjtBQUVSQyxJQUFBQSxTQUFTLEVBQUM7QUFDTixpQkFBUSxrQkFERjtBQUVOQyxNQUFBQSxPQUFPLEVBQUM7QUFGRjtBQUZGLEdBSFA7QUFXTEMsRUFBQUEsTUFBTSxFQUFFLGtCQUFZO0FBQ2hCLFFBQUlDLElBQUksR0FBRyxJQUFYO0FBQ0EsUUFBSUMsR0FBRyxHQUFHLElBQUlDLElBQUosRUFBVjtBQUNBLFNBQUtDLFVBQUwsR0FBZ0I7QUFDWkMsTUFBQUEsU0FBUyxFQUFDRixJQUFJLENBQUNELEdBQUwsRUFERTtBQUVaSSxNQUFBQSxJQUFJLEVBQUMsR0FGTztBQUdaQyxNQUFBQSxLQUFLLEVBQUM7QUFDRkMsUUFBQUEsQ0FBQyxFQUFDLEdBREE7QUFFRkMsUUFBQUEsQ0FBQyxF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QnJDLGVBQXZCO0FBQ0gsS0FIRCxNQUdLO0FBQ0RjLE1BQUFBLElBQUksQ0FBQ3dCLGdCQUFMLENBQXNCRixPQUF0QjtBQUNIOztBQUdELFFBQUlHLFFBQVEsR0FBR3pCLElBQUksQ0FBQ3lCLFFBQXBCO0FBQ0EsUUFBSSxDQUFDQSxRQUFMLEVBQ0k7O0FBRUosU0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHRCxRQUFRLENBQUNFLE1BQTdCLEVBQXFDRCxDQUFDLEVBQXRDO0FBQ0ksV0FBS04sVUFBTCxDQUFnQkssUUFBUSxDQUFDQyxDQUFELENBQXhCLEVBQTZCSixPQUE3QjtBQURKO0FBRUg7QUFqTEksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF9kZWZhdWx0X3ZlcnQgPSByZXF1aXJlKFwiLi4vU2hhZGVycy9jY1NoYWRlcl9EZWZhdWx0X1ZlcnQuanNcIik7XHJcbnZhciBfZGVmYXVsdF92ZXJ0X25vX212cCA9IHJlcXVpcmUoXCIuLi9TaGFkZXJzL2NjU2hhZGVyX0RlZmF1bHRfVmVydF9ub01WUC5qc1wiKTtcclxudmFyIF9nbGFzc19mcmFnID0gcmVxdWlyZShcIi4uL1NoYWRlcnMvY2NTaGFkZXJfR2xhc3NfRnJhZy5qc1wiKTtcclxuXHJcbmNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgZ2xhc3NGYWN0b3I6MS4wLFxyXG4gICAgICAgIGZyYWdfZ2xzbDp7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XCJFZmZlY3QxMC5mcy5nbHNsXCIsXHJcbiAgICAgICAgICAgIHZpc2libGU6ZmFsc2UsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcblxyXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIHRoaXMucGFyYW1ldGVycz17XHJcbiAgICAgICAgICAgIHN0YXJ0VGltZTpEYXRlLm5vdygpLFxyXG4gICAgICAgICAgICB0aW1lOjAuMCxcclxuICAgICAgICAgICAgbW91c2U6e1xyXG4gICAgICAgICAgICAgICAgeDowLjAsXHJcbiAgICAgICAgICAgICAgICB5OjAuMCxcclxuICAgICAgICAgICAgICAgIHo6MC4wLFxyXG4gICAgICAgICAgICAgICAgdzowLjAsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJlc29sdXRpb246e1xyXG4gICAgICAgICAgICAgICAgeDowLjAsXHJcbiAgICAgICAgICAgICAgICB5OjAuMCxcclxuICAgICAgICAgICAgICAgIHo6MS4wLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBkYXRlOntcclxuICAgICAgICAgICAgICAgIHg6bm93LmdldFllYXIoKSwvL3llYXJcclxuICAgICAgICAgICAgICAgIHk6bm93LmdldE1vbnRoKCksLy9tb250aFxyXG4gICAgICAgICAgICAgICAgejpub3cuZ2V0RGF0ZSgpLC8vZGF5XHJcbiAgICAgICAgICAgICAgICB3Om5vdy5nZXRUaW1lKCkrbm93LmdldE1pbGxpc2Vjb25kcygpLzEwMDAsLy90aW1lIHNlY29uZHNcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaXNNb3VzZURvd246ZmFsc2UsXHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKHNlbGYuZnJhZ19nbHNsLGZ1bmN0aW9uKGVycix0eHQpe1xyXG4gICAgICAgICAgICBpZihlcnIpe1xyXG4gICAgICAgICAgICAgICAgY2MubG9nKGVycilcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmZyYWdfZ2xzbCA9IHR4dDtcclxuICAgICAgICAgICAgICAgIHNlbGYuX3VzZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIH0sXHJcbiAgICB1cGRhdGU6ZnVuY3Rpb24oZHQpe1xyXG4gICAgICAgIGlmKHRoaXMuZ2xhc3NGYWN0b3I+PTQwKXtcclxuICAgICAgICAgICAgdGhpcy5nbGFzc0ZhY3Rvcj0wO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdsYXNzRmFjdG9yKz1kdCozO1xyXG5cclxuICAgICAgICBpZih0aGlzLl9wcm9ncmFtKXtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0udXNlKCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR0xQYXJhbWV0ZXJzKCk7XHJcbiAgICAgICAgICAgIGlmKGNjLnN5cy5pc05hdGl2ZSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ2xQcm9ncmFtX3N0YXRlID0gY2MuR0xQcm9ncmFtU3RhdGUuZ2V0T3JDcmVhdGVXaXRoR0xQcm9ncmFtKHRoaXMuX3Byb2dyYW0pO1xyXG4gICAgICAgICAgICAgICAgZ2xQcm9ncmFtX3N0YXRlLnNldFVuaWZvcm1GbG9hdCggXCJibHVyUmFkaXVzU2NhbGVcIiAsdGhpcy5nbGFzc0ZhY3Rvcik7XHJcbiAgICAgICAgICAgICAgICBnbFByb2dyYW1fc3RhdGUuc2V0VW5pZm9ybVZlYzMoIFwiaVJlc29sdXRpb25cIiwgdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24gKTtcclxuICAgICAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtRmxvYXQoIFwiaUdsb2JhbFRpbWVcIiwgdGhpcy5wYXJhbWV0ZXJzLnRpbWUgKTsgICAgXHJcbiAgICAgICAgICAgICAgICBnbFByb2dyYW1fc3RhdGUuc2V0VW5pZm9ybVZlYzQoIFwiaU1vdXNlXCIgLCB0aGlzLnBhcmFtZXRlcnMubW91c2UgKTtcclxuICAgICAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtVmVjNCggXCJpRGF0ZVwiICwgdGhpcy5wYXJhbWV0ZXJzLmRhdGUgKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgxZiggdGhpcy5fdW5pQmx1clJhZGl1c1NjYWxlLCB0aGlzLmdsYXNzRmFjdG9yICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgzZiggdGhpcy5fcmVzb2x1dGlvbiwgdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24ueCx0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbi55LHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uLnogKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uc2V0VW5pZm9ybUxvY2F0aW9uV2l0aDFmKCB0aGlzLl90aW1lLCB0aGlzLnBhcmFtZXRlcnMudGltZSApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoNGYoIHRoaXMuX21vdXNlLCB0aGlzLnBhcmFtZXRlcnMubW91c2UueCx0aGlzLnBhcmFtZXRlcnMubW91c2UueSx0aGlzLnBhcmFtZXRlcnMubW91c2Uueix0aGlzLnBhcmFtZXRlcnMubW91c2UudyApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoNGYoIHRoaXMuX2RhdGUsIHRoaXMucGFyYW1ldGVycy5kYXRlLngsdGhpcy5wYXJhbWV0ZXJzLmRhdGUueSx0aGlzLnBhcmFtZXRlcnMuZGF0ZS56LHRoaXMucGFyYW1ldGVycy5kYXRlLncgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICB1cGRhdGVHTFBhcmFtZXRlcnMoKXtcclxuICAgICAgICB0aGlzLnBhcmFtZXRlcnMudGltZSA9IChEYXRlLm5vdygpIC0gdGhpcy5wYXJhbWV0ZXJzLnN0YXJ0VGltZSkvMTAwMDtcclxuICAgICAgICB0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbi54ID0gKCB0aGlzLm5vZGUuZ2V0Q29udGVudFNpemUoKS53aWR0aCApO1xyXG4gICAgICAgIHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uLnkgPSAoIHRoaXMubm9kZS5nZXRDb250ZW50U2l6ZSgpLmhlaWdodCApO1xyXG4gICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgICAgICB0aGlzLnBhcmFtZXRlcnMuZGF0ZT17XHJcbiAgICAgICAgICAgICAgICB4Om5vdy5nZXRZZWFyKCksLy95ZWFyXHJcbiAgICAgICAgICAgICAgICB5Om5vdy5nZXRNb250aCgpLC8vbW9udGhcclxuICAgICAgICAgICAgICAgIHo6bm93LmdldERhdGUoKSwvL2RheVxyXG4gICAgICAgICAgICAgICAgdzpub3cuZ2V0VGltZSgpK25vdy5nZXRNaWxsaXNlY29uZHMoKS8xMDAwLC8vdGltZSBzZWNvbmRzXHJcbiAgICAgICAgICAgIH07XHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICBfdXNlOiBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5fcHJvZ3JhbSA9IG5ldyBjYy5HTFByb2dyYW0oKTtcclxuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XHJcbiAgICAgICAgICAgIGNjLmxvZyhcInVzZSBuYXRpdmUgR0xQcm9ncmFtXCIpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtID0gbmV3IGNjLkdMUHJvZ3JhbSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmluaXRXaXRoU3RyaW5nKF9kZWZhdWx0X3ZlcnRfbm9fbXZwLCB0aGlzLmZyYWdfZ2xzbCApO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uYWRkQXR0cmlidXRlKGNjLm1hY3JvLkFUVFJJQlVURV9OQU1FX1BPU0lUSU9OLCBjYy5tYWNyby5WRVJURVhfQVRUUklCX1BPU0lUSU9OKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5hZGRBdHRyaWJ1dGUoY2MubWFjcm8uQVRUUklCVVRFX05BTUVfQ09MT1IsIGNjLm1hY3JvLlZFUlRFWF9BVFRSSUJfQ09MT1IpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmFkZEF0dHJpYnV0ZShjYy5tYWNyby5BVFRSSUJVVEVfTkFNRV9URVhfQ09PUkQsIGNjLm1hY3JvLlZFUlRFWF9BVFRSSUJfVEVYX0NPT1JEUyk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmxpbmsoKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS51cGRhdGVVbmlmb3JtcygpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdMUGFyYW1ldGVycygpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0gPSBuZXcgY2MuR0xQcm9ncmFtKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uaW5pdFdpdGhWZXJ0ZXhTaGFkZXJCeXRlQXJyYXkoX2RlZmF1bHRfdmVydCwgdGhpcy5mcmFnX2dsc2wgKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5hZGRBdHRyaWJ1dGUoY2MubWFjcm8uQVRUUklCVVRFX05BTUVfUE9TSVRJT04sIGNjLm1hY3JvLlZFUlRFWF9BVFRSSUJfUE9TSVRJT04pO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmFkZEF0dHJpYnV0ZShjYy5tYWNyby5BVFRSSUJVVEVfTkFNRV9DT0xPUiwgY2MubWFjcm8uVkVSVEVYX0FUVFJJQl9DT0xPUik7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uYWRkQXR0cmlidXRlKGNjLm1hY3JvLkFUVFJJQlVURV9OQU1FX1RFWF9DT09SRCwgY2MubWFjcm8uVkVSVEVYX0FUVFJJQl9URVhfQ09PUkRTKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0ubGluaygpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnVwZGF0ZVVuaWZvcm1zKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0udXNlKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdMUGFyYW1ldGVycygpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoM2YodGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCdpUmVzb2x1dGlvbicpLCB0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbi54LHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uLnksdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24ueiApO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgxZiggdGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCdpR2xvYmFsVGltZScpLCB0aGlzLnBhcmFtZXRlcnMudGltZSApO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGg0ZiggdGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCdpTW91c2UnKSwgdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLngsdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLnkgLCB0aGlzLnBhcmFtZXRlcnMubW91c2Uueix0aGlzLnBhcmFtZXRlcnMubW91c2Uudyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uc2V0VW5pZm9ybUxvY2F0aW9uV2l0aDRmKCB0aGlzLl9wcm9ncmFtLmdldFVuaWZvcm1Mb2NhdGlvbkZvck5hbWUoJ2lEYXRlJyksIHRoaXMucGFyYW1ldGVycy5kYXRlLngsdGhpcy5wYXJhbWV0ZXJzLmRhdGUueSx0aGlzLnBhcmFtZXRlcnMuZGF0ZS56LHRoaXMucGFyYW1ldGVycy5kYXRlLncgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xyXG4gICAgICAgICAgICB2YXIgZ2xQcm9ncmFtX3N0YXRlID0gY2MuR0xQcm9ncmFtU3RhdGUuZ2V0T3JDcmVhdGVXaXRoR0xQcm9ncmFtKHRoaXMuX3Byb2dyYW0pO1xyXG4gICAgICAgICAgICBnbFByb2dyYW1fc3RhdGUuc2V0VW5pZm9ybUZsb2F0KCBcIndpZHRoU3RlcFwiICwgKCAxLjAgLyB0aGlzLm5vZGUuZ2V0Q29udGVudFNpemUoKS53aWR0aCApICk7XHJcbiAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtRmxvYXQoIFwiaGVpZ2h0U3RlcFwiICwgKCAxLjAgLyB0aGlzLm5vZGUuZ2V0Q29udGVudFNpemUoKS5oZWlnaHQgKSApO1xyXG4gICAgICAgICAgICBnbFByb2dyYW1fc3RhdGUuc2V0VW5pZm9ybUZsb2F0KCBcImJsdXJSYWRpdXNTY2FsZVwiICx0aGlzLmdsYXNzRmFjdG9yKTtcclxuICAgICAgICAgICAgZ2xQcm9ncmFtX3N0YXRlLnNldFVuaWZvcm1WZWMzKCBcImlSZXNvbHV0aW9uXCIsIHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uICk7XHJcbiAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtRmxvYXQoIFwiaUdsb2JhbFRpbWVcIiAsIHRoaXMucGFyYW1ldGVycy50aW1lICk7XHJcbiAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtVmVjNCggXCJpTW91c2VcIiAsIHRoaXMucGFyYW1ldGVycy5tb3VzZSApO1xyXG4gICAgICAgIH1lbHNle1xyXG5cclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3VuaVdpZHRoU3RlcCA9IHRoaXMuX3Byb2dyYW0uZ2V0VW5pZm9ybUxvY2F0aW9uRm9yTmFtZSggXCJ3aWR0aFN0ZXBcIiApO1xyXG4gICAgICAgICAgICB0aGlzLl91bmlIZWlnaHRTdGVwID0gdGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCBcImhlaWdodFN0ZXBcIiApO1xyXG4gICAgICAgICAgICB0aGlzLl91bmlCbHVyUmFkaXVzU2NhbGUgPSB0aGlzLl9wcm9ncmFtLmdldFVuaWZvcm1Mb2NhdGlvbkZvck5hbWUoIFwiYmx1clJhZGl1c1NjYWxlXCIgKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uc2V0VW5pZm9ybUxvY2F0aW9uV2l0aDFmKCB0aGlzLl91bmlXaWR0aFN0ZXAsICggMS4wIC8gdGhpcy5ub2RlLmdldENvbnRlbnRTaXplKCkud2lkdGggKSApO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgxZiggdGhpcy5fdW5pSGVpZ2h0U3RlcCwgKCAxLjAgLyB0aGlzLm5vZGUuZ2V0Q29udGVudFNpemUoKS5oZWlnaHQgKSApO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgxZiggdGhpcy5fdW5pQmx1clJhZGl1c1NjYWxlLCB0aGlzLmdsYXNzRmFjdG9yICk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9yZXNvbHV0aW9uID0gdGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCBcImlSZXNvbHV0aW9uXCIgKTtcclxuICAgICAgICAgICAgdGhpcy5fdGltZSA9IHRoaXMuX3Byb2dyYW0uZ2V0VW5pZm9ybUxvY2F0aW9uRm9yTmFtZSggXCJpR2xvYmFsVGltZVwiICk7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlID0gdGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCBcImlNb3VzZVwiICk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgzZiggdGhpcy5fcmVzb2x1dGlvbiwgdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24ueCx0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbi55LHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uLnogKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoMWYoIHRoaXMuX3RpbWUsIHRoaXMucGFyYW1ldGVycy50aW1lICk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uc2V0VW5pZm9ybUxvY2F0aW9uV2l0aDRmKCB0aGlzLl9tb3VzZSwgdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLngsdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLnkgLHRoaXMucGFyYW1ldGVycy5tb3VzZS56LHRoaXMucGFyYW1ldGVycy5tb3VzZS53KTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoNGYoIHRoaXMuX2RhdGUsIHRoaXMucGFyYW1ldGVycy5kYXRlLngsdGhpcy5wYXJhbWV0ZXJzLmRhdGUueSx0aGlzLnBhcmFtZXRlcnMuZGF0ZS56LHRoaXMucGFyYW1ldGVycy5kYXRlLncgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2V0UHJvZ3JhbSggdGhpcy5ub2RlLl9zZ05vZGUgLHRoaXMuX3Byb2dyYW0gKTtcclxuICAgIH0sXHJcbiAgICBcclxuICAgIHNldFByb2dyYW06ZnVuY3Rpb24gKG5vZGUsIHByb2dyYW0pIHtcclxuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XHJcbiAgICAgICAgICAgIHZhciBnbFByb2dyYW1fc3RhdGUgPSBjYy5HTFByb2dyYW1TdGF0ZS5nZXRPckNyZWF0ZVdpdGhHTFByb2dyYW0ocHJvZ3JhbSk7XHJcbiAgICAgICAgICAgIG5vZGUuc2V0R0xQcm9ncmFtU3RhdGUoZ2xQcm9ncmFtX3N0YXRlKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgbm9kZS5zZXRTaGFkZXJQcm9ncmFtKHByb2dyYW0pOyAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICBcclxuICAgICAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuO1xyXG4gICAgICAgIGlmICghY2hpbGRyZW4pXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgIFxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHRoaXMuc2V0UHJvZ3JhbShjaGlsZHJlbltpXSwgcHJvZ3JhbSk7XHJcbiAgICB9XHJcblxyXG59KTtcclxuIl19