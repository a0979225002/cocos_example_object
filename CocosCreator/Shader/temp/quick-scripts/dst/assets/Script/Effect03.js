
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Effect03.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '825950NkS1J8YHSJYAi7QiR', 'Effect03');
// Script/Effect03.js

"use strict";

var _default_vert = require("../Shaders/ccShader_Default_Vert.js");

var _default_vert_no_mvp = require("../Shaders/ccShader_Default_Vert_noMVP.js");

var _glass_frag = require("../Shaders/ccShader_Effect03_Frag.js");

cc.Class({
  "extends": cc.Component,
  properties: {
    glassFactor: 1.0
  },
  onLoad: function onLoad() {
    this.parameters = {
      startTime: Date.now(),
      time: 0.0,
      mouse: {
        x: 0.0,
        y: 0.0
      },
      resolution: {
        x: 0.0,
        y: 0.0
      }
    };
    this.node.on(cc.Node.EventType.MOUSE_MOVE, function (event) {
      this.parameters.mouse.x = this.node.getContentSize().width / event.getLocationX();
      this.parameters.mouse.y = this.node.getContentSize().height / event.getLocationY();
    }, this);
    this.node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {
      this.parameters.mouse.x = this.node.getContentSize().width / event.getLocationX();
      this.parameters.mouse.y = this.node.getContentSize().height / event.getLocationY();
    }, this);

    this._use();
  },
  update: function update(dt) {
    if (this.glassFactor >= 40) {
      this.glassFactor = 0;
    }

    this.glassFactor += dt * 3;

    if (this._program) {
      this._program.use();

      this.updateGLParameters();

      if (cc.sys.isNative) {
        var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);
        glProgram_state.setUniformVec2("resolution", this.parameters.resolution);
        glProgram_state.setUniformFloat("time", this.parameters.time);
        glProgram_state.setUniformVec2("mouse_touch", this.parameters.mouse);
      } else {
        this._program.setUniformLocationWith2f(this._resolution, this.parameters.resolution.x, this.parameters.resolution.y);

        this._program.setUniformLocationWith1f(this._time, this.parameters.time);

        this._program.setUniformLocationWith2f(this._mouse, this.parameters.mouse.x, this.parameters.mouse.x);
      }
    }
  },
  updateGLParameters: function updateGLParameters() {
    this.parameters.time = (Date.now() - this.parameters.startTime) / 1000;
    this.parameters.resolution.x = this.node.getContentSize().width;
    this.parameters.resolution.y = this.node.getContentSize().height;
  },
  _use: function _use() {
    if (cc.sys.isNative) {
      cc.log("use native GLProgram");
      this._program = new cc.GLProgram();

      this._program.initWithString(_default_vert_no_mvp, _glass_frag);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);

      this._program.link();

      this._program.updateUniforms();

      this.updateGLParameters();
    } else {
      this._program = new cc.GLProgram();

      this._program.initWithVertexShaderByteArray(_default_vert, _glass_frag);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);

      this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);

      this._program.link();

      this._program.updateUniforms();

      this._program.use();

      this.updateGLParameters();

      this._program.setUniformLocationWith1f(this._program.getUniformLocationForName('time'), this.parameters.time);

      this._program.setUniformLocationWith2f(this._program.getUniformLocationForName('mouse_touch'), this.parameters.mouse.x, this.parameters.mouse.y);

      this._program.setUniformLocationWith2f(this._program.getUniformLocationForName('resolution'), this.parameters.resolution.x, this.parameters.resolution.y);
    }

    if (cc.sys.isNative) {
      var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);
      glProgram_state.setUniformVec2("resolution", this.parameters.resolution);
      glProgram_state.setUniformFloat("time", this.parameters.time);
      glProgram_state.setUniformVec2("mouse_touch", this.parameters.mouse);
    } else {
      this._resolution = this._program.getUniformLocationForName("resolution");
      this._time = this._program.getUniformLocationForName("time");
      this._mouse = this._program.getUniformLocationForName("mouse_touch");

      this._program.setUniformLocationWith2f(this._resolution, this.parameters.resolution.x, this.parameters.resolution.y);

      this._program.setUniformLocationWith1f(this._time, this.parameters.time);

      this._program.setUniformLocationWith2f(this._mouse, this.parameters.mouse.x, this.parameters.mouse.y);
    }

    this.setProgram(this.node._sgNode, this._program);
  },
  setProgram: function setProgram(node, program) {
    if (cc.sys.isNative) {
      var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);
      node.setGLProgramState(glProgram_state);
    } else {
      node.setShaderProgram(program);
    }

    var children = node.children;
    if (!children) return;

    for (var i = 0; i < children.length; i++) {
      this.setProgram(children[i], program);
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxFZmZlY3QwMy5qcyJdLCJuYW1lcyI6WyJfZGVmYXVsdF92ZXJ0IiwicmVxdWlyZSIsIl9kZWZhdWx0X3ZlcnRfbm9fbXZwIiwiX2dsYXNzX2ZyYWciLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImdsYXNzRmFjdG9yIiwib25Mb2FkIiwicGFyYW1ldGVycyIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJ0aW1lIiwibW91c2UiLCJ4IiwieSIsInJlc29sdXRpb24iLCJub2RlIiwib24iLCJOb2RlIiwiRXZlbnRUeXBlIiwiTU9VU0VfTU9WRSIsImV2ZW50IiwiZ2V0Q29udGVudFNpemUiLCJ3aWR0aCIsImdldExvY2F0aW9uWCIsImhlaWdodCIsImdldExvY2F0aW9uWSIsIlRPVUNIX01PVkUiLCJfdXNlIiwidXBkYXRlIiwiZHQiLCJfcHJvZ3JhbSIsInVzZSIsInVwZGF0ZUdMUGFyYW1ldGVycyIsInN5cyIsImlzTmF0aXZlIiwiZ2xQcm9ncmFtX3N0YXRlIiwiR0xQcm9ncmFtU3RhdGUiLCJnZXRPckNyZWF0ZVdpdGhHTFByb2dyYW0iLCJzZXRVbmlmb3JtVmVjMiIsInNldFVuaWZvcm1GbG9hdCIsInNldFVuaWZvcm1Mb2NhdGlvbldpdGgyZiIsIl9yZXNvbHV0aW9uIiwic2V0VW5pZm9ybUxvY2F0aW9uV2l0aDFmIiwiX3RpbWUiLCJfbW91c2UiLCJsb2ciLCJHTFByb2dyYW0iLCJpbml0V2l0aFN0cmluZyIsImFkZEF0dHJpYnV0ZSIsIm1hY3JvIiwiQVRUUklCVVRFX05BTUVfUE9TSVRJT04iLCJWRVJURVhfQVRUUklCX1BPU0lUSU9OIiwiQVRUUklCVVRFX05BTUVfQ09MT1IiLCJWRVJURVhfQVRUUklCX0NPTE9SIiwiQVRUUklCVVRFX05BTUVfVEVYX0NPT1JEIiwiVkVSVEVYX0FUVFJJQl9URVhfQ09PUkRTIiwibGluayIsInVwZGF0ZVVuaWZvcm1zIiwiaW5pdFdpdGhWZXJ0ZXhTaGFkZXJCeXRlQXJyYXkiLCJnZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lIiwic2V0UHJvZ3JhbSIsIl9zZ05vZGUiLCJwcm9ncmFtIiwic2V0R0xQcm9ncmFtU3RhdGUiLCJzZXRTaGFkZXJQcm9ncmFtIiwiY2hpbGRyZW4iLCJpIiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLGFBQWEsR0FBR0MsT0FBTyxDQUFDLHFDQUFELENBQTNCOztBQUNBLElBQUlDLG9CQUFvQixHQUFHRCxPQUFPLENBQUMsMkNBQUQsQ0FBbEM7O0FBQ0EsSUFBSUUsV0FBVyxHQUFHRixPQUFPLENBQUMsc0NBQUQsQ0FBekI7O0FBRUFHLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxXQUFXLEVBQUM7QUFESixHQUhQO0FBT0xDLEVBQUFBLE1BQU0sRUFBRSxrQkFBWTtBQUNoQixTQUFLQyxVQUFMLEdBQWdCO0FBQ1pDLE1BQUFBLFNBQVMsRUFBQ0MsSUFBSSxDQUFDQyxHQUFMLEVBREU7QUFFWkMsTUFBQUEsSUFBSSxFQUFDLEdBRk87QUFHWkMsTUFBQUEsS0FBSyxFQUFDO0FBQ0ZDLFFBQUFBLENBQUMsRUFBQyxHQURBO0FBRUZDLFFBQUFBLENBQUMsRUFBQztBQUZBLE9BSE07QUFPWkMsTUFBQUEsVUFBVSxFQUFDO0FBQ1BGLFFBQUFBLENBQUMsRUFBQyxHQURLO0FBRVBDLFFBQUFBLENBQUMsRUFBQztBQUZLO0FBUEMsS0FBaEI7QUFhQSxTQUFLRSxJQUFMLENBQVVDLEVBQVYsQ0FBYWhCLEVBQUUsQ0FBQ2lCLElBQUgsQ0FBUUMsU0FBUixDQUFrQkMsVUFBL0IsRUFBMkMsVUFBVUMsS0FBVixFQUFpQjtBQUN4RCxXQUFLZCxVQUFMLENBQWdCSyxLQUFoQixDQUFzQkMsQ0FBdEIsR0FBMEIsS0FBS0csSUFBTCxDQUFVTSxjQUFWLEdBQTJCQyxLQUEzQixHQUFtQ0YsS0FBSyxDQUFD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R0FBR25DLEVBQUUsQ0FBQ29DLGNBQUgsQ0FBa0JDLHdCQUFsQixDQUEyQ3lCLE9BQTNDLENBQXRCO0FBQ0EvQyxNQUFBQSxJQUFJLENBQUNnRCxpQkFBTCxDQUF1QjVCLGVBQXZCO0FBQ0gsS0FIRCxNQUdLO0FBQ0RwQixNQUFBQSxJQUFJLENBQUNpRCxnQkFBTCxDQUFzQkYsT0FBdEI7QUFDSDs7QUFHRCxRQUFJRyxRQUFRLEdBQUdsRCxJQUFJLENBQUNrRCxRQUFwQjtBQUNBLFFBQUksQ0FBQ0EsUUFBTCxFQUNJOztBQUVKLFNBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0QsUUFBUSxDQUFDRSxNQUE3QixFQUFxQ0QsQ0FBQyxFQUF0QztBQUNJLFdBQUtOLFVBQUwsQ0FBZ0JLLFFBQVEsQ0FBQ0MsQ0FBRCxDQUF4QixFQUE2QkosT0FBN0I7QUFESjtBQUVIO0FBNUlJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBfZGVmYXVsdF92ZXJ0ID0gcmVxdWlyZShcIi4uL1NoYWRlcnMvY2NTaGFkZXJfRGVmYXVsdF9WZXJ0LmpzXCIpO1xyXG52YXIgX2RlZmF1bHRfdmVydF9ub19tdnAgPSByZXF1aXJlKFwiLi4vU2hhZGVycy9jY1NoYWRlcl9EZWZhdWx0X1ZlcnRfbm9NVlAuanNcIik7XHJcbnZhciBfZ2xhc3NfZnJhZyA9IHJlcXVpcmUoXCIuLi9TaGFkZXJzL2NjU2hhZGVyX0VmZmVjdDAzX0ZyYWcuanNcIik7XHJcblxyXG5jYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGdsYXNzRmFjdG9yOjEuMCxcclxuICAgIH0sXHJcblxyXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzPXtcclxuICAgICAgICAgICAgc3RhcnRUaW1lOkRhdGUubm93KCksXHJcbiAgICAgICAgICAgIHRpbWU6MC4wLFxyXG4gICAgICAgICAgICBtb3VzZTp7XHJcbiAgICAgICAgICAgICAgICB4OjAuMCxcclxuICAgICAgICAgICAgICAgIHk6MC4wLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXNvbHV0aW9uOntcclxuICAgICAgICAgICAgICAgIHg6MC4wLFxyXG4gICAgICAgICAgICAgICAgeTowLjAsXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuTU9VU0VfTU9WRSwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFyYW1ldGVycy5tb3VzZS54ID0gdGhpcy5ub2RlLmdldENvbnRlbnRTaXplKCkud2lkdGggLyBldmVudC5nZXRMb2NhdGlvblgoKTtcclxuICAgICAgICAgICAgdGhpcy5wYXJhbWV0ZXJzLm1vdXNlLnkgPSB0aGlzLm5vZGUuZ2V0Q29udGVudFNpemUoKS5oZWlnaHQgLyBldmVudC5nZXRMb2NhdGlvblkoKTsgXHJcbiAgICAgICAgfSwgdGhpcyk7XHJcblxyXG5cclxuICAgICAgICB0aGlzLm5vZGUub24oIGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLnBhcmFtZXRlcnMubW91c2UueCA9IHRoaXMubm9kZS5nZXRDb250ZW50U2l6ZSgpLndpZHRoIC8gZXZlbnQuZ2V0TG9jYXRpb25YKCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFyYW1ldGVycy5tb3VzZS55ID0gdGhpcy5ub2RlLmdldENvbnRlbnRTaXplKCkuaGVpZ2h0IC8gZXZlbnQuZ2V0TG9jYXRpb25ZKCk7IFxyXG4gICAgICAgIH0sIHRoaXMpO1xyXG5cclxuICAgICAgICB0aGlzLl91c2UoKTtcclxuICAgIH0sXHJcbiAgICB1cGRhdGU6ZnVuY3Rpb24oZHQpe1xyXG4gICAgICAgIGlmKHRoaXMuZ2xhc3NGYWN0b3I+PTQwKXtcclxuICAgICAgICAgICAgdGhpcy5nbGFzc0ZhY3Rvcj0wO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdsYXNzRmFjdG9yKz1kdCozO1xyXG5cclxuICAgICAgICBpZih0aGlzLl9wcm9ncmFtKXtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0udXNlKCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR0xQYXJhbWV0ZXJzKCk7XHJcbiAgICAgICAgICAgIGlmKGNjLnN5cy5pc05hdGl2ZSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ2xQcm9ncmFtX3N0YXRlID0gY2MuR0xQcm9ncmFtU3RhdGUuZ2V0T3JDcmVhdGVXaXRoR0xQcm9ncmFtKHRoaXMuX3Byb2dyYW0pO1xyXG4gICAgICAgICAgICAgICAgZ2xQcm9ncmFtX3N0YXRlLnNldFVuaWZvcm1WZWMyKCBcInJlc29sdXRpb25cIiwgdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24gKTtcclxuICAgICAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtRmxvYXQoIFwidGltZVwiLCB0aGlzLnBhcmFtZXRlcnMudGltZSApOyAgICBcclxuICAgICAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtVmVjMiggXCJtb3VzZV90b3VjaFwiICwgdGhpcy5wYXJhbWV0ZXJzLm1vdXNlICk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoMmYoIHRoaXMuX3Jlc29sdXRpb24sIHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uLngsdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24ueSApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoMWYoIHRoaXMuX3RpbWUsIHRoaXMucGFyYW1ldGVycy50aW1lICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgyZiggdGhpcy5fbW91c2UsIHRoaXMucGFyYW1ldGVycy5tb3VzZS54LHRoaXMucGFyYW1ldGVycy5tb3VzZS54ICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgdXBkYXRlR0xQYXJhbWV0ZXJzKCl7XHJcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzLnRpbWUgPSAoRGF0ZS5ub3coKSAtIHRoaXMucGFyYW1ldGVycy5zdGFydFRpbWUpLzEwMDA7XHJcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24ueCA9ICggdGhpcy5ub2RlLmdldENvbnRlbnRTaXplKCkud2lkdGggKTtcclxuICAgICAgICB0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbi55ID0gKCB0aGlzLm5vZGUuZ2V0Q29udGVudFNpemUoKS5oZWlnaHQgKTtcclxuXHJcblxyXG4gICAgfSxcclxuXHJcbiAgICBfdXNlOiBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xyXG4gICAgICAgICAgICBjYy5sb2coXCJ1c2UgbmF0aXZlIEdMUHJvZ3JhbVwiKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbSA9IG5ldyBjYy5HTFByb2dyYW0oKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5pbml0V2l0aFN0cmluZyhfZGVmYXVsdF92ZXJ0X25vX212cCwgX2dsYXNzX2ZyYWcpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uYWRkQXR0cmlidXRlKGNjLm1hY3JvLkFUVFJJQlVURV9OQU1FX1BPU0lUSU9OLCBjYy5tYWNyby5WRVJURVhfQVRUUklCX1BPU0lUSU9OKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5hZGRBdHRyaWJ1dGUoY2MubWFjcm8uQVRUUklCVVRFX05BTUVfQ09MT1IsIGNjLm1hY3JvLlZFUlRFWF9BVFRSSUJfQ09MT1IpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmFkZEF0dHJpYnV0ZShjYy5tYWNyby5BVFRSSUJVVEVfTkFNRV9URVhfQ09PUkQsIGNjLm1hY3JvLlZFUlRFWF9BVFRSSUJfVEVYX0NPT1JEUyk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmxpbmsoKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS51cGRhdGVVbmlmb3JtcygpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdMUGFyYW1ldGVycygpO1xyXG5cclxuXHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0gPSBuZXcgY2MuR0xQcm9ncmFtKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uaW5pdFdpdGhWZXJ0ZXhTaGFkZXJCeXRlQXJyYXkoX2RlZmF1bHRfdmVydCwgX2dsYXNzX2ZyYWcpO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLmFkZEF0dHJpYnV0ZShjYy5tYWNyby5BVFRSSUJVVEVfTkFNRV9QT1NJVElPTiwgY2MubWFjcm8uVkVSVEVYX0FUVFJJQl9QT1NJVElPTik7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uYWRkQXR0cmlidXRlKGNjLm1hY3JvLkFUVFJJQlVURV9OQU1FX0NPTE9SLCBjYy5tYWNyby5WRVJURVhfQVRUUklCX0NPTE9SKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5hZGRBdHRyaWJ1dGUoY2MubWFjcm8uQVRUUklCVVRFX05BTUVfVEVYX0NPT1JELCBjYy5tYWNyby5WRVJURVhfQVRUUklCX1RFWF9DT09SRFMpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5saW5rKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0udXBkYXRlVW5pZm9ybXMoKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS51c2UoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR0xQYXJhbWV0ZXJzKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgxZiggdGhpcy5fcHJvZ3JhbS5nZXRVbmlmb3JtTG9jYXRpb25Gb3JOYW1lKCd0aW1lJyksIHRoaXMucGFyYW1ldGVycy50aW1lICk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uc2V0VW5pZm9ybUxvY2F0aW9uV2l0aDJmKCB0aGlzLl9wcm9ncmFtLmdldFVuaWZvcm1Mb2NhdGlvbkZvck5hbWUoJ21vdXNlX3RvdWNoJyksIHRoaXMucGFyYW1ldGVycy5tb3VzZS54LHRoaXMucGFyYW1ldGVycy5tb3VzZS55ICk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2dyYW0uc2V0VW5pZm9ybUxvY2F0aW9uV2l0aDJmKHRoaXMuX3Byb2dyYW0uZ2V0VW5pZm9ybUxvY2F0aW9uRm9yTmFtZSgncmVzb2x1dGlvbicpLCB0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbi54LHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uLnkgKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBcclxuXHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xyXG4gICAgICAgICAgICB2YXIgZ2xQcm9ncmFtX3N0YXRlID0gY2MuR0xQcm9ncmFtU3RhdGUuZ2V0T3JDcmVhdGVXaXRoR0xQcm9ncmFtKHRoaXMuX3Byb2dyYW0pO1xyXG4gICAgICAgICAgICBnbFByb2dyYW1fc3RhdGUuc2V0VW5pZm9ybVZlYzIoIFwicmVzb2x1dGlvblwiLCB0aGlzLnBhcmFtZXRlcnMucmVzb2x1dGlvbiApO1xyXG4gICAgICAgICAgICBnbFByb2dyYW1fc3RhdGUuc2V0VW5pZm9ybUZsb2F0KCBcInRpbWVcIiAsIHRoaXMucGFyYW1ldGVycy50aW1lICk7XHJcbiAgICAgICAgICAgIGdsUHJvZ3JhbV9zdGF0ZS5zZXRVbmlmb3JtVmVjMiggXCJtb3VzZV90b3VjaFwiICwgdGhpcy5wYXJhbWV0ZXJzLm1vdXNlICk7XHJcbiAgICAgICAgfWVsc2V7XHJcblxyXG5cclxuICAgICAgICAgICAgdGhpcy5fcmVzb2x1dGlvbiA9IHRoaXMuX3Byb2dyYW0uZ2V0VW5pZm9ybUxvY2F0aW9uRm9yTmFtZSggXCJyZXNvbHV0aW9uXCIgKTtcclxuICAgICAgICAgICAgdGhpcy5fdGltZSA9IHRoaXMuX3Byb2dyYW0uZ2V0VW5pZm9ybUxvY2F0aW9uRm9yTmFtZSggXCJ0aW1lXCIgKTtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2UgPSB0aGlzLl9wcm9ncmFtLmdldFVuaWZvcm1Mb2NhdGlvbkZvck5hbWUoIFwibW91c2VfdG91Y2hcIiApO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoMmYoIHRoaXMuX3Jlc29sdXRpb24sIHRoaXMucGFyYW1ldGVycy5yZXNvbHV0aW9uLngsdGhpcy5wYXJhbWV0ZXJzLnJlc29sdXRpb24ueSApO1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9ncmFtLnNldFVuaWZvcm1Mb2NhdGlvbldpdGgxZiggdGhpcy5fdGltZSwgdGhpcy5wYXJhbWV0ZXJzLnRpbWUgKTtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZ3JhbS5zZXRVbmlmb3JtTG9jYXRpb25XaXRoMmYoIHRoaXMuX21vdXNlLCB0aGlzLnBhcmFtZXRlcnMubW91c2UueCx0aGlzLnBhcmFtZXRlcnMubW91c2UueSApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zZXRQcm9ncmFtKCB0aGlzLm5vZGUuX3NnTm9kZSAsdGhpcy5fcHJvZ3JhbSApO1xyXG4gICAgfSxcclxuICAgIFxyXG4gICAgc2V0UHJvZ3JhbTpmdW5jdGlvbiAobm9kZSwgcHJvZ3JhbSkge1xyXG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcclxuICAgICAgICAgICAgdmFyIGdsUHJvZ3JhbV9zdGF0ZSA9IGNjLkdMUHJvZ3JhbVN0YXRlLmdldE9yQ3JlYXRlV2l0aEdMUHJvZ3JhbShwcm9ncmFtKTtcclxuICAgICAgICAgICAgbm9kZS5zZXRHTFByb2dyYW1TdGF0ZShnbFByb2dyYW1fc3RhdGUpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBub2RlLnNldFNoYWRlclByb2dyYW0ocHJvZ3JhbSk7ICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIFxyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47XHJcbiAgICAgICAgaWYgKCFjaGlsZHJlbilcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgdGhpcy5zZXRQcm9ncmFtKGNoaWxkcmVuW2ldLCBwcm9ncmFtKTtcclxuICAgIH1cclxuXHJcbn0pO1xyXG4iXX0=