{"version":3,"sources":["assets\\Script\\EffectCommon.js"],"names":["_default_vert","require","_default_vert_no_mvp","cc","Class","Component","properties","glassFactor","flagShader","frag_glsl","visible","onLoad","self","parameters","startTime","Date","now","time","mouse","x","y","resolution","node","on","Node","EventType","MOUSE_MOVE","event","getContentSize","width","getLocationX","height","getLocationY","TOUCH_MOVE","loader","loadRes","err","txt","log","_use","update","dt","_program","use","updateGLParameters","sys","isNative","glProgram_state","GLProgramState","getOrCreateWithGLProgram","setUniformVec2","setUniformFloat","setUniformLocationWith2f","_resolution","setUniformLocationWith1f","_time","_mouse","GLProgram","initWithString","addAttribute","macro","ATTRIBUTE_NAME_POSITION","VERTEX_ATTRIB_POSITION","ATTRIBUTE_NAME_COLOR","VERTEX_ATTRIB_COLOR","ATTRIBUTE_NAME_TEX_COORD","VERTEX_ATTRIB_TEX_COORDS","link","updateUniforms","initWithVertexShaderByteArray","getUniformLocationForName","setProgram","_sgNode","program","setGLProgramState","setShaderProgram","children","i","length"],"mappings":"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","sourceRoot":"/","sourcesContent":["var _default_vert = require(\"../Shaders/ccShader_Default_Vert.js\");\r\nvar _default_vert_no_mvp = require(\"../Shaders/ccShader_Default_Vert_noMVP.js\");\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        glassFactor:1.0,\r\n        flagShader:\"\",\r\n        frag_glsl:{\r\n            default:\"Effect10.fs.glsl\",\r\n            visible:false,\r\n        }\r\n    }, \r\n\r\n    onLoad: function () {\r\n        var self = this;\r\n        this.parameters={\r\n            startTime:Date.now(),\r\n            time:0.0,\r\n            mouse:{\r\n                x:0.0,\r\n                y:0.0,\r\n            },\r\n            resolution:{\r\n                x:0.0,\r\n                y:0.0,\r\n            }\r\n\r\n        };\r\n        this.node.on(cc.Node.EventType.MOUSE_MOVE, function (event) {\r\n            this.parameters.mouse.x = this.node.getContentSize().width / event.getLocationX();\r\n            this.parameters.mouse.y = this.node.getContentSize().height / event.getLocationY(); \r\n        }, this);\r\n\r\n\r\n        this.node.on( cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n            this.parameters.mouse.x = this.node.getContentSize().width / event.getLocationX();\r\n            this.parameters.mouse.y = this.node.getContentSize().height / event.getLocationY(); \r\n        }, this);\r\n\r\n        cc.loader.loadRes(self.flagShader,function(err,txt){\r\n            if(err){\r\n                cc.log(err)\r\n            }else{\r\n                self.frag_glsl = txt;\r\n                self._use();\r\n            }\r\n        });\r\n\r\n    },\r\n    update:function(dt){\r\n        if(this.glassFactor>=40){\r\n            this.glassFactor=0;\r\n        }\r\n        this.glassFactor+=dt*3;\r\n\r\n        if(this._program){\r\n\r\n            this._program.use();\r\n            this.updateGLParameters();\r\n            if(cc.sys.isNative){\r\n                var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n                glProgram_state.setUniformVec2( \"resolution\", this.parameters.resolution );\r\n                glProgram_state.setUniformFloat( \"time\", this.parameters.time );    \r\n                glProgram_state.setUniformVec2( \"mouse\" , this.parameters.mouse );\r\n            }else{\r\n                this._program.setUniformLocationWith2f( this._resolution, this.parameters.resolution.x,this.parameters.resolution.y );\r\n                this._program.setUniformLocationWith1f( this._time, this.parameters.time );\r\n                this._program.setUniformLocationWith2f( this._mouse, this.parameters.mouse.x,this.parameters.mouse.x );\r\n            }\r\n        }\r\n    },\r\n    updateGLParameters(){\r\n        this.parameters.time = (Date.now() - this.parameters.startTime)/1000;\r\n        this.parameters.resolution.x = ( this.node.getContentSize().width );\r\n        this.parameters.resolution.y = ( this.node.getContentSize().height );\r\n\r\n\r\n    },\r\n\r\n    _use: function()\r\n    {\r\n        \r\n        if (cc.sys.isNative) {\r\n            cc.log(\"use native GLProgram\");\r\n            this._program = new cc.GLProgram();\r\n            this._program.initWithString(_default_vert_no_mvp, this.frag_glsl );\r\n\r\n\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\r\n\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n            this.updateGLParameters();\r\n\r\n\r\n           \r\n        }else{\r\n            this._program = new cc.GLProgram();\r\n            this._program.initWithVertexShaderByteArray(_default_vert, this.frag_glsl );\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\r\n\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n            this._program.use();\r\n\r\n            this.updateGLParameters();\r\n\r\n            this._program.setUniformLocationWith1f( this._program.getUniformLocationForName('time'), this.parameters.time );\r\n            this._program.setUniformLocationWith2f( this._program.getUniformLocationForName('mouse'), this.parameters.mouse.x,this.parameters.mouse.y );\r\n            this._program.setUniformLocationWith2f(this._program.getUniformLocationForName('resolution'), this.parameters.resolution.x,this.parameters.resolution.y );\r\n\r\n        }\r\n\r\n        \r\n\r\n        \r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n            glProgram_state.setUniformVec2( \"resolution\", this.parameters.resolution );\r\n            glProgram_state.setUniformFloat( \"time\" , this.parameters.time );\r\n            glProgram_state.setUniformVec2( \"mouse\" , this.parameters.mouse );\r\n        }else{\r\n\r\n\r\n            this._resolution = this._program.getUniformLocationForName( \"resolution\" );\r\n            this._time = this._program.getUniformLocationForName( \"time\" );\r\n            this._mouse = this._program.getUniformLocationForName( \"mouse\" );\r\n\r\n            this._program.setUniformLocationWith2f( this._resolution, this.parameters.resolution.x,this.parameters.resolution.y );\r\n            this._program.setUniformLocationWith1f( this._time, this.parameters.time );\r\n            this._program.setUniformLocationWith2f( this._mouse, this.parameters.mouse.x,this.parameters.mouse.y );\r\n        }\r\n\r\n        this.setProgram( this.node._sgNode ,this._program );\r\n    },\r\n    \r\n    setProgram:function (node, program) {\r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);\r\n            node.setGLProgramState(glProgram_state);\r\n        }else{\r\n            node.setShaderProgram(program);    \r\n        }\r\n        \r\n    \r\n        var children = node.children;\r\n        if (!children)\r\n            return;\r\n    \r\n        for (var i = 0; i < children.length; i++)\r\n            this.setProgram(children[i], program);\r\n    }\r\n\r\n});\r\n"]}