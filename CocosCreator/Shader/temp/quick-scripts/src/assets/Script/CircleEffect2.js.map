{"version":3,"sources":["assets\\Script\\CircleEffect2.js"],"names":["_default_vert","require","_default_vert_no_mvp","_glass_frag","cc","Class","Component","properties","glassFactor","onLoad","parameters","startTime","Date","now","time","mouse","x","y","resolution","node","on","Node","EventType","MOUSE_MOVE","event","getContentSize","width","getLocationX","height","getLocationY","TOUCH_MOVE","_use","update","dt","_program","use","updateGLParameters","sys","isNative","glProgram_state","GLProgramState","getOrCreateWithGLProgram","setUniformVec2","setUniformFloat","setUniformLocationWith2f","_resolution","setUniformLocationWith1f","_time","_mouse","log","GLProgram","initWithString","addAttribute","macro","ATTRIBUTE_NAME_POSITION","VERTEX_ATTRIB_POSITION","ATTRIBUTE_NAME_COLOR","VERTEX_ATTRIB_COLOR","ATTRIBUTE_NAME_TEX_COORD","VERTEX_ATTRIB_TEX_COORDS","link","updateUniforms","initWithVertexShaderByteArray","getUniformLocationForName","setProgram","_sgNode","program","setGLProgramState","setShaderProgram","children","i","length"],"mappings":"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","sourceRoot":"/","sourcesContent":["var _default_vert = require(\"../Shaders/ccShader_Default_Vert.js\");\r\nvar _default_vert_no_mvp = require(\"../Shaders/ccShader_Default_Vert_noMVP.js\");\r\nvar _glass_frag = require(\"../Shaders/ccShader_Circle_Effect2_Frag.js\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        glassFactor:1.0,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.parameters={\r\n            startTime:Date.now(),\r\n            time:0.0,\r\n            mouse:{\r\n                x:0.0,\r\n                y:0.0,\r\n            },\r\n            resolution:{\r\n                x:0.0,\r\n                y:0.0,\r\n            }\r\n\r\n        };\r\n        this.node.on(cc.Node.EventType.MOUSE_MOVE, function (event) {\r\n            this.parameters.mouse.x = this.node.getContentSize().width / event.getLocationX();\r\n            this.parameters.mouse.y = this.node.getContentSize().height / event.getLocationY(); \r\n        }, this);\r\n\r\n\r\n        this.node.on( cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n            this.parameters.mouse.x = this.node.getContentSize().width / event.getLocationX();\r\n            this.parameters.mouse.y = this.node.getContentSize().height / event.getLocationY(); \r\n        }, this);\r\n\r\n        this._use();\r\n    },\r\n    update:function(dt){\r\n        if(this.glassFactor>=40){\r\n            this.glassFactor=0;\r\n        }\r\n        this.glassFactor+=dt*3;\r\n\r\n        if(this._program){\r\n\r\n            this._program.use();\r\n            this.updateGLParameters();\r\n            if(cc.sys.isNative){\r\n                var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n                glProgram_state.setUniformVec2( \"resolution\", this.parameters.resolution );\r\n                glProgram_state.setUniformFloat( \"time\", this.parameters.time );    \r\n                glProgram_state.setUniformVec2( \"mouse_touch\" , this.parameters.mouse );\r\n            }else{\r\n                this._program.setUniformLocationWith2f( this._resolution, this.parameters.resolution.x,this.parameters.resolution.y );\r\n                this._program.setUniformLocationWith1f( this._time, this.parameters.time );\r\n                this._program.setUniformLocationWith2f( this._mouse, this.parameters.mouse.x,this.parameters.mouse.x );\r\n            }\r\n        }\r\n    },\r\n    updateGLParameters(){\r\n        this.parameters.time = (Date.now() - this.parameters.startTime)/1000;\r\n        this.parameters.resolution.x = ( this.node.getContentSize().width );\r\n        this.parameters.resolution.y = ( this.node.getContentSize().height );\r\n\r\n\r\n    },\r\n\r\n    _use: function()\r\n    {\r\n        \r\n        if (cc.sys.isNative) {\r\n            cc.log(\"use native GLProgram\");\r\n            this._program = new cc.GLProgram();\r\n            this._program.initWithString(_default_vert_no_mvp, _glass_frag);\r\n\r\n\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\r\n\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n            this.updateGLParameters();\r\n\r\n\r\n           \r\n        }else{\r\n            this._program = new cc.GLProgram();\r\n            this._program.initWithVertexShaderByteArray(_default_vert, _glass_frag);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\r\n\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n            this._program.use();\r\n\r\n            this.updateGLParameters();\r\n\r\n            this._program.setUniformLocationWith1f( this._program.getUniformLocationForName('time'), this.parameters.time );\r\n            this._program.setUniformLocationWith2f( this._program.getUniformLocationForName('mouse_touch'), this.parameters.mouse.x,this.parameters.mouse.y );\r\n            this._program.setUniformLocationWith2f(this._program.getUniformLocationForName('resolution'), this.parameters.resolution.x,this.parameters.resolution.y );\r\n\r\n        }\r\n\r\n        \r\n\r\n        \r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n            glProgram_state.setUniformVec2( \"resolution\", this.parameters.resolution );\r\n            glProgram_state.setUniformFloat( \"time\" , this.parameters.time );\r\n            glProgram_state.setUniformVec2( \"mouse_touch\" , this.parameters.mouse );\r\n        }else{\r\n\r\n\r\n            this._resolution = this._program.getUniformLocationForName( \"resolution\" );\r\n            this._time = this._program.getUniformLocationForName( \"time\" );\r\n            this._mouse = this._program.getUniformLocationForName( \"mouse_touch\" );\r\n\r\n            this._program.setUniformLocationWith2f( this._resolution, this.parameters.resolution.x,this.parameters.resolution.y );\r\n            this._program.setUniformLocationWith1f( this._time, this.parameters.time );\r\n            this._program.setUniformLocationWith2f( this._mouse, this.parameters.mouse.x,this.parameters.mouse.y );\r\n        }\r\n\r\n        this.setProgram( this.node._sgNode ,this._program );\r\n    },\r\n    \r\n    setProgram:function (node, program) {\r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);\r\n            node.setGLProgramState(glProgram_state);\r\n        }else{\r\n            node.setShaderProgram(program);    \r\n        }\r\n        \r\n    \r\n        var children = node.children;\r\n        if (!children)\r\n            return;\r\n    \r\n        for (var i = 0; i < children.length; i++)\r\n            this.setProgram(children[i], program);\r\n    }\r\n\r\n});\r\n"]}