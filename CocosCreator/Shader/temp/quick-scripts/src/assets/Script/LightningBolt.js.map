{"version":3,"sources":["assets\\Script\\LightningBolt.js"],"names":["_default_vert","require","_default_vert_no_mvp","_lightningBolt_frag","cc","Class","Component","properties","glassFactor","onLoad","_use","update","dt","sys","isNative","log","_program","GLProgram","initWithString","link","updateUniforms","initWithVertexShaderByteArray","addAttribute","macro","ATTRIBUTE_NAME_POSITION","VERTEX_ATTRIB_POSITION","ATTRIBUTE_NAME_COLOR","VERTEX_ATTRIB_COLOR","ATTRIBUTE_NAME_TEX_COORD","VERTEX_ATTRIB_TEX_COORDS","_u_opacity","getUniformLocationForName","_uniWidthStep","_uniHeightStep","_uniBlurRadiusScale","glProgram_state","GLProgramState","getOrCreateWithGLProgram","setProgram","node","_sgNode","program","setGLProgramState","setShaderProgram","children","i","length"],"mappings":"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","sourceRoot":"/","sourcesContent":["var _default_vert = require(\"../Shaders/ccShader_lightningBolt_Vert.js\");\r\nvar _default_vert_no_mvp = require(\"../Shaders/ccShader_Default_Vert_noMVP.js\");\r\nvar _lightningBolt_frag = require(\"../Shaders/ccShader_lightningBolt_Frag.js\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        glassFactor:1.0,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this._use();\r\n    },\r\n    update:function(dt){\r\n        // if(this.glassFactor>=40){\r\n        //     this.glassFactor=0;\r\n        // }\r\n        // this.glassFactor+=dt*3;\r\n\r\n\r\n        // if(this._program){\r\n        //     if(cc.sys.isNative){\r\n        //         var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n        //         glProgram_state.setUniformFloat( this._uniBlurRadiusScale ,this.glassFactor);\r\n        //     }else{\r\n        //         this._program.setUniformLocationWith1f( this._uniBlurRadiusScale, this.glassFactor );    \r\n        //     }\r\n        // }\r\n    },\r\n\r\n    _use: function()\r\n    {\r\n        \r\n        if (cc.sys.isNative) {\r\n            cc.log(\"use native GLProgram\")\r\n            this._program = new cc.GLProgram();\r\n            this._program.initWithString(_default_vert_no_mvp, _lightningBolt_frag);\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n            \r\n        }else{\r\n            this._program = new cc.GLProgram();\r\n            this._program.initWithVertexShaderByteArray(_default_vert, _lightningBolt_frag);\r\n            \r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n        }\r\n\r\n        this._u_opacity = this._program.getUniformLocationForName(\"u_opacity\");\r\n        \r\n        cc.log(this._u_opacity);\r\n\r\n        this._uniWidthStep = this._program.getUniformLocationForName( \"widthStep\" );\r\n        this._uniHeightStep = this._program.getUniformLocationForName( \"heightStep\" );\r\n        this._uniBlurRadiusScale = this._program.getUniformLocationForName( \"blurRadiusScale\" );\r\n        \r\n        \r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n            // glProgram_state.setUniformFloat( this._uniWidthStep , ( 1.0 / this.node.getContentSize().width ) );\r\n            // glProgram_state.setUniformFloat( this._uniHeightStep , ( 1.0 / this.node.getContentSize().height ) );\r\n            // glProgram_state.setUniformFloat( this._uniBlurRadiusScale ,this.glassFactor);\r\n        }else{\r\n            // this._program.setUniformLocationWith1f( this._uniWidthStep, ( 1.0 / this.node.getContentSize().width ) );\r\n            // this._program.setUniformLocationWith1f( this._uniHeightStep, ( 1.0 / this.node.getContentSize().height ) );\r\n            // this._program.setUniformLocationWith1f( this._uniBlurRadiusScale, this.glassFactor );\r\n        }\r\n        \r\n        this.setProgram( this.node._sgNode ,this._program );\r\n    },\r\n    \r\n    setProgram:function (node, program) {\r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);\r\n            node.setGLProgramState(glProgram_state);\r\n        }else{\r\n            node.setShaderProgram(program);    \r\n        }\r\n        \r\n    \r\n        var children = node.children;\r\n        if (!children)\r\n            return;\r\n    \r\n        for (var i = 0; i < children.length; i++)\r\n            this.setProgram(children[i], program);\r\n    }\r\n\r\n});\r\n"]}