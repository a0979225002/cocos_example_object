{"version":3,"sources":["assets\\Script\\Glass.js"],"names":["_default_vert","require","_default_vert_no_mvp","_glass_frag","cc","Class","Component","properties","glassFactor","onLoad","_use","update","dt","_program","use","sys","isNative","glProgram_state","GLProgramState","getOrCreateWithGLProgram","setUniformFloat","setUniformLocationWith1f","_uniBlurRadiusScale","GLProgram","initWithString","link","updateUniforms","initWithVertexShaderByteArray","addAttribute","macro","ATTRIBUTE_NAME_POSITION","VERTEX_ATTRIB_POSITION","ATTRIBUTE_NAME_COLOR","VERTEX_ATTRIB_COLOR","ATTRIBUTE_NAME_TEX_COORD","VERTEX_ATTRIB_TEX_COORDS","node","getContentSize","width","height","_uniWidthStep","getUniformLocationForName","_uniHeightStep","setProgram","_sgNode","program","setGLProgramState","setShaderProgram","children","i","length"],"mappings":"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","sourceRoot":"/","sourcesContent":["var _default_vert = require(\"../Shaders/ccShader_Default_Vert.js\");\r\nvar _default_vert_no_mvp = require(\"../Shaders/ccShader_Default_Vert_noMVP.js\");\r\nvar _glass_frag = require(\"../Shaders/ccShader_Glass_Frag.js\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        glassFactor:1.0,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this._use();\r\n    },\r\n    update:function(dt){\r\n        if(this.glassFactor>=40){\r\n            this.glassFactor=0;\r\n        }\r\n        this.glassFactor+=dt*3;\r\n\r\n        if(this._program){\r\n\r\n            this._program.use();\r\n            if(cc.sys.isNative){\r\n                var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n                glProgram_state.setUniformFloat( \"blurRadiusScale\" ,this.glassFactor);\r\n            }else{\r\n                this._program.setUniformLocationWith1f( this._uniBlurRadiusScale, this.glassFactor );\r\n            }\r\n        }\r\n    },\r\n\r\n    _use: function()\r\n    {\r\n        \r\n        this._program = new cc.GLProgram();\r\n        if (cc.sys.isNative) {\r\n            this._program.initWithString(_default_vert_no_mvp, _glass_frag);\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n            \r\n        }else{\r\n            this._program.initWithVertexShaderByteArray(_default_vert, _glass_frag);\r\n            \r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n            this._program.use();\r\n        }\r\n        \r\n        \r\n        \r\n        \r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n            glProgram_state.setUniformFloat( \"widthStep\" , ( 1.0 / this.node.getContentSize().width ) );\r\n            glProgram_state.setUniformFloat( \"heightStep\" , ( 1.0 / this.node.getContentSize().height ) );\r\n            glProgram_state.setUniformFloat( \"blurRadiusScale\" ,this.glassFactor);\r\n        }else{\r\n\r\n\r\n            this._uniWidthStep = this._program.getUniformLocationForName( \"widthStep\" );\r\n            this._uniHeightStep = this._program.getUniformLocationForName( \"heightStep\" );\r\n            this._uniBlurRadiusScale = this._program.getUniformLocationForName( \"blurRadiusScale\" );\r\n\r\n            this._program.setUniformLocationWith1f( this._uniWidthStep, ( 1.0 / this.node.getContentSize().width ) );\r\n            this._program.setUniformLocationWith1f( this._uniHeightStep, ( 1.0 / this.node.getContentSize().height ) );\r\n            this._program.setUniformLocationWith1f( this._uniBlurRadiusScale, this.glassFactor );\r\n        }\r\n\r\n        this.setProgram( this.node._sgNode ,this._program );\r\n    },\r\n    \r\n    setProgram:function (node, program) {\r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);\r\n            node.setGLProgramState(glProgram_state);\r\n        }else{\r\n            node.setShaderProgram(program);    \r\n        }\r\n        \r\n    \r\n        var children = node.children;\r\n        if (!children)\r\n            return;\r\n    \r\n        for (var i = 0; i < children.length; i++)\r\n            this.setProgram(children[i], program);\r\n    }\r\n\r\n});\r\n"]}