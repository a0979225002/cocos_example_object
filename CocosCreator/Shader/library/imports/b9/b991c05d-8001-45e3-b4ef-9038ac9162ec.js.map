{"version":3,"sources":["assets\\Script\\Wave_VH.js"],"names":["_default_vert","require","_default_vert_no_mvp","_wave_vh_frag","cc","Class","Component","properties","onLoad","_angle","_motion","_use","_program","GLProgram","sys","isNative","log","initWithString","link","updateUniforms","initWithVertexShaderByteArray","addAttribute","macro","ATTRIBUTE_NAME_POSITION","VERTEX_ATTRIB_POSITION","ATTRIBUTE_NAME_COLOR","VERTEX_ATTRIB_COLOR","ATTRIBUTE_NAME_TEX_COORD","VERTEX_ATTRIB_TEX_COORDS","_uniMotion","getUniformLocationForName","_uniAngle","glProgram_state","GLProgramState","getOrCreateWithGLProgram","setUniformFloat","setUniformLocationWith1f","setProgram","node","_sgNode","program","setGLProgramState","setShaderProgram","children","i","length","update","dt","use"],"mappings":"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","sourceRoot":"/","sourcesContent":["var _default_vert = require(\"../Shaders/ccShader_Default_Vert.js\");\r\nvar _default_vert_no_mvp = require(\"../Shaders/ccShader_Default_Vert_noMVP.js\");\r\nvar _wave_vh_frag = require(\"../Shaders/ccShader_Wave_VH_Frag.js\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n            \r\n    },\r\n\r\n    onLoad: function () {\r\n        this._angle = 15;\r\n        this._motion = 0;\r\n        \r\n        this._use();\r\n    },\r\n\r\n    _use: function()\r\n    {\r\n        this._program = new cc.GLProgram();\r\n        if (cc.sys.isNative) {\r\n            cc.log(\"use native GLProgram\")\r\n            this._program.initWithString(_default_vert_no_mvp, _wave_vh_frag);\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n        }else{\r\n            this._program.initWithVertexShaderByteArray(_default_vert, _wave_vh_frag);\r\n\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\r\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\r\n            this._program.link();\r\n            this._program.updateUniforms();\r\n        }\r\n        \r\n        this._uniMotion = this._program.getUniformLocationForName( \"motion\" );\r\n        this._uniAngle = this._program.getUniformLocationForName( \"angle\" );\r\n\r\n\r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n            glProgram_state.setUniformFloat( this._uniAngle, this._angle );\r\n        }else{\r\n            this._program.setUniformLocationWith1f( this._uniAngle, this._angle );\r\n        }\r\n\r\n\r\n        this.setProgram( this.node._sgNode, this._program );\r\n    },\r\n    setProgram:function (node, program) {\r\n        if (cc.sys.isNative) {\r\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);\r\n            node.setGLProgramState(glProgram_state);\r\n        }else{\r\n            node.setShaderProgram(program);    \r\n        }\r\n        \r\n    \r\n        var children = node.children;\r\n        if (!children)\r\n            return;\r\n    \r\n        for (var i = 0; i < children.length; i++)\r\n            this.setProgram(children[i], program);\r\n    },  \r\n    \r\n    \r\n    update: function( dt )\r\n    {\r\n        if( this._program )\r\n        {\r\n\r\n            this._program.use();\r\n             if(cc.sys.isNative){\r\n                var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\r\n                glProgram_state.setUniformFloat( this._uniMotion, ( this._motion += 0.05 ) );\r\n            }else{\r\n                this._program.setUniformLocationWith1f( this._uniMotion, ( this._motion += 0.05 ) );\r\n                this._program.updateUniforms();\r\n            }\r\n            if( 1.0e20 < this._motion ){ this._motion = 0; }\r\n        }\r\n    }\r\n});\r\n"]}