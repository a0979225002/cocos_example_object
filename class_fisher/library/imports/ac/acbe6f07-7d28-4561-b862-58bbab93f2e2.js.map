{"version":3,"sources":["assets\\scripts\\cannon.js"],"names":["cc","Class","Component","properties","target","type","Node","bullet_prefab","Prefab","bullet_root","shoot_time","start","now_time","do_shoot","dst","getComponent","get_next_point","src","node","getPosition","dir","sub","r","Math","atan2","y","x","degree","PI","bullet","instantiate","addChild","setPosition","shoot","update","dt","angle"],"mappings":";;;;;;AACAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE;AACRC,IAAAA,MAAM,EAAE;AACJC,MAAAA,IAAI,EAAEL,EAAE,CAACM,IADL;AAEJ,iBAAS;AAFL,KADA;AAMRC,IAAAA,aAAa,EAAE;AACXF,MAAAA,IAAI,EAAEL,EAAE,CAACQ,MADE;AAEX,iBAAS;AAFE,KANP;AAWRC,IAAAA,WAAW,EAAE;AACTJ,MAAAA,IAAI,EAAEL,EAAE,CAACM,IADA;AAET,iBAAS;AAFA,KAXL;AAgBRI,IAAAA,UAAU,EAAE,GAhBJ,CAgBS;;AAhBT,GAHP;AAsBLC,EAAAA,KAtBK,mBAsBI;AACL;AACA,SAAKC,QAAL,GAAgB,KAAKF,UAArB;AACH,GAzBI;AA2BL;AACAG,EAAAA,QA5BK,sBA4BM;AACP,QAAI,KAAKT,MAAL,KAAgB,IAApB,EAA0B;AACtB;AACH;;AAED,QAAIU,GAAG,GAAG,KAAKV,MAAL,CAAYW,YAAZ,CAAyB,WAAzB,EAAsCC,cAAtC,EAAV,CALO,CAMP;;AACA,QAAIC,GAAG,GAAG,KAAKC,IAAL,CAAUC,WAAV,EAAV;AAEA,QAAIC,GAAG,GAAGN,GAAG,CAACO,GAAJ,CAAQJ,GAAR,CAAV,CATO,CASiB;;AACxB,QAAIK,CAAC,GAAGC,IAAI,CAACC,KAAL,CAAWJ,GAAG,CAACK,CAAf,EAAkBL,GAAG,CAACM,CAAtB,CAAR;AACA,QAAIC,MAAM,GAAGL,CAAC,GAAG,GAAJ,GAAUC,IAAI,CAACK,EAA5B;AAEA,QAAIC,MAAM,GAAG7B,EAAE,CAAC8B,WAAH,CAAe,KAAKvB,aAApB,CAAb;AACA,SAAKE,WAAL,CAAiBsB,QAAjB,CAA0BF,MAA1B;AACAA,IAAAA,MAAM,CAACG,WAAP,CAAmBf,GAAnB;AAEAY,IAAAA,MAAM,CAACd,YAAP,CAAoB,QAApB,EAA8BkB,KAA9B,CAAoCN,MAApC,EAA4C,GAA5C;AACH,GA9CI;AAgDLO,EAAAA,MAhDK,kBAgDGC,EAhDH,EAgDO;AACR,QAAI,KAAK/B,MAAL,KAAgB,IAApB,EAA0B;AACtB;AACH,KAHO,CAKR;;;AACA,QAAIa,GAAG,GAAG,KAAKC,IAAL,CAAUC,WAAV,EAAV,CANQ,CAM2B;;AACnC,QAAIL,GAAG,GAAG,KAAKV,MAAL,CAAYe,WAAZ,EAAV;AACA,QAAIC,GAAG,GAAGN,GAAG,CAACO,GAAJ,CAAQJ,GAAR,CAAV,CARQ,CAQgB;;AACxB,QAAIK,CAAC,GAAGC,IAAI,CAACC,KAAL,CAAWJ,GAAG,CAACK,CAAf,EAAkBL,GAAG,CAACM,CAAtB,CAAR;AACA,QAAIC,MAAM,GAAGL,CAAC,GAAG,GAAJ,GAAUC,IAAI,CAACK,EAA5B;AAEA,SAAKV,IAAL,CAAUkB,KAAV,GAAkBT,MAAM,GAAG,EAA3B;AAEA,SAAKf,QAAL,IAAiBuB,EAAjB;;AACA,QAAI,KAAKvB,QAAL,IAAiB,KAAKF,UAA1B,EAAsC;AAClC,WAAKE,QAAL,GAAgB,CAAhB;AACA,WAAKC,QAAL;AACH;AACJ;AAnEI,CAAT","sourceRoot":"/","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        target: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n\r\n        bullet_prefab: {\r\n            type: cc.Prefab,\r\n            default: null,\r\n        },\r\n\r\n        bullet_root: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n\r\n        shoot_time: 0.2, // 每隔0.2秒发射一颗;\r\n    },\r\n\r\n    start () {\r\n        // this this.node ---> \r\n        this.now_time = this.shoot_time;\r\n    },\r\n\r\n    // 发射一颗子弹, \r\n    do_shoot() {\r\n        if (this.target === null) {\r\n            return;\r\n        }\r\n\r\n        var dst = this.target.getComponent(\"nav_agent\").get_next_point();\r\n        // var dst = this.target.getPosition();\r\n        var src = this.node.getPosition();\r\n\r\n        var dir = dst.sub(src); // dir 炮台的方向;\r\n        var r = Math.atan2(dir.y, dir.x); \r\n        var degree = r * 180 / Math.PI; \r\n\r\n        var bullet = cc.instantiate(this.bullet_prefab);\r\n        this.bullet_root.addChild(bullet);\r\n        bullet.setPosition(src);\r\n\r\n        bullet.getComponent(\"bullet\").shoot(degree, 800);\r\n    },\r\n\r\n    update (dt) {\r\n        if (this.target === null) {\r\n            return;\r\n        }\r\n\r\n        // 数学不好能否学会;  初中数学, \r\n        var src = this.node.getPosition(); // 炮的位置;\r\n        var dst = this.target.getPosition(); \r\n        var dir = dst.sub(src); // dir 炮台的方向;\r\n        var r = Math.atan2(dir.y, dir.x); \r\n        var degree = r * 180 / Math.PI; \r\n\r\n        this.node.angle = degree - 90;\r\n\r\n        this.now_time += dt;\r\n        if (this.now_time >= this.shoot_time) {\r\n            this.now_time = 0;\r\n            this.do_shoot();\r\n        }\r\n    },\r\n});\r\n"]}