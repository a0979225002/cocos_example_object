
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/fish_map.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'ded6co+rIZHOJQSXvTgBDp/', 'fish_map');
// scripts/fish_map.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    // foo: {
    //    default: null,      // The default value will be used only when the component attaching
    //                           to a node for the first time
    //    url: cc.Texture2D,  // optional, default is typeof default
    //    serializable: true, // optional, default is true
    //    visible: true,      // optional, default is true
    //    displayName: 'Foo', // optional
    //    readonly: false,    // optional, default is false
    // },
    // ...
    is_debug: false
  },
  // use this for initialization
  onLoad: function onLoad() {
    this.anim_com = this.node.getComponent(cc.Animation);
    var clips = this.anim_com.getClips();
    var clip = clips[0];
    this.graphics = this.node.addComponent(cc.Graphics);
    this.graphics.fillColor = cc.color(255, 0, 0, 255);
    var paths = clip.curveData.paths; // console.log(paths);

    this.road_data_set = [];
    var k;

    for (k in paths) {
      var road_data = paths[k].props.position;
      this.gen_path_data(road_data);
    }

    if (this.is_debug) {
      this.draw_roads();
    }
  },
  start: function start() {
    /*
    // test()
    var actor = cc.find("UI_ROOT/map_root/ememy_gorilla").getComponent("actor");
    // actor.gen_at_road(this.road_data_set[0]);
    
    actor = cc.find("UI_ROOT/map_root/ememy_small2").getComponent("actor");
    // actor.gen_at_road(this.road_data_set[1]);
    
    actor = cc.find("UI_ROOT/map_root/ememy_small3").getComponent("actor");
    actor.gen_at_road(this.road_data_set[2]);
    */
    // end 
  },
  get_road_set: function get_road_set() {
    return this.road_data_set;
  },
  gen_path_data: function gen_path_data(road_data) {
    var ctrl1 = null;
    var start_point = null;
    var end_point = null;
    var ctrl2 = null;
    var road_curve_path = []; // [start_point, ctrl1, ctrl2, end_point],

    for (var i = 0; i < road_data.length; i++) {
      var key_frame = road_data[i];

      if (ctrl1 !== null) {
        road_curve_path.push([start_point, ctrl1, ctrl1, cc.v2(key_frame.value[0], key_frame.value[1])]);
      }

      start_point = cc.v2(key_frame.value[0], key_frame.value[1]);

      for (var j = 0; j < key_frame.motionPath.length; j++) {
        var end_point = cc.v2(key_frame.motionPath[j][0], key_frame.motionPath[j][1]);
        ctrl2 = cc.v2(key_frame.motionPath[j][2], key_frame.motionPath[j][3]);

        if (ctrl1 === null) {
          ctrl1 = ctrl2;
        } // 贝塞尔曲线 start_point, ctrl1, ctrl2, end_point,


        road_curve_path.push([start_point, ctrl1, ctrl2, end_point]);
        ctrl1 = cc.v2(key_frame.motionPath[j][4], key_frame.motionPath[j][5]);
        start_point = end_point;
      }
    }

    console.log(road_curve_path);
    var one_road = [road_curve_path[0][0]];

    for (var index = 0; index < road_curve_path.length; index++) {
      start_point = road_curve_path[index][0];
      ctrl1 = road_curve_path[index][1];
      ctrl2 = road_curve_path[index][2];
      end_point = road_curve_path[index][3];
      var len = this.bezier_length(start_point, ctrl1, ctrl2, end_point);
      var OFFSET = 16;
      var count = len / OFFSET;
      count = Math.floor(count);
      var t_delta = 1 / count;
      var t = t_delta;

      for (var i = 0; i < count; i++) {
        var x = start_point.x * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.x * t * (1 - t) * (1 - t) + 3 * ctrl2.x * t * t * (1 - t) + end_point.x * t * t * t;
        var y = start_point.y * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.y * t * (1 - t) * (1 - t) + 3 * ctrl2.y * t * t * (1 - t) + end_point.y * t * t * t;
        one_road.push(cc.v2(x, y));
        t += t_delta;
      }
    }

    console.log(one_road);
    this.road_data_set.push(one_road);
  },
  draw_roads: function draw_roads(path) {
    this.graphics.clear();

    for (var j = 0; j < this.road_data_set.length; j++) {
      var path = this.road_data_set[j];

      for (var i = 0; i < path.length; i++) {
        this.graphics.moveTo(path[i].x - 2, path[i].y + 2);
        this.graphics.lineTo(path[i].x - 2, path[i].y - 2);
        this.graphics.lineTo(path[i].x + 2, path[i].y - 2);
        this.graphics.lineTo(path[i].x + 2, path[i].y + 2);
        this.graphics.close(); // 组成一个封闭的路径
      }
    } // 画先，填充;
    // this.graphics.stroke();


    this.graphics.fill();
  },
  bezier_length: function bezier_length(start_point, ctrl1, ctrl2, end_point) {
    // t [0, 1] t 分成20等分 1 / 20 = 0.05
    var prev_point = start_point;
    var length = 0;
    var t = 0.05;

    for (var i = 0; i < 20; i++) {
      var x = start_point.x * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.x * t * (1 - t) * (1 - t) + 3 * ctrl2.x * t * t * (1 - t) + end_point.x * t * t * t;
      var y = start_point.y * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.y * t * (1 - t) * (1 - t) + 3 * ctrl2.y * t * t * (1 - t) + end_point.y * t * t * t;
      var now_point = cc.v2(x, y); // var dir = cc.pSub(now_point, prev_point);

      var dir = now_point.sub(prev_point);
      prev_point = now_point;
      length += dir.mag();
      t += 0.05;
    }

    return length;
  } // called every frame, uncomment this function to activate update callback
  // update: function (dt) {
  // },

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcZmlzaF9tYXAuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJpc19kZWJ1ZyIsIm9uTG9hZCIsImFuaW1fY29tIiwibm9kZSIsImdldENvbXBvbmVudCIsIkFuaW1hdGlvbiIsImNsaXBzIiwiZ2V0Q2xpcHMiLCJjbGlwIiwiZ3JhcGhpY3MiLCJhZGRDb21wb25lbnQiLCJHcmFwaGljcyIsImZpbGxDb2xvciIsImNvbG9yIiwicGF0aHMiLCJjdXJ2ZURhdGEiLCJyb2FkX2RhdGFfc2V0IiwiayIsInJvYWRfZGF0YSIsInByb3BzIiwicG9zaXRpb24iLCJnZW5fcGF0aF9kYXRhIiwiZHJhd19yb2FkcyIsInN0YXJ0IiwiZ2V0X3JvYWRfc2V0IiwiY3RybDEiLCJzdGFydF9wb2ludCIsImVuZF9wb2ludCIsImN0cmwyIiwicm9hZF9jdXJ2ZV9wYXRoIiwiaSIsImxlbmd0aCIsImtleV9mcmFtZSIsInB1c2giLCJ2MiIsInZhbHVlIiwiaiIsIm1vdGlvblBhdGgiLCJjb25zb2xlIiwibG9nIiwib25lX3JvYWQiLCJpbmRleCIsImxlbiIsImJlemllcl9sZW5ndGgiLCJPRkZTRVQiLCJjb3VudCIsIk1hdGgiLCJmbG9vciIsInRfZGVsdGEiLCJ0IiwieCIsInkiLCJwYXRoIiwiY2xlYXIiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZSIsImZpbGwiLCJwcmV2X3BvaW50Iiwibm93X3BvaW50IiwiZGlyIiwic3ViIiwibWFnIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUNBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBQyxJQUFBQSxRQUFRLEVBQUU7QUFYRixHQUhQO0FBaUJMO0FBQ0FDLEVBQUFBLE1BQU0sRUFBRSxrQkFBWTtBQUNoQixTQUFLQyxRQUFMLEdBQWdCLEtBQUtDLElBQUwsQ0FBVUMsWUFBVixDQUF1QlIsRUFBRSxDQUFDUyxTQUExQixDQUFoQjtBQUNBLFFBQUlDLEtBQUssR0FBRyxLQUFLSixRQUFMLENBQWNLLFFBQWQsRUFBWjtBQUNBLFFBQUlDLElBQUksR0FBR0YsS0FBSyxDQUFDLENBQUQsQ0FBaEI7QUFFQSxTQUFLRyxRQUFMLEdBQWdCLEtBQUtOLElBQUwsQ0FBVU8sWUFBVixDQUF1QmQsRUFBRSxDQUFDZSxRQUExQixDQUFoQjtBQUNBLFNBQUtGLFFBQUwsQ0FBY0csU0FBZCxHQUEwQmhCLEVBQUUsQ0FBQ2lCLEtBQUgsQ0FBUyxHQUFULEVBQWMsQ0FBZCxFQUFpQixDQUFqQixFQUFvQixHQUFwQixDQUExQjtBQUNBLFFBQUlDLEtBQUssR0FBR04sSUFBSSxDQUFDTyxTQUFMLENBQWVELEtBQTNCLENBUGdCLENBUWhCOztBQUVBLFNBQUtFLGFBQUwsR0FBcUIsRUFBckI7QUFFQSxRQUFJQyxDQUFKOztBQUNBLFNBQUtBLENBQUwsSUFBVUgsS0FBVixFQUFpQjtBQUNiLFVBQUlJLFNBQVMsR0FBR0osS0FBSyxDQUFDRyxDQUFELENBQUwsQ0FBU0UsS0FBVCxDQUFlQyxRQUEvQjtBQUNBLFdBQUtDLGFBQUwsQ0FBbUJILFNBQW5CO0FBQ0g7O0FBRUQsUUFBSSxLQUFLbEIsUUFBVCxFQUFtQjtBQUNmLFdBQUtzQixVQUFMO0FBQ0g7QUFDSixHQXZDSTtBQXlDTEMsRUFBQUEsS0FBSyxFQUFFLGlCQUFXO0FBQ2Q7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNRO0FBQ0gsR0F0REk7QUF3RExDLEVBQUFBLFlBQVksRUFBRSx3QkFBVztBQUNyQixXQUFPLEtBQUtSLGFBQVo7QUFDSCxHQTFESTtBQTRETEssRUFBQUEsYUFBYSxFQUFFLHVCQUFTSCxTQUFULEVBQW9CO0FBQy9CLFFBQUlPLEtBQUssR0FBRyxJQUFaO0FBQ0EsUUFBSUMsV0FBVyxHQUFHLElBQWxCO0FBQ0EsUUFBSUMsU0FBUyxHQUFHLElBQWhCO0FBQ0EsUUFBSUMsS0FBSyxHQUFHLElBQVo7QUFFQSxRQUFJQyxlQUFlLEdBQUcsRUFBdEIsQ0FOK0IsQ0FNTDs7QUFDMUIsU0FBSSxJQUFJQyxDQUFDLEdBQUcsQ0FBWixFQUFlQSxDQUFDLEdBQUdaLFNBQVMsQ0FBQ2EsTUFBN0IsRUFBcUNELENBQUMsRUFBdEMsRUFBMkM7QUFDdkMsVUFBSUUsU0FBUyxHQUFHZCxTQUFTLENBQUNZLENBQUQsQ0FBekI7O0FBQ0EsVUFBSUwsS0FBSyxLQUFLLElBQWQsRUFBb0I7QUFDaEJJLFFBQUFBLGVBQWUsQ0FBQ0ksSUFBaEIsQ0FBcUIsQ0FBQ1AsV0FBRCxFQUFjRCxLQUFkLEVBQXFCQSxLQUFyQixFQUE0QjdCLEVBQUUsQ0FBQ3NDLEVBQUgsQ0FBTUYsU0FBUyxDQUFDRyxLQUFWLENBQWdCLENBQWhCLENBQU4sRUFBMEJILFNBQVMsQ0FBQ0csS0FBVixDQUFnQixDQUFoQixDQUExQixDQUE1QixDQUFyQjtBQUNIOztBQUVEVCxNQUFBQSxXQUFXLEdBQUc5QixFQUFFLENBQUNzQyxFQUFILENBQU1GLFNBQVMsQ0FBQ0csS0FBVixDQUFnQixDQUFoQixDQUFOLEVBQTBCSCxTQUFTLENBQUNHLEtBQVYsQ0FBZ0IsQ0FBaEIsQ0FBMUIsQ0FBZDs7QUFFQSxXQUFJLElBQUlDLENBQUMsR0FBRyxDQUFaLEVBQWVBLENBQUMsR0FBR0osU0FBUyxDQUFDSyxVQUFWLENBQXFCTixNQUF4QyxFQUFnREssQ0FBQyxFQUFqRCxFQUFzRDtBQUNsRCxZQUFJVCxTQUFTLEdBQUcvQixFQUFFLENBQUNzQyxFQUFILENBQU1GLFNBQVMsQ0FBQ0ssVUFBVixDQUFxQkQsQ0FBckIsRUFBd0IsQ0FBeEIsQ0FBTixFQUFrQ0osU0FBUyxDQUFDSyxVQUFWLENBQXFCRCxDQUFyQixFQUF3QixDQUF4QixDQUFsQyxDQUFoQjtBQUNBUixRQUFBQSxLQUFLLEdBQUdoQyxFQUFFLENBQUNzQyxFQUFILENBQU1GLFNBQVMsQ0FBQ0ssVUFBVixDQUFxQkQsQ0FBckIsRUFBd0IsQ0FBeEIsQ0FBTixFQUFrQ0osU0FBUyxDQUFDSyxVQUFWLENBQXFCRCxDQUFyQixFQUF3QixDQUF4QixDQUFsQyxDQUFSOztBQUNBLFlBQUlYLEtBQUssS0FBSyxJQUFkLEVBQW9CO0FBQ2hCQSxVQUFBQSxLQUFLLEdBQUdHLEtBQVI7QUFDSCxTQUxpRCxDQU1sRDs7O0FBQ0FDLFFBQUFBLGVBQWUsQ0FBQ0ksSUFBaEIsQ0FBcUIsQ0FBQ1AsV0FBRCxFQUFjRCxLQUFkLEVBQXFCRyxLQUFyQixFQUE0QkQsU0FBNUIsQ0FBckI7QUFDQUYsUUFBQUEsS0FBSyxHQUFHN0IsRUFBRSxDQUFDc0MsRUFBSCxDQUFNRixTQUFTLENBQUNLLFVBQVYsQ0FBcUJELENBQXJCLEVBQXdCLENBQXhCLENBQU4sRUFBa0NKLFNBQVMsQ0FBQ0ssVUFBVixDQUFxQkQsQ0FBckIsRUFBd0IsQ0FBeEIsQ0FBbEMsQ0FBUjtBQUNBVixRQUFBQSxXQUFXLEdBQUdDLFNBQWQ7QUFDSDtBQUNKOztBQUVEVyxJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWVYsZUFBWjtBQUVBLFFBQUlXLFFBQVEsR0FBRyxDQUFDWCxlQUFlLENBQUMsQ0FBRCxDQUFmLENBQW1CLENBQW5CLENBQUQsQ0FBZjs7QUFFQSxTQUFJLElBQUlZLEtBQUssR0FBRyxDQUFoQixFQUFtQkEsS0FBSyxHQUFHWixlQUFlLENBQUNFLE1BQTNDLEVBQW1EVSxLQUFLLEVBQXhELEVBQTZEO0FBQ3pEZixNQUFBQSxXQUFXLEdBQUdHLGVBQWUsQ0FBQ1ksS0FBRCxDQUFmLENBQXVCLENBQXZCLENBQWQ7QUFDQWhCLE1BQUFBLEtBQUssR0FBR0ksZUFBZSxDQUFDWSxLQUFELENBQWYsQ0FBdUIsQ0FBdkIsQ0FBUjtBQUNBYixNQUFBQSxLQUFLLEdBQUdDLGVBQWUsQ0FBQ1ksS0FBRCxDQUFmLENBQXVCLENBQXZCLENBQVI7QUFDQWQsTUFBQUEsU0FBUyxHQUFHRSxlQUFlLENBQUNZLEtBQUQsQ0FBZixDQUF1QixDQUF2QixDQUFaO0FBRUEsVUFBSUMsR0FBRyxHQUFHLEtBQUtDLGFBQUwsQ0FBbUJqQixXQUFuQixFQUFnQ0QsS0FBaEMsRUFBdUNHLEtBQXZDLEVBQThDRCxTQUE5QyxDQUFWO0FBQ0EsVUFBSWlCLE1BQU0sR0FBRyxFQUFiO0FBQ0EsVUFBSUMsS0FBSyxHQUFHSCxHQUFHLEdBQUdFLE1BQWxCO0FBQ0FDLE1BQUFBLEtBQUssR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVdGLEtBQVgsQ0FBUjtBQUNBLFVBQUlHLE9BQU8sR0FBRyxJQUFJSCxLQUFsQjtBQUNBLFVBQUlJLENBQUMsR0FBR0QsT0FBUjs7QUFFQSxXQUFJLElBQUlsQixDQUFDLEdBQUcsQ0FBWixFQUFlQSxDQUFDLEdBQUdlLEtBQW5CLEVBQTBCZixDQUFDLEVBQTNCLEVBQWdDO0FBQzVCLFlBQUlvQixDQUFDLEdBQUd4QixXQUFXLENBQUN3QixDQUFaLElBQWlCLElBQUlELENBQXJCLEtBQTJCLElBQUlBLENBQS9CLEtBQXFDLElBQUlBLENBQXpDLElBQThDLElBQUl4QixLQUFLLENBQUN5QixDQUFWLEdBQWNELENBQWQsSUFBbUIsSUFBSUEsQ0FBdkIsS0FBNkIsSUFBSUEsQ0FBakMsQ0FBOUMsR0FBb0YsSUFBSXJCLEtBQUssQ0FBQ3NCLENBQVYsR0FBY0QsQ0FBZCxHQUFrQkEsQ0FBbEIsSUFBdUIsSUFBSUEsQ0FBM0IsQ0FBcEYsR0FBb0h0QixTQUFTLENBQUN1QixDQUFWLEdBQWNELENBQWQsR0FBa0JBLENBQWxCLEdBQXNCQSxDQUFsSjtBQUNBLFlBQUlFLENBQUMsR0FBR3pCLFdBQVcsQ0FBQ3lCLENBQVosSUFBaUIsSUFBSUYsQ0FBckIsS0FBMkIsSUFBSUEsQ0FBL0IsS0FBcUMsSUFBSUEsQ0FBekMsSUFBOEMsSUFBSXhCLEtBQUssQ0FBQzBCLENBQVYsR0FBY0YsQ0FBZCxJQUFtQixJQUFJQSxDQUF2QixLQUE2QixJQUFJQSxDQUFqQyxDQUE5QyxHQUFvRixJQUFJckIsS0FBSyxDQUFDdUIsQ0FBVixHQUFjRixDQUFkLEdBQWtCQSxDQUFsQixJQUF1QixJQUFJQSxDQUEzQixDQUFwRixHQUFvSHRCLFNBQVMsQ0FBQ3dCLENBQVYsR0FBY0YsQ0FBZCxHQUFrQkEsQ0FBbEIsR0FBc0JBLENBQWxKO0FBQ0FULFFBQUFBLFFBQVEsQ0FBQ1AsSUFBVCxDQUFjckMsRUFBRSxDQUFDc0MsRUFBSCxDQUFNZ0IsQ0FBTixFQUFTQyxDQUFULENBQWQ7QUFDQUYsUUFBQUEsQ0FBQyxJQUFJRCxPQUFMO0FBQ0g7QUFDSjs7QUFFRFYsSUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFFBQVo7QUFDQSxTQUFLeEIsYUFBTCxDQUFtQmlCLElBQW5CLENBQXdCTyxRQUF4QjtBQUNILEdBbkhJO0FBcUhMbEIsRUFBQUEsVUFySEssc0JBcUhNOEIsSUFySE4sRUFxSFk7QUFDYixTQUFLM0MsUUFBTCxDQUFjNEMsS0FBZDs7QUFFQSxTQUFJLElBQUlqQixDQUFDLEdBQUcsQ0FBWixFQUFlQSxDQUFDLEdBQUcsS0FBS3BCLGFBQUwsQ0FBbUJlLE1BQXRDLEVBQThDSyxDQUFDLEVBQS9DLEVBQW9EO0FBQ2hELFVBQUlnQixJQUFJLEdBQUcsS0FBS3BDLGFBQUwsQ0FBbUJvQixDQUFuQixDQUFYOztBQUVBLFdBQUksSUFBSU4sQ0FBQyxHQUFHLENBQVosRUFBZUEsQ0FBQyxHQUFHc0IsSUFBSSxDQUFDckIsTUFBeEIsRUFBZ0NELENBQUMsRUFBakMsRUFBc0M7QUFDbEMsYUFBS3JCLFFBQUwsQ0FBYzZDLE1BQWQsQ0FBcUJGLElBQUksQ0FBQ3RCLENBQUQsQ0FBSixDQUFRb0IsQ0FBUixHQUFZLENBQWpDLEVBQW9DRSxJQUFJLENBQUN0QixDQUFELENBQUosQ0FBUXFCLENBQVIsR0FBWSxDQUFoRDtBQUNBLGFBQUsxQyxRQUFMLENBQWM4QyxNQUFkLENBQXFCSCxJQUFJLENBQUN0QixDQUFELENBQUosQ0FBUW9CLENBQVIsR0FBWSxDQUFqQyxFQUFvQ0UsSUFBSSxDQUFDdEIsQ0FBRCxDQUFKLENBQVFxQixDQUFSLEdBQVksQ0FBaEQ7QUFDQSxhQUFLMUMsUUFBTCxDQUFjOEMsTUFBZCxDQUFxQkgsSUFBSSxDQUFDdEIsQ0FBRCxDQUFKLENBQVFvQixDQUFSLEdBQVksQ0FBakMsRUFBb0NFLElBQUksQ0FBQ3RCLENBQUQsQ0FBSixDQUFRcUIsQ0FBUixHQUFZLENBQWhEO0FBQ0EsYUFBSzFDLFFBQUwsQ0FBYzhDLE1BQWQsQ0FBcUJILElBQUksQ0FBQ3RCLENBQUQsQ0FBSixDQUFRb0IsQ0FBUixHQUFZLENBQWpDLEVBQW9DRSxJQUFJLENBQUN0QixDQUFELENBQUosQ0FBUXFCLENBQVIsR0FBWSxDQUFoRDtBQUNBLGFBQUsxQyxRQUFMLENBQWMrQyxLQUFkLEdBTGtDLENBS1g7QUFDMUI7QUFDSixLQWJZLENBZWI7QUFDQTs7O0FBQ0EsU0FBSy9DLFFBQUwsQ0FBY2dELElBQWQ7QUFDSCxHQXZJSTtBQXlJTGQsRUFBQUEsYUFBYSxFQUFFLHVCQUFTakIsV0FBVCxFQUFzQkQsS0FBdEIsRUFBNkJHLEtBQTdCLEVBQW9DRCxTQUFwQyxFQUErQztBQUMxRDtBQUNBLFFBQUkrQixVQUFVLEdBQUdoQyxXQUFqQjtBQUNBLFFBQUlLLE1BQU0sR0FBRyxDQUFiO0FBQ0EsUUFBSWtCLENBQUMsR0FBRyxJQUFSOztBQUNBLFNBQUksSUFBSW5CLENBQUMsR0FBRyxDQUFaLEVBQWVBLENBQUMsR0FBRyxFQUFuQixFQUF1QkEsQ0FBQyxFQUF4QixFQUE2QjtBQUN6QixVQUFJb0IsQ0FBQyxHQUFHeEIsV0FBVyxDQUFDd0IsQ0FBWixJQUFpQixJQUFJRCxDQUFyQixLQUEyQixJQUFJQSxDQUEvQixLQUFxQyxJQUFJQSxDQUF6QyxJQUE4QyxJQUFJeEIsS0FBSyxDQUFDeUIsQ0FBVixHQUFjRCxDQUFkLElBQW1CLElBQUlBLENBQXZCLEtBQTZCLElBQUlBLENBQWpDLENBQTlDLEdBQW9GLElBQUlyQixLQUFLLENBQUNzQixDQUFWLEdBQWNELENBQWQsR0FBa0JBLENBQWxCLElBQXVCLElBQUlBLENBQTNCLENBQXBGLEdBQW9IdEIsU0FBUyxDQUFDdUIsQ0FBVixHQUFjRCxDQUFkLEdBQWtCQSxDQUFsQixHQUFzQkEsQ0FBbEo7QUFDQSxVQUFJRSxDQUFDLEdBQUd6QixXQUFXLENBQUN5QixDQUFaLElBQWlCLElBQUlGLENBQXJCLEtBQTJCLElBQUlBLENBQS9CLEtBQXFDLElBQUlBLENBQXpDLElBQThDLElBQUl4QixLQUFLLENBQUMwQixDQUFWLEdBQWNGLENBQWQsSUFBbUIsSUFBSUEsQ0FBdkIsS0FBNkIsSUFBSUEsQ0FBakMsQ0FBOUMsR0FBb0YsSUFBSXJCLEtBQUssQ0FBQ3VCLENBQVYsR0FBY0YsQ0FBZCxHQUFrQkEsQ0FBbEIsSUFBdUIsSUFBSUEsQ0FBM0IsQ0FBcEYsR0FBb0h0QixTQUFTLENBQUN3QixDQUFWLEdBQWNGLENBQWQsR0FBa0JBLENBQWxCLEdBQXNCQSxDQUFsSjtBQUNBLFVBQUlVLFNBQVMsR0FBRy9ELEVBQUUsQ0FBQ3NDLEVBQUgsQ0FBTWdCLENBQU4sRUFBU0MsQ0FBVCxDQUFoQixDQUh5QixDQUl6Qjs7QUFDQSxVQUFJUyxHQUFHLEdBQUdELFNBQVMsQ0FBQ0UsR0FBVixDQUFjSCxVQUFkLENBQVY7QUFDQUEsTUFBQUEsVUFBVSxHQUFHQyxTQUFiO0FBQ0E1QixNQUFBQSxNQUFNLElBQUk2QixHQUFHLENBQUNFLEdBQUosRUFBVjtBQUVBYixNQUFBQSxDQUFDLElBQUksSUFBTDtBQUNIOztBQUNELFdBQU9sQixNQUFQO0FBQ0gsR0ExSkksQ0EySkw7QUFDQTtBQUVBOztBQTlKSyxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICAvLyBmb286IHtcclxuICAgICAgICAvLyAgICBkZWZhdWx0OiBudWxsLCAgICAgIC8vIFRoZSBkZWZhdWx0IHZhbHVlIHdpbGwgYmUgdXNlZCBvbmx5IHdoZW4gdGhlIGNvbXBvbmVudCBhdHRhY2hpbmdcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIGEgbm9kZSBmb3IgdGhlIGZpcnN0IHRpbWVcclxuICAgICAgICAvLyAgICB1cmw6IGNjLlRleHR1cmUyRCwgIC8vIG9wdGlvbmFsLCBkZWZhdWx0IGlzIHR5cGVvZiBkZWZhdWx0XHJcbiAgICAgICAgLy8gICAgc2VyaWFsaXphYmxlOiB0cnVlLCAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyB0cnVlXHJcbiAgICAgICAgLy8gICAgdmlzaWJsZTogdHJ1ZSwgICAgICAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyB0cnVlXHJcbiAgICAgICAgLy8gICAgZGlzcGxheU5hbWU6ICdGb28nLCAvLyBvcHRpb25hbFxyXG4gICAgICAgIC8vICAgIHJlYWRvbmx5OiBmYWxzZSwgICAgLy8gb3B0aW9uYWwsIGRlZmF1bHQgaXMgZmFsc2VcclxuICAgICAgICAvLyB9LFxyXG4gICAgICAgIC8vIC4uLlxyXG4gICAgICAgIGlzX2RlYnVnOiBmYWxzZSxcclxuICAgIH0sXHJcblxyXG4gICAgLy8gdXNlIHRoaXMgZm9yIGluaXRpYWxpemF0aW9uXHJcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmFuaW1fY29tID0gdGhpcy5ub2RlLmdldENvbXBvbmVudChjYy5BbmltYXRpb24pO1xyXG4gICAgICAgIHZhciBjbGlwcyA9IHRoaXMuYW5pbV9jb20uZ2V0Q2xpcHMoKTtcclxuICAgICAgICB2YXIgY2xpcCA9IGNsaXBzWzBdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuZ3JhcGhpY3MgPSB0aGlzLm5vZGUuYWRkQ29tcG9uZW50KGNjLkdyYXBoaWNzKTtcclxuICAgICAgICB0aGlzLmdyYXBoaWNzLmZpbGxDb2xvciA9IGNjLmNvbG9yKDI1NSwgMCwgMCwgMjU1KTtcclxuICAgICAgICB2YXIgcGF0aHMgPSBjbGlwLmN1cnZlRGF0YS5wYXRocztcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhwYXRocyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5yb2FkX2RhdGFfc2V0ID0gW107XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIGs7XHJcbiAgICAgICAgZm9yIChrIGluIHBhdGhzKSB7XHJcbiAgICAgICAgICAgIHZhciByb2FkX2RhdGEgPSBwYXRoc1trXS5wcm9wcy5wb3NpdGlvbjtcclxuICAgICAgICAgICAgdGhpcy5nZW5fcGF0aF9kYXRhKHJvYWRfZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pc19kZWJ1Zykge1xyXG4gICAgICAgICAgICB0aGlzLmRyYXdfcm9hZHMoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICBzdGFydDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLypcclxuICAgICAgICAvLyB0ZXN0KClcclxuICAgICAgICB2YXIgYWN0b3IgPSBjYy5maW5kKFwiVUlfUk9PVC9tYXBfcm9vdC9lbWVteV9nb3JpbGxhXCIpLmdldENvbXBvbmVudChcImFjdG9yXCIpO1xyXG4gICAgICAgIC8vIGFjdG9yLmdlbl9hdF9yb2FkKHRoaXMucm9hZF9kYXRhX3NldFswXSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgYWN0b3IgPSBjYy5maW5kKFwiVUlfUk9PVC9tYXBfcm9vdC9lbWVteV9zbWFsbDJcIikuZ2V0Q29tcG9uZW50KFwiYWN0b3JcIik7XHJcbiAgICAgICAgLy8gYWN0b3IuZ2VuX2F0X3JvYWQodGhpcy5yb2FkX2RhdGFfc2V0WzFdKTtcclxuICAgICAgICBcclxuICAgICAgICBhY3RvciA9IGNjLmZpbmQoXCJVSV9ST09UL21hcF9yb290L2VtZW15X3NtYWxsM1wiKS5nZXRDb21wb25lbnQoXCJhY3RvclwiKTtcclxuICAgICAgICBhY3Rvci5nZW5fYXRfcm9hZCh0aGlzLnJvYWRfZGF0YV9zZXRbMl0pO1xyXG4gICAgICAgICovXHJcbiAgICAgICAgLy8gZW5kIFxyXG4gICAgfSxcclxuICAgIFxyXG4gICAgZ2V0X3JvYWRfc2V0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yb2FkX2RhdGFfc2V0O1xyXG4gICAgfSxcclxuICAgIFxyXG4gICAgZ2VuX3BhdGhfZGF0YTogZnVuY3Rpb24ocm9hZF9kYXRhKSB7XHJcbiAgICAgICAgdmFyIGN0cmwxID0gbnVsbDtcclxuICAgICAgICB2YXIgc3RhcnRfcG9pbnQgPSBudWxsO1xyXG4gICAgICAgIHZhciBlbmRfcG9pbnQgPSBudWxsO1xyXG4gICAgICAgIHZhciBjdHJsMiA9IG51bGw7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIHJvYWRfY3VydmVfcGF0aCA9IFtdOyAvLyBbc3RhcnRfcG9pbnQsIGN0cmwxLCBjdHJsMiwgZW5kX3BvaW50XSxcclxuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgcm9hZF9kYXRhLmxlbmd0aDsgaSArKykge1xyXG4gICAgICAgICAgICB2YXIga2V5X2ZyYW1lID0gcm9hZF9kYXRhW2ldO1xyXG4gICAgICAgICAgICBpZiAoY3RybDEgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJvYWRfY3VydmVfcGF0aC5wdXNoKFtzdGFydF9wb2ludCwgY3RybDEsIGN0cmwxLCBjYy52MihrZXlfZnJhbWUudmFsdWVbMF0sIGtleV9mcmFtZS52YWx1ZVsxXSldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgc3RhcnRfcG9pbnQgPSBjYy52MihrZXlfZnJhbWUudmFsdWVbMF0sIGtleV9mcmFtZS52YWx1ZVsxXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwga2V5X2ZyYW1lLm1vdGlvblBhdGgubGVuZ3RoOyBqICsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZW5kX3BvaW50ID0gY2MudjIoa2V5X2ZyYW1lLm1vdGlvblBhdGhbal1bMF0sIGtleV9mcmFtZS5tb3Rpb25QYXRoW2pdWzFdKTtcclxuICAgICAgICAgICAgICAgIGN0cmwyID0gY2MudjIoa2V5X2ZyYW1lLm1vdGlvblBhdGhbal1bMl0sIGtleV9mcmFtZS5tb3Rpb25QYXRoW2pdWzNdKTtcclxuICAgICAgICAgICAgICAgIGlmIChjdHJsMSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwxID0gY3RybDI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyDotJ3loZ7lsJTmm7Lnur8gc3RhcnRfcG9pbnQsIGN0cmwxLCBjdHJsMiwgZW5kX3BvaW50LFxyXG4gICAgICAgICAgICAgICAgcm9hZF9jdXJ2ZV9wYXRoLnB1c2goW3N0YXJ0X3BvaW50LCBjdHJsMSwgY3RybDIsIGVuZF9wb2ludF0pO1xyXG4gICAgICAgICAgICAgICAgY3RybDEgPSBjYy52MihrZXlfZnJhbWUubW90aW9uUGF0aFtqXVs0XSwga2V5X2ZyYW1lLm1vdGlvblBhdGhbal1bNV0pO1xyXG4gICAgICAgICAgICAgICAgc3RhcnRfcG9pbnQgPSBlbmRfcG9pbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc29sZS5sb2cocm9hZF9jdXJ2ZV9wYXRoKTtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgb25lX3JvYWQgPSBbcm9hZF9jdXJ2ZV9wYXRoWzBdWzBdXTtcclxuICAgICAgICBcclxuICAgICAgICBmb3IodmFyIGluZGV4ID0gMDsgaW5kZXggPCByb2FkX2N1cnZlX3BhdGgubGVuZ3RoOyBpbmRleCArKykge1xyXG4gICAgICAgICAgICBzdGFydF9wb2ludCA9IHJvYWRfY3VydmVfcGF0aFtpbmRleF1bMF07XHJcbiAgICAgICAgICAgIGN0cmwxID0gcm9hZF9jdXJ2ZV9wYXRoW2luZGV4XVsxXTtcclxuICAgICAgICAgICAgY3RybDIgPSByb2FkX2N1cnZlX3BhdGhbaW5kZXhdWzJdO1xyXG4gICAgICAgICAgICBlbmRfcG9pbnQgPSByb2FkX2N1cnZlX3BhdGhbaW5kZXhdWzNdO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIGxlbiA9IHRoaXMuYmV6aWVyX2xlbmd0aChzdGFydF9wb2ludCwgY3RybDEsIGN0cmwyLCBlbmRfcG9pbnQpO1xyXG4gICAgICAgICAgICB2YXIgT0ZGU0VUID0gMTY7XHJcbiAgICAgICAgICAgIHZhciBjb3VudCA9IGxlbiAvIE9GRlNFVDtcclxuICAgICAgICAgICAgY291bnQgPSBNYXRoLmZsb29yKGNvdW50KTtcclxuICAgICAgICAgICAgdmFyIHRfZGVsdGEgPSAxIC8gY291bnQ7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdF9kZWx0YTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSArKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSBzdGFydF9wb2ludC54ICogKDEgLSB0KSAqICgxIC0gdCkgKiAoMSAtIHQpICsgMyAqIGN0cmwxLnggKiB0ICogKDEgLSB0KSAqICgxIC0gdCkgKyAzICogY3RybDIueCAqIHQgKiB0ICogKDEgLSB0KSArIGVuZF9wb2ludC54ICogdCAqIHQgKiB0O1xyXG4gICAgICAgICAgICAgICAgdmFyIHkgPSBzdGFydF9wb2ludC55ICogKDEgLSB0KSAqICgxIC0gdCkgKiAoMSAtIHQpICsgMyAqIGN0cmwxLnkgKiB0ICogKDEgLSB0KSAqICgxIC0gdCkgKyAzICogY3RybDIueSAqIHQgKiB0ICogKDEgLSB0KSArIGVuZF9wb2ludC55ICogdCAqIHQgKiB0O1xyXG4gICAgICAgICAgICAgICAgb25lX3JvYWQucHVzaChjYy52Mih4LCB5KSk7XHJcbiAgICAgICAgICAgICAgICB0ICs9IHRfZGVsdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc29sZS5sb2cob25lX3JvYWQpO1xyXG4gICAgICAgIHRoaXMucm9hZF9kYXRhX3NldC5wdXNoKG9uZV9yb2FkKTtcclxuICAgIH0sIFxyXG5cclxuICAgIGRyYXdfcm9hZHMocGF0aCkge1xyXG4gICAgICAgIHRoaXMuZ3JhcGhpY3MuY2xlYXIoKTtcclxuXHJcbiAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8IHRoaXMucm9hZF9kYXRhX3NldC5sZW5ndGg7IGogKyspIHtcclxuICAgICAgICAgICAgdmFyIHBhdGggPSB0aGlzLnJvYWRfZGF0YV9zZXRbal07XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkgKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3MubW92ZVRvKHBhdGhbaV0ueCAtIDIsIHBhdGhbaV0ueSArIDIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ncmFwaGljcy5saW5lVG8ocGF0aFtpXS54IC0gMiwgcGF0aFtpXS55IC0gMik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdyYXBoaWNzLmxpbmVUbyhwYXRoW2ldLnggKyAyLCBwYXRoW2ldLnkgLSAyKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3MubGluZVRvKHBhdGhbaV0ueCArIDIsIHBhdGhbaV0ueSArIDIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ncmFwaGljcy5jbG9zZSgpOyAvLyDnu4TmiJDkuIDkuKrlsIHpl63nmoTot6/lvoRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyDnlLvlhYjvvIzloavlhYU7XHJcbiAgICAgICAgLy8gdGhpcy5ncmFwaGljcy5zdHJva2UoKTtcclxuICAgICAgICB0aGlzLmdyYXBoaWNzLmZpbGwoKTtcclxuICAgIH0sIFxyXG5cclxuICAgIGJlemllcl9sZW5ndGg6IGZ1bmN0aW9uKHN0YXJ0X3BvaW50LCBjdHJsMSwgY3RybDIsIGVuZF9wb2ludCkge1xyXG4gICAgICAgIC8vIHQgWzAsIDFdIHQg5YiG5oiQMjDnrYnliIYgMSAvIDIwID0gMC4wNVxyXG4gICAgICAgIHZhciBwcmV2X3BvaW50ID0gc3RhcnRfcG9pbnQ7XHJcbiAgICAgICAgdmFyIGxlbmd0aCA9IDA7XHJcbiAgICAgICAgdmFyIHQgPSAwLjA1O1xyXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAyMDsgaSArKykge1xyXG4gICAgICAgICAgICB2YXIgeCA9IHN0YXJ0X3BvaW50LnggKiAoMSAtIHQpICogKDEgLSB0KSAqICgxIC0gdCkgKyAzICogY3RybDEueCAqIHQgKiAoMSAtIHQpICogKDEgLSB0KSArIDMgKiBjdHJsMi54ICogdCAqIHQgKiAoMSAtIHQpICsgZW5kX3BvaW50LnggKiB0ICogdCAqIHQ7XHJcbiAgICAgICAgICAgIHZhciB5ID0gc3RhcnRfcG9pbnQueSAqICgxIC0gdCkgKiAoMSAtIHQpICogKDEgLSB0KSArIDMgKiBjdHJsMS55ICogdCAqICgxIC0gdCkgKiAoMSAtIHQpICsgMyAqIGN0cmwyLnkgKiB0ICogdCAqICgxIC0gdCkgKyBlbmRfcG9pbnQueSAqIHQgKiB0ICogdDtcclxuICAgICAgICAgICAgdmFyIG5vd19wb2ludCA9IGNjLnYyKHgsIHkpO1xyXG4gICAgICAgICAgICAvLyB2YXIgZGlyID0gY2MucFN1Yihub3dfcG9pbnQsIHByZXZfcG9pbnQpO1xyXG4gICAgICAgICAgICB2YXIgZGlyID0gbm93X3BvaW50LnN1YihwcmV2X3BvaW50KTtcclxuICAgICAgICAgICAgcHJldl9wb2ludCA9IG5vd19wb2ludDtcclxuICAgICAgICAgICAgbGVuZ3RoICs9IGRpci5tYWcoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHQgKz0gMC4wNTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGxlbmd0aDtcclxuICAgIH1cclxuICAgIC8vIGNhbGxlZCBldmVyeSBmcmFtZSwgdW5jb21tZW50IHRoaXMgZnVuY3Rpb24gdG8gYWN0aXZhdGUgdXBkYXRlIGNhbGxiYWNrXHJcbiAgICAvLyB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xyXG5cclxuICAgIC8vIH0sXHJcbn0pO1xyXG4iXX0=