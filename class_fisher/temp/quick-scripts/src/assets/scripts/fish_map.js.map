{"version":3,"sources":["assets\\scripts\\fish_map.js"],"names":["cc","Class","Component","properties","is_debug","onLoad","anim_com","node","getComponent","Animation","clips","getClips","clip","graphics","addComponent","Graphics","fillColor","color","paths","curveData","road_data_set","k","road_data","props","position","gen_path_data","draw_roads","start","get_road_set","ctrl1","start_point","end_point","ctrl2","road_curve_path","i","length","key_frame","push","v2","value","j","motionPath","console","log","one_road","index","len","bezier_length","OFFSET","count","Math","floor","t_delta","t","x","y","path","clear","moveTo","lineTo","close","fill","prev_point","now_point","dir","sub","mag"],"mappings":";;;;;;AACAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,IAAAA,QAAQ,EAAE;AAXF,GAHP;AAiBL;AACAC,EAAAA,MAAM,EAAE,kBAAY;AAChB,SAAKC,QAAL,GAAgB,KAAKC,IAAL,CAAUC,YAAV,CAAuBR,EAAE,CAACS,SAA1B,CAAhB;AACA,QAAIC,KAAK,GAAG,KAAKJ,QAAL,CAAcK,QAAd,EAAZ;AACA,QAAIC,IAAI,GAAGF,KAAK,CAAC,CAAD,CAAhB;AAEA,SAAKG,QAAL,GAAgB,KAAKN,IAAL,CAAUO,YAAV,CAAuBd,EAAE,CAACe,QAA1B,CAAhB;AACA,SAAKF,QAAL,CAAcG,SAAd,GAA0BhB,EAAE,CAACiB,KAAH,CAAS,GAAT,EAAc,CAAd,EAAiB,CAAjB,EAAoB,GAApB,CAA1B;AACA,QAAIC,KAAK,GAAGN,IAAI,CAACO,SAAL,CAAeD,KAA3B,CAPgB,CAQhB;;AAEA,SAAKE,aAAL,GAAqB,EAArB;AAEA,QAAIC,CAAJ;;AACA,SAAKA,CAAL,IAAUH,KAAV,EAAiB;AACb,UAAII,SAAS,GAAGJ,KAAK,CAACG,CAAD,CAAL,CAASE,KAAT,CAAeC,QAA/B;AACA,WAAKC,aAAL,CAAmBH,SAAnB;AACH;;AAED,QAAI,KAAKlB,QAAT,EAAmB;AACf,WAAKsB,UAAL;AACH;AACJ,GAvCI;AAyCLC,EAAAA,KAAK,EAAE,iBAAW;AACd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ;AACH,GAtDI;AAwDLC,EAAAA,YAAY,EAAE,wBAAW;AACrB,WAAO,KAAKR,aAAZ;AACH,GA1DI;AA4DLK,EAAAA,aAAa,EAAE,uBAASH,SAAT,EAAoB;AAC/B,QAAIO,KAAK,GAAG,IAAZ;AACA,QAAIC,WAAW,GAAG,IAAlB;AACA,QAAIC,SAAS,GAAG,IAAhB;AACA,QAAIC,KAAK,GAAG,IAAZ;AAEA,QAAIC,eAAe,GAAG,EAAtB,CAN+B,CAML;;AAC1B,SAAI,IAAIC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGZ,SAAS,CAACa,MAA7B,EAAqCD,CAAC,EAAtC,EAA2C;AACvC,UAAIE,SAAS,GAAGd,SAAS,CAACY,CAAD,CAAzB;;AACA,UAAIL,KAAK,KAAK,IAAd,EAAoB;AAChBI,QAAAA,eAAe,CAACI,IAAhB,CAAqB,CAACP,WAAD,EAAcD,KAAd,EAAqBA,KAArB,EAA4B7B,EAAE,CAACsC,EAAH,CAAMF,SAAS,CAACG,KAAV,CAAgB,CAAhB,CAAN,EAA0BH,SAAS,CAACG,KAAV,CAAgB,CAAhB,CAA1B,CAA5B,CAArB;AACH;;AAEDT,MAAAA,WAAW,GAAG9B,EAAE,CAACsC,EAAH,CAAMF,SAAS,CAACG,KAAV,CAAgB,CAAhB,CAAN,EAA0BH,SAAS,CAACG,KAAV,CAAgB,CAAhB,CAA1B,CAAd;;AAEA,WAAI,IAAIC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGJ,SAAS,CAACK,UAAV,CAAqBN,MAAxC,EAAgDK,CAAC,EAAjD,EAAsD;AAClD,YAAIT,SAAS,GAAG/B,EAAE,CAACsC,EAAH,CAAMF,SAAS,CAACK,UAAV,CAAqBD,CAArB,EAAwB,CAAxB,CAAN,EAAkCJ,SAAS,CAACK,UAAV,CAAqBD,CAArB,EAAwB,CAAxB,CAAlC,CAAhB;AACAR,QAAAA,KAAK,GAAGhC,EAAE,CAACsC,EAAH,CAAMF,SAAS,CAACK,UAAV,CAAqBD,CAArB,EAAwB,CAAxB,CAAN,EAAkCJ,SAAS,CAACK,UAAV,CAAqBD,CAArB,EAAwB,CAAxB,CAAlC,CAAR;;AACA,YAAIX,KAAK,KAAK,IAAd,EAAoB;AAChBA,UAAAA,KAAK,GAAGG,KAAR;AACH,SALiD,CAMlD;;;AACAC,QAAAA,eAAe,CAACI,IAAhB,CAAqB,CAACP,WAAD,EAAcD,KAAd,EAAqBG,KAArB,EAA4BD,SAA5B,CAArB;AACAF,QAAAA,KAAK,GAAG7B,EAAE,CAACsC,EAAH,CAAMF,SAAS,CAACK,UAAV,CAAqBD,CAArB,EAAwB,CAAxB,CAAN,EAAkCJ,SAAS,CAACK,UAAV,CAAqBD,CAArB,EAAwB,CAAxB,CAAlC,CAAR;AACAV,QAAAA,WAAW,GAAGC,SAAd;AACH;AACJ;;AAEDW,IAAAA,OAAO,CAACC,GAAR,CAAYV,eAAZ;AAEA,QAAIW,QAAQ,GAAG,CAACX,eAAe,CAAC,CAAD,CAAf,CAAmB,CAAnB,CAAD,CAAf;;AAEA,SAAI,IAAIY,KAAK,GAAG,CAAhB,EAAmBA,KAAK,GAAGZ,eAAe,CAACE,MAA3C,EAAmDU,KAAK,EAAxD,EAA6D;AACzDf,MAAAA,WAAW,GAAGG,eAAe,CAACY,KAAD,CAAf,CAAuB,CAAvB,CAAd;AACAhB,MAAAA,KAAK,GAAGI,eAAe,CAACY,KAAD,CAAf,CAAuB,CAAvB,CAAR;AACAb,MAAAA,KAAK,GAAGC,eAAe,CAACY,KAAD,CAAf,CAAuB,CAAvB,CAAR;AACAd,MAAAA,SAAS,GAAGE,eAAe,CAACY,KAAD,CAAf,CAAuB,CAAvB,CAAZ;AAEA,UAAIC,GAAG,GAAG,KAAKC,aAAL,CAAmBjB,WAAnB,EAAgCD,KAAhC,EAAuCG,KAAvC,EAA8CD,SAA9C,CAAV;AACA,UAAIiB,MAAM,GAAG,EAAb;AACA,UAAIC,KAAK,GAAGH,GAAG,GAAGE,MAAlB;AACAC,MAAAA,KAAK,GAAGC,IAAI,CAACC,KAAL,CAAWF,KAAX,CAAR;AACA,UAAIG,OAAO,GAAG,IAAIH,KAAlB;AACA,UAAII,CAAC,GAAGD,OAAR;;AAEA,WAAI,IAAIlB,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGe,KAAnB,EAA0Bf,CAAC,EAA3B,EAAgC;AAC5B,YAAIoB,CAAC,GAAGxB,WAAW,CAACwB,CAAZ,IAAiB,IAAID,CAArB,KAA2B,IAAIA,CAA/B,KAAqC,IAAIA,CAAzC,IAA8C,IAAIxB,KAAK,CAACyB,CAAV,GAAcD,CAAd,IAAmB,IAAIA,CAAvB,KAA6B,IAAIA,CAAjC,CAA9C,GAAoF,IAAIrB,KAAK,CAACsB,CAAV,GAAcD,CAAd,GAAkBA,CAAlB,IAAuB,IAAIA,CAA3B,CAApF,GAAoHtB,SAAS,CAACuB,CAAV,GAAcD,CAAd,GAAkBA,CAAlB,GAAsBA,CAAlJ;AACA,YAAIE,CAAC,GAAGzB,WAAW,CAACyB,CAAZ,IAAiB,IAAIF,CAArB,KAA2B,IAAIA,CAA/B,KAAqC,IAAIA,CAAzC,IAA8C,IAAIxB,KAAK,CAAC0B,CAAV,GAAcF,CAAd,IAAmB,IAAIA,CAAvB,KAA6B,IAAIA,CAAjC,CAA9C,GAAoF,IAAIrB,KAAK,CAACuB,CAAV,GAAcF,CAAd,GAAkBA,CAAlB,IAAuB,IAAIA,CAA3B,CAApF,GAAoHtB,SAAS,CAACwB,CAAV,GAAcF,CAAd,GAAkBA,CAAlB,GAAsBA,CAAlJ;AACAT,QAAAA,QAAQ,CAACP,IAAT,CAAcrC,EAAE,CAACsC,EAAH,CAAMgB,CAAN,EAASC,CAAT,CAAd;AACAF,QAAAA,CAAC,IAAID,OAAL;AACH;AACJ;;AAEDV,IAAAA,OAAO,CAACC,GAAR,CAAYC,QAAZ;AACA,SAAKxB,aAAL,CAAmBiB,IAAnB,CAAwBO,QAAxB;AACH,GAnHI;AAqHLlB,EAAAA,UArHK,sBAqHM8B,IArHN,EAqHY;AACb,SAAK3C,QAAL,CAAc4C,KAAd;;AAEA,SAAI,IAAIjB,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKpB,aAAL,CAAmBe,MAAtC,EAA8CK,CAAC,EAA/C,EAAoD;AAChD,UAAIgB,IAAI,GAAG,KAAKpC,aAAL,CAAmBoB,CAAnB,CAAX;;AAEA,WAAI,IAAIN,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGsB,IAAI,CAACrB,MAAxB,EAAgCD,CAAC,EAAjC,EAAsC;AAClC,aAAKrB,QAAL,CAAc6C,MAAd,CAAqBF,IAAI,CAACtB,CAAD,CAAJ,CAAQoB,CAAR,GAAY,CAAjC,EAAoCE,IAAI,CAACtB,CAAD,CAAJ,CAAQqB,CAAR,GAAY,CAAhD;AACA,aAAK1C,QAAL,CAAc8C,MAAd,CAAqBH,IAAI,CAACtB,CAAD,CAAJ,CAAQoB,CAAR,GAAY,CAAjC,EAAoCE,IAAI,CAACtB,CAAD,CAAJ,CAAQqB,CAAR,GAAY,CAAhD;AACA,aAAK1C,QAAL,CAAc8C,MAAd,CAAqBH,IAAI,CAACtB,CAAD,CAAJ,CAAQoB,CAAR,GAAY,CAAjC,EAAoCE,IAAI,CAACtB,CAAD,CAAJ,CAAQqB,CAAR,GAAY,CAAhD;AACA,aAAK1C,QAAL,CAAc8C,MAAd,CAAqBH,IAAI,CAACtB,CAAD,CAAJ,CAAQoB,CAAR,GAAY,CAAjC,EAAoCE,IAAI,CAACtB,CAAD,CAAJ,CAAQqB,CAAR,GAAY,CAAhD;AACA,aAAK1C,QAAL,CAAc+C,KAAd,GALkC,CAKX;AAC1B;AACJ,KAbY,CAeb;AACA;;;AACA,SAAK/C,QAAL,CAAcgD,IAAd;AACH,GAvII;AAyILd,EAAAA,aAAa,EAAE,uBAASjB,WAAT,EAAsBD,KAAtB,EAA6BG,KAA7B,EAAoCD,SAApC,EAA+C;AAC1D;AACA,QAAI+B,UAAU,GAAGhC,WAAjB;AACA,QAAIK,MAAM,GAAG,CAAb;AACA,QAAIkB,CAAC,GAAG,IAAR;;AACA,SAAI,IAAInB,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,EAAnB,EAAuBA,CAAC,EAAxB,EAA6B;AACzB,UAAIoB,CAAC,GAAGxB,WAAW,CAACwB,CAAZ,IAAiB,IAAID,CAArB,KAA2B,IAAIA,CAA/B,KAAqC,IAAIA,CAAzC,IAA8C,IAAIxB,KAAK,CAACyB,CAAV,GAAcD,CAAd,IAAmB,IAAIA,CAAvB,KAA6B,IAAIA,CAAjC,CAA9C,GAAoF,IAAIrB,KAAK,CAACsB,CAAV,GAAcD,CAAd,GAAkBA,CAAlB,IAAuB,IAAIA,CAA3B,CAApF,GAAoHtB,SAAS,CAACuB,CAAV,GAAcD,CAAd,GAAkBA,CAAlB,GAAsBA,CAAlJ;AACA,UAAIE,CAAC,GAAGzB,WAAW,CAACyB,CAAZ,IAAiB,IAAIF,CAArB,KAA2B,IAAIA,CAA/B,KAAqC,IAAIA,CAAzC,IAA8C,IAAIxB,KAAK,CAAC0B,CAAV,GAAcF,CAAd,IAAmB,IAAIA,CAAvB,KAA6B,IAAIA,CAAjC,CAA9C,GAAoF,IAAIrB,KAAK,CAACuB,CAAV,GAAcF,CAAd,GAAkBA,CAAlB,IAAuB,IAAIA,CAA3B,CAApF,GAAoHtB,SAAS,CAACwB,CAAV,GAAcF,CAAd,GAAkBA,CAAlB,GAAsBA,CAAlJ;AACA,UAAIU,SAAS,GAAG/D,EAAE,CAACsC,EAAH,CAAMgB,CAAN,EAASC,CAAT,CAAhB,CAHyB,CAIzB;;AACA,UAAIS,GAAG,GAAGD,SAAS,CAACE,GAAV,CAAcH,UAAd,CAAV;AACAA,MAAAA,UAAU,GAAGC,SAAb;AACA5B,MAAAA,MAAM,IAAI6B,GAAG,CAACE,GAAJ,EAAV;AAEAb,MAAAA,CAAC,IAAI,IAAL;AACH;;AACD,WAAOlB,MAAP;AACH,GA1JI,CA2JL;AACA;AAEA;;AA9JK,CAAT","sourceRoot":"/","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        is_debug: false,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.anim_com = this.node.getComponent(cc.Animation);\r\n        var clips = this.anim_com.getClips();\r\n        var clip = clips[0];\r\n        \r\n        this.graphics = this.node.addComponent(cc.Graphics);\r\n        this.graphics.fillColor = cc.color(255, 0, 0, 255);\r\n        var paths = clip.curveData.paths;\r\n        // console.log(paths);\r\n        \r\n        this.road_data_set = [];\r\n        \r\n        var k;\r\n        for (k in paths) {\r\n            var road_data = paths[k].props.position;\r\n            this.gen_path_data(road_data);\r\n        }\r\n\r\n        if (this.is_debug) {\r\n            this.draw_roads();\r\n        }\r\n    },\r\n    \r\n    start: function() {\r\n        /*\r\n        // test()\r\n        var actor = cc.find(\"UI_ROOT/map_root/ememy_gorilla\").getComponent(\"actor\");\r\n        // actor.gen_at_road(this.road_data_set[0]);\r\n        \r\n        actor = cc.find(\"UI_ROOT/map_root/ememy_small2\").getComponent(\"actor\");\r\n        // actor.gen_at_road(this.road_data_set[1]);\r\n        \r\n        actor = cc.find(\"UI_ROOT/map_root/ememy_small3\").getComponent(\"actor\");\r\n        actor.gen_at_road(this.road_data_set[2]);\r\n        */\r\n        // end \r\n    },\r\n    \r\n    get_road_set: function() {\r\n        return this.road_data_set;\r\n    },\r\n    \r\n    gen_path_data: function(road_data) {\r\n        var ctrl1 = null;\r\n        var start_point = null;\r\n        var end_point = null;\r\n        var ctrl2 = null;\r\n        \r\n        var road_curve_path = []; // [start_point, ctrl1, ctrl2, end_point],\r\n        for(var i = 0; i < road_data.length; i ++) {\r\n            var key_frame = road_data[i];\r\n            if (ctrl1 !== null) {\r\n                road_curve_path.push([start_point, ctrl1, ctrl1, cc.v2(key_frame.value[0], key_frame.value[1])]);\r\n            }\r\n            \r\n            start_point = cc.v2(key_frame.value[0], key_frame.value[1]);\r\n            \r\n            for(var j = 0; j < key_frame.motionPath.length; j ++) {\r\n                var end_point = cc.v2(key_frame.motionPath[j][0], key_frame.motionPath[j][1]);\r\n                ctrl2 = cc.v2(key_frame.motionPath[j][2], key_frame.motionPath[j][3]);\r\n                if (ctrl1 === null) {\r\n                    ctrl1 = ctrl2;\r\n                }\r\n                // 贝塞尔曲线 start_point, ctrl1, ctrl2, end_point,\r\n                road_curve_path.push([start_point, ctrl1, ctrl2, end_point]);\r\n                ctrl1 = cc.v2(key_frame.motionPath[j][4], key_frame.motionPath[j][5]);\r\n                start_point = end_point;\r\n            }\r\n        }\r\n        \r\n        console.log(road_curve_path);\r\n        \r\n        var one_road = [road_curve_path[0][0]];\r\n        \r\n        for(var index = 0; index < road_curve_path.length; index ++) {\r\n            start_point = road_curve_path[index][0];\r\n            ctrl1 = road_curve_path[index][1];\r\n            ctrl2 = road_curve_path[index][2];\r\n            end_point = road_curve_path[index][3];\r\n            \r\n            var len = this.bezier_length(start_point, ctrl1, ctrl2, end_point);\r\n            var OFFSET = 16;\r\n            var count = len / OFFSET;\r\n            count = Math.floor(count);\r\n            var t_delta = 1 / count;\r\n            var t = t_delta;\r\n            \r\n            for(var i = 0; i < count; i ++) {\r\n                var x = start_point.x * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.x * t * (1 - t) * (1 - t) + 3 * ctrl2.x * t * t * (1 - t) + end_point.x * t * t * t;\r\n                var y = start_point.y * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.y * t * (1 - t) * (1 - t) + 3 * ctrl2.y * t * t * (1 - t) + end_point.y * t * t * t;\r\n                one_road.push(cc.v2(x, y));\r\n                t += t_delta;\r\n            }\r\n        }\r\n        \r\n        console.log(one_road);\r\n        this.road_data_set.push(one_road);\r\n    }, \r\n\r\n    draw_roads(path) {\r\n        this.graphics.clear();\r\n\r\n        for(var j = 0; j < this.road_data_set.length; j ++) {\r\n            var path = this.road_data_set[j];\r\n\r\n            for(var i = 0; i < path.length; i ++) {\r\n                this.graphics.moveTo(path[i].x - 2, path[i].y + 2);\r\n                this.graphics.lineTo(path[i].x - 2, path[i].y - 2);\r\n                this.graphics.lineTo(path[i].x + 2, path[i].y - 2);\r\n                this.graphics.lineTo(path[i].x + 2, path[i].y + 2);\r\n                this.graphics.close(); // 组成一个封闭的路径\r\n            }\r\n        }\r\n        \r\n        // 画先，填充;\r\n        // this.graphics.stroke();\r\n        this.graphics.fill();\r\n    }, \r\n\r\n    bezier_length: function(start_point, ctrl1, ctrl2, end_point) {\r\n        // t [0, 1] t 分成20等分 1 / 20 = 0.05\r\n        var prev_point = start_point;\r\n        var length = 0;\r\n        var t = 0.05;\r\n        for(var i = 0; i < 20; i ++) {\r\n            var x = start_point.x * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.x * t * (1 - t) * (1 - t) + 3 * ctrl2.x * t * t * (1 - t) + end_point.x * t * t * t;\r\n            var y = start_point.y * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.y * t * (1 - t) * (1 - t) + 3 * ctrl2.y * t * t * (1 - t) + end_point.y * t * t * t;\r\n            var now_point = cc.v2(x, y);\r\n            // var dir = cc.pSub(now_point, prev_point);\r\n            var dir = now_point.sub(prev_point);\r\n            prev_point = now_point;\r\n            length += dir.mag();\r\n            \r\n            t += 0.05;\r\n        }\r\n        return length;\r\n    }\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}