{"version":3,"sources":["assets\\scripts\\Game.js"],"names":["Player","require","ScoreFX","Star","Game","cc","Class","Component","properties","starPrefab","type","Prefab","scoreFXPrefab","maxStarDuration","minStarDuration","ground","Node","player","scoreDisplay","Label","scoreAudio","AudioClip","btnNode","gameOverNode","controlHintLabel","keyboardHint","multiline","touchHint","onLoad","groundY","y","height","currentStar","currentStarX","timer","starDuration","enabled","hintText","sys","isMobile","string","starPool","NodePool","scorePool","onStartGame","resetScore","x","active","startMoveAt","v2","spawnNewStar","newStar","size","get","instantiate","node","addChild","setPosition","getNewStarPosition","getComponent","init","startTimer","despawnStar","star","put","Math","random","width","randX","randY","jumpHeight","maxX","gainScore","pos","score","toString","fx","spawnScoreFX","play","audioEngine","playEffect","despawnScoreFX","scoreFX","update","dt","gameOver","stopMove","destroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["const Player = require('Player');\r\nconst ScoreFX = require('ScoreFX');\r\nconst Star = require('Star');\r\n\r\nvar Game = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 这个属性引用了星星预制资源\r\n        starPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        scoreFXPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 星星产生后消失时间的随机范围\r\n        maxStarDuration: 0,\r\n        minStarDuration: 0,\r\n        // 地面节点，用于确定星星生成的高度\r\n        ground: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // player 节点，用于获取主角弹跳的高度，和控制主角行动开关\r\n        player: {\r\n            default: null,\r\n            type: Player\r\n        },\r\n        // score label 的引用\r\n        scoreDisplay: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        // 得分音效资源\r\n        scoreAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        btnNode: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        gameOverNode: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        controlHintLabel: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        keyboardHint: {\r\n            default: '',\r\n            multiline: true\r\n        },\r\n        touchHint: {\r\n            default: '',\r\n            multiline: true\r\n        },\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        // 获取地平面的 y 轴坐标\r\n        this.groundY = this.ground.y + this.ground.height/2;\r\n\r\n        // store last star's x position\r\n        this.currentStar = null;\r\n        this.currentStarX = 0;\r\n\r\n        // 初始化计时器\r\n        this.timer = 0;\r\n        this.starDuration = 0;\r\n\r\n        // is showing menu or running game\r\n        this.enabled = false;\r\n\r\n        // initialize control hint\r\n        var hintText = cc.sys.isMobile ? this.touchHint : this.keyboardHint;\r\n        this.controlHintLabel.string = hintText;\r\n\r\n        // initialize star and score pool\r\n        this.starPool = new cc.NodePool('Star');\r\n        this.scorePool = new cc.NodePool('ScoreFX');\r\n    },\r\n\r\n    onStartGame: function () {\r\n        // 初始化计分\r\n        this.resetScore();\r\n        // set game state to running\r\n        this.enabled = true;\r\n        // set button and gameover text out of screen\r\n        this.btnNode.x = 3000;\r\n        this.gameOverNode.active = false;\r\n        // reset player position and move speed\r\n        this.player.startMoveAt(cc.v2(0, this.groundY));\r\n        // spawn star\r\n        this.spawnNewStar();\r\n    },\r\n\r\n    spawnNewStar: function() {\r\n        var newStar = null;\r\n        // 使用给定的模板在场景中生成一个新节点\r\n        if (this.starPool.size() > 0) {\r\n            newStar = this.starPool.get(this); // this will be passed to Star's reuse method\r\n        } else {\r\n            newStar = cc.instantiate(this.starPrefab);\r\n        }\r\n        // 将新增的节点添加到 Canvas 节点下面\r\n        this.node.addChild(newStar);\r\n        // 为星星设置一个随机位置\r\n        newStar.setPosition(this.getNewStarPosition());\r\n        // pass Game instance to star\r\n        newStar.getComponent('Star').init(this);\r\n        // start star timer and store star reference\r\n        this.startTimer();\r\n        this.currentStar = newStar;\r\n    },\r\n\r\n    despawnStar (star) {\r\n        this.starPool.put(star);\r\n        this.spawnNewStar();\r\n    },\r\n\r\n    startTimer: function () {\r\n        // get a life duration for next star\r\n        this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);\r\n        this.timer = 0;\r\n    },\r\n\r\n    getNewStarPosition: function () {\r\n        // if there's no star, set a random x pos\r\n        if (!this.currentStar) {\r\n            this.currentStarX = (Math.random() - 0.5) * 2 * this.node.width/2;\r\n        }\r\n        var randX = 0;\r\n        // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\r\n        var randY = this.groundY + Math.random() * this.player.jumpHeight + 50;\r\n        // 根据屏幕宽度和上一个星星的 x 坐标，随机得到一个新生成星星 x 坐标\r\n        var maxX = this.node.width/2;\r\n        if (this.currentStarX >= 0) {\r\n            randX = -Math.random() * maxX;\r\n        } else {\r\n            randX = Math.random() * maxX;\r\n        }\r\n        this.currentStarX = randX;\r\n        // 返回星星坐标\r\n        return cc.v2(randX, randY);\r\n    },\r\n\r\n    gainScore: function (pos) {\r\n        this.score += 1;\r\n        // 更新 scoreDisplay Label 的文字\r\n        this.scoreDisplay.string = 'Score: ' + this.score.toString();\r\n        // 播放特效\r\n        var fx = this.spawnScoreFX();\r\n        this.node.addChild(fx.node);\r\n        fx.node.setPosition(pos);\r\n        fx.play();\r\n        // 播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n    },\r\n\r\n    resetScore: function () {\r\n        this.score = 0;\r\n        this.scoreDisplay.string = 'Score: ' + this.score.toString();\r\n    },\r\n\r\n    spawnScoreFX: function () {\r\n        var fx;\r\n        if (this.scorePool.size() > 0) {\r\n            fx = this.scorePool.get();\r\n            return fx.getComponent('ScoreFX');\r\n        } else {\r\n            fx = cc.instantiate(this.scoreFXPrefab).getComponent('ScoreFX');\r\n            fx.init(this);\r\n            return fx;\r\n        }\r\n    },\r\n\r\n    despawnScoreFX (scoreFX) {\r\n        this.scorePool.put(scoreFX);\r\n    },\r\n\r\n    // called every frame\r\n    update: function (dt) {\r\n        // 每帧更新计时器，超过限度还没有生成新的星星\r\n        // 就会调用游戏失败逻辑\r\n        if (this.timer > this.starDuration) {\r\n            this.gameOver();\r\n            this.enabled = false;   // disable this to avoid gameOver() repeatedly\r\n            return;\r\n        }\r\n        this.timer += dt;\r\n    },\r\n\r\n    gameOver: function () {\r\n        this.gameOverNode.active = true;\r\n        this.player.enabled = false;\r\n        this.player.stopMove();\r\n        this.currentStar.destroy();\r\n        this.btnNode.x = 0;\r\n    }\r\n});\r\n"]}