
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Player.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'c10bbPdGYhDWaLoKLV38bHf', 'Player');
// scripts/Player.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    // 主角跳跃高度
    jumpHeight: 0,
    // 主角跳跃持续时间
    jumpDuration: 0,
    // 辅助形变动作时间
    squashDuration: 0,
    // 最大移动速度
    maxMoveSpeed: 0,
    // 加速度
    accel: 0,
    // 跳跃音效资源
    jumpAudio: {
      "default": null,
      type: cc.AudioClip
    }
  },
  // use this for initialization
  onLoad: function onLoad() {
    this.enabled = false; // 加速度方向开关

    this.accLeft = false;
    this.accRight = false; // 主角当前水平方向速度

    this.xSpeed = 0; // screen boundaries

    this.minPosX = -this.node.parent.width / 2;
    this.maxPosX = this.node.parent.width / 2; // 初始化键盘输入监听

    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);
    var touchReceiver = cc.Canvas.instance.node;
    touchReceiver.on('touchstart', this.onTouchStart, this);
    touchReceiver.on('touchend', this.onTouchEnd, this);
  },
  onDestroy: function onDestroy() {
    // 取消键盘输入监听
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);
    var touchReceiver = cc.Canvas.instance.node;
    touchReceiver.off('touchstart', this.onTouchStart, this);
    touchReceiver.off('touchend', this.onTouchEnd, this);
  },
  onKeyDown: function onKeyDown(event) {
    switch (event.keyCode) {
      case cc.macro.KEY.a:
      case cc.macro.KEY.left:
        this.accLeft = true;
        this.accRight = false;
        break;

      case cc.macro.KEY.d:
      case cc.macro.KEY.right:
        this.accLeft = false;
        this.accRight = true;
        break;
    }
  },
  onKeyUp: function onKeyUp(event) {
    switch (event.keyCode) {
      case cc.macro.KEY.a:
      case cc.macro.KEY.left:
        this.accLeft = false;
        break;

      case cc.macro.KEY.d:
      case cc.macro.KEY.right:
        this.accRight = false;
        break;
    }
  },
  onTouchStart: function onTouchStart(event) {
    var touchLoc = event.getLocation();

    if (touchLoc.x >= cc.winSize.width / 2) {
      this.accLeft = false;
      this.accRight = true;
    } else {
      this.accLeft = true;
      this.accRight = false;
    }
  },
  onTouchEnd: function onTouchEnd(event) {
    this.accLeft = false;
    this.accRight = false;
  },
  runJumpAction: function runJumpAction() {
    // 跳跃上升
    var jumpUp = cc.tween().by(this.jumpDuration, {
      y: this.jumpHeight
    }, {
      easing: 'sineOut'
    }); // 下落

    var jumpDown = cc.tween().by(this.jumpDuration, {
      y: -this.jumpHeight
    }, {
      easing: 'sineIn'
    }); // 形变

    var squash = cc.tween().to(this.squashDuration, {
      scaleX: 1,
      scaleY: 0.6
    });
    var stretch = cc.tween().to(this.squashDuration, {
      scaleX: 1,
      scaleY: 1.2
    });
    var scaleBack = cc.tween().to(this.squashDuration, {
      scaleX: 1,
      scaleY: 1
    }); // 创建一个缓动

    var tween = cc.tween() // 按顺序执行动作
    .sequence(squash, stretch, jumpUp, scaleBack, jumpDown) // 添加一个回调函数，在前面的动作都结束时调用我们定义的 playJumpSound() 方法
    .call(this.playJumpSound, this); // 不断重复

    return cc.tween().repeatForever(tween);
  },
  playJumpSound: function playJumpSound() {
    // 调用声音引擎播放声音
    cc.audioEngine.playEffect(this.jumpAudio, false);
  },
  getCenterPos: function getCenterPos() {
    var centerPos = cc.v2(this.node.x, this.node.y + this.node.height / 2);
    return centerPos;
  },
  startMoveAt: function startMoveAt(pos) {
    this.enabled = true;
    this.xSpeed = 0;
    this.node.setPosition(pos);
    var jumpAction = this.runJumpAction();
    cc.tween(this.node).then(jumpAction).start();
  },
  stopMove: function stopMove() {
    this.node.stopAllActions();
  },
  // called every frame
  update: function update(dt) {
    // 根据当前加速度方向每帧更新速度
    if (this.accLeft) {
      this.xSpeed -= this.accel * dt;
    } else if (this.accRight) {
      this.xSpeed += this.accel * dt;
    } // 限制主角的速度不能超过最大值


    if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {
      // if speed reach limit, use max speed with current direction
      this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);
    } // 根据当前速度更新主角的位置


    this.node.x += this.xSpeed * dt; // limit player position inside screen

    if (this.node.x > this.node.parent.width / 2) {
      this.node.x = this.node.parent.width / 2;
      this.xSpeed = 0;
    } else if (this.node.x < -this.node.parent.width / 2) {
      this.node.x = -this.node.parent.width / 2;
      this.xSpeed = 0;
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcUGxheWVyLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwianVtcEhlaWdodCIsImp1bXBEdXJhdGlvbiIsInNxdWFzaER1cmF0aW9uIiwibWF4TW92ZVNwZWVkIiwiYWNjZWwiLCJqdW1wQXVkaW8iLCJ0eXBlIiwiQXVkaW9DbGlwIiwib25Mb2FkIiwiZW5hYmxlZCIsImFjY0xlZnQiLCJhY2NSaWdodCIsInhTcGVlZCIsIm1pblBvc1giLCJub2RlIiwicGFyZW50Iiwid2lkdGgiLCJtYXhQb3NYIiwic3lzdGVtRXZlbnQiLCJvbiIsIlN5c3RlbUV2ZW50IiwiRXZlbnRUeXBlIiwiS0VZX0RPV04iLCJvbktleURvd24iLCJLRVlfVVAiLCJvbktleVVwIiwidG91Y2hSZWNlaXZlciIsIkNhbnZhcyIsImluc3RhbmNlIiwib25Ub3VjaFN0YXJ0Iiwib25Ub3VjaEVuZCIsIm9uRGVzdHJveSIsIm9mZiIsImV2ZW50Iiwia2V5Q29kZSIsIm1hY3JvIiwiS0VZIiwiYSIsImxlZnQiLCJkIiwicmlnaHQiLCJ0b3VjaExvYyIsImdldExvY2F0aW9uIiwieCIsIndpblNpemUiLCJydW5KdW1wQWN0aW9uIiwianVtcFVwIiwidHdlZW4iLCJieSIsInkiLCJlYXNpbmciLCJqdW1wRG93biIsInNxdWFzaCIsInRvIiwic2NhbGVYIiwic2NhbGVZIiwic3RyZXRjaCIsInNjYWxlQmFjayIsInNlcXVlbmNlIiwiY2FsbCIsInBsYXlKdW1wU291bmQiLCJyZXBlYXRGb3JldmVyIiwiYXVkaW9FbmdpbmUiLCJwbGF5RWZmZWN0IiwiZ2V0Q2VudGVyUG9zIiwiY2VudGVyUG9zIiwidjIiLCJoZWlnaHQiLCJzdGFydE1vdmVBdCIsInBvcyIsInNldFBvc2l0aW9uIiwianVtcEFjdGlvbiIsInRoZW4iLCJzdGFydCIsInN0b3BNb3ZlIiwic3RvcEFsbEFjdGlvbnMiLCJ1cGRhdGUiLCJkdCIsIk1hdGgi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R0FBYyxDQUFDLEtBQUs3QixJQUFMLENBQVVDLE1BQVYsQ0FBaUJDLEtBQWxCLEdBQXdCLENBQXRDO0FBQ0EsV0FBS0osTUFBTCxHQUFjLENBQWQ7QUFDSDtBQUNKO0FBcktJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgLy8g5Li76KeS6Lez6LeD6auY5bqmXHJcbiAgICAgICAganVtcEhlaWdodDogMCxcclxuICAgICAgICAvLyDkuLvop5Lot7Pot4PmjIHnu63ml7bpl7RcclxuICAgICAgICBqdW1wRHVyYXRpb246IDAsXHJcbiAgICAgICAgLy8g6L6F5Yqp5b2i5Y+Y5Yqo5L2c5pe26Ze0XHJcbiAgICAgICAgc3F1YXNoRHVyYXRpb246IDAsXHJcbiAgICAgICAgLy8g5pyA5aSn56e75Yqo6YCf5bqmXHJcbiAgICAgICAgbWF4TW92ZVNwZWVkOiAwLFxyXG4gICAgICAgIC8vIOWKoOmAn+W6plxyXG4gICAgICAgIGFjY2VsOiAwLFxyXG4gICAgICAgIC8vIOi3s+i3g+mfs+aViOi1hOa6kFxyXG4gICAgICAgIGp1bXBBdWRpbzoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICAgICAgICB0eXBlOiBjYy5BdWRpb0NsaXBcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuXHJcbiAgICAvLyB1c2UgdGhpcyBmb3IgaW5pdGlhbGl6YXRpb25cclxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIC8vIOWKoOmAn+W6puaWueWQkeW8gOWFs1xyXG4gICAgICAgIHRoaXMuYWNjTGVmdCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuYWNjUmlnaHQgPSBmYWxzZTtcclxuICAgICAgICAvLyDkuLvop5LlvZPliY3msLTlubPmlrnlkJHpgJ/luqZcclxuICAgICAgICB0aGlzLnhTcGVlZCA9IDA7XHJcbiAgICAgICAgLy8gc2NyZWVuIGJvdW5kYXJpZXNcclxuICAgICAgICB0aGlzLm1pblBvc1ggPSAtdGhpcy5ub2RlLnBhcmVudC53aWR0aC8yO1xyXG4gICAgICAgIHRoaXMubWF4UG9zWCA9IHRoaXMubm9kZS5wYXJlbnQud2lkdGgvMjtcclxuXHJcbiAgICAgICAgLy8g5Yid5aeL5YyW6ZSu55uY6L6T5YWl55uR5ZCsXHJcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub24oY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9ET1dOLCB0aGlzLm9uS2V5RG93biwgdGhpcyk7XHJcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub24oY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9VUCwgdGhpcy5vbktleVVwLCB0aGlzKTtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgdG91Y2hSZWNlaXZlciA9IGNjLkNhbnZhcy5pbnN0YW5jZS5ub2RlO1xyXG4gICAgICAgIHRvdWNoUmVjZWl2ZXIub24oJ3RvdWNoc3RhcnQnLCB0aGlzLm9uVG91Y2hTdGFydCwgdGhpcyk7XHJcbiAgICAgICAgdG91Y2hSZWNlaXZlci5vbigndG91Y2hlbmQnLCB0aGlzLm9uVG91Y2hFbmQsIHRoaXMpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkRlc3Ryb3kgKCkge1xyXG4gICAgICAgIC8vIOWPlua2iOmUruebmOi+k+WFpeebkeWQrFxyXG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9mZihjYy5TeXN0ZW1FdmVudC5FdmVudFR5cGUuS0VZX0RPV04sIHRoaXMub25LZXlEb3duLCB0aGlzKTtcclxuICAgICAgICBjYy5zeXN0ZW1FdmVudC5vZmYoY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9VUCwgdGhpcy5vbktleVVwLCB0aGlzKTtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgdG91Y2hSZWNlaXZlciA9IGNjLkNhbnZhcy5pbnN0YW5jZS5ub2RlO1xyXG4gICAgICAgIHRvdWNoUmVjZWl2ZXIub2ZmKCd0b3VjaHN0YXJ0JywgdGhpcy5vblRvdWNoU3RhcnQsIHRoaXMpO1xyXG4gICAgICAgIHRvdWNoUmVjZWl2ZXIub2ZmKCd0b3VjaGVuZCcsIHRoaXMub25Ub3VjaEVuZCwgdGhpcyk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uS2V5RG93biAoZXZlbnQpIHtcclxuICAgICAgICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xyXG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5hOlxyXG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5sZWZ0OlxyXG4gICAgICAgICAgICAgICAgdGhpcy5hY2NMZWZ0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWNjUmlnaHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5kOlxyXG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5yaWdodDpcclxuICAgICAgICAgICAgICAgIHRoaXMuYWNjTGVmdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hY2NSaWdodCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIG9uS2V5VXAgKGV2ZW50KSB7XHJcbiAgICAgICAgc3dpdGNoKGV2ZW50LmtleUNvZGUpIHtcclxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuYTpcclxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkubGVmdDpcclxuICAgICAgICAgICAgICAgIHRoaXMuYWNjTGVmdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmQ6XHJcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLnJpZ2h0OlxyXG4gICAgICAgICAgICAgICAgdGhpcy5hY2NSaWdodCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBvblRvdWNoU3RhcnQgKGV2ZW50KSB7XHJcbiAgICAgICAgdmFyIHRvdWNoTG9jID0gZXZlbnQuZ2V0TG9jYXRpb24oKTtcclxuICAgICAgICBpZiAodG91Y2hMb2MueCA+PSBjYy53aW5TaXplLndpZHRoLzIpIHtcclxuICAgICAgICAgICAgdGhpcy5hY2NMZWZ0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuYWNjUmlnaHQgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWNjTGVmdCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuYWNjUmlnaHQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIG9uVG91Y2hFbmQgKGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5hY2NMZWZ0ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5hY2NSaWdodCA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICBydW5KdW1wQWN0aW9uOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy8g6Lez6LeD5LiK5Y2HXHJcbiAgICAgICAgdmFyIGp1bXBVcCA9IGNjLnR3ZWVuKCkuYnkodGhpcy5qdW1wRHVyYXRpb24sIHsgeTogdGhpcy5qdW1wSGVpZ2h0IH0sIHsgZWFzaW5nOiAnc2luZU91dCcgfSk7XHJcbiAgICAgICAgLy8g5LiL6JC9XHJcbiAgICAgICAgdmFyIGp1bXBEb3duID0gY2MudHdlZW4oKS5ieSh0aGlzLmp1bXBEdXJhdGlvbiwgeyB5OiAtdGhpcy5qdW1wSGVpZ2h0IH0sIHsgZWFzaW5nOiAnc2luZUluJyB9KTtcclxuICAgICAgICAvLyDlvaLlj5hcclxuICAgICAgICB2YXIgc3F1YXNoID0gY2MudHdlZW4oKS50byh0aGlzLnNxdWFzaER1cmF0aW9uLCB7IHNjYWxlWDogMSwgc2NhbGVZOiAwLjYgfSk7XHJcbiAgICAgICAgdmFyIHN0cmV0Y2ggPSBjYy50d2VlbigpLnRvKHRoaXMuc3F1YXNoRHVyYXRpb24sIHsgc2NhbGVYOiAxLCBzY2FsZVk6IDEuMiB9KTtcclxuICAgICAgICB2YXIgc2NhbGVCYWNrID0gY2MudHdlZW4oKS50byh0aGlzLnNxdWFzaER1cmF0aW9uLCB7IHNjYWxlWDogMSwgc2NhbGVZOiAxIH0pO1xyXG5cclxuICAgICAgICAvLyDliJvlu7rkuIDkuKrnvJPliqhcclxuICAgICAgICB2YXIgdHdlZW4gPSBjYy50d2VlbigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOaMiemhuuW6j+aJp+ihjOWKqOS9nFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2VxdWVuY2Uoc3F1YXNoLCBzdHJldGNoLCBqdW1wVXAsIHNjYWxlQmFjaywganVtcERvd24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOa3u+WKoOS4gOS4quWbnuiwg+WHveaVsO+8jOWcqOWJjemdoueahOWKqOS9nOmDvee7k+adn+aXtuiwg+eUqOaIkeS7rOWumuS5ieeahCBwbGF5SnVtcFNvdW5kKCkg5pa55rOVXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKHRoaXMucGxheUp1bXBTb3VuZCwgdGhpcyk7XHJcblxyXG4gICAgICAgIC8vIOS4jeaWremHjeWkjVxyXG4gICAgICAgIHJldHVybiBjYy50d2VlbigpLnJlcGVhdEZvcmV2ZXIodHdlZW4pO1xyXG4gICAgfSxcclxuXHJcbiAgICBwbGF5SnVtcFNvdW5kOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy8g6LCD55So5aOw6Z+z5byV5pOO5pKt5pS+5aOw6Z+zXHJcbiAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheUVmZmVjdCh0aGlzLmp1bXBBdWRpbywgZmFsc2UpO1xyXG4gICAgfSxcclxuXHJcbiAgICBnZXRDZW50ZXJQb3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgY2VudGVyUG9zID0gY2MudjIodGhpcy5ub2RlLngsIHRoaXMubm9kZS55ICsgdGhpcy5ub2RlLmhlaWdodC8yKTtcclxuICAgICAgICByZXR1cm4gY2VudGVyUG9zO1xyXG4gICAgfSxcclxuXHJcbiAgICBzdGFydE1vdmVBdDogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy54U3BlZWQgPSAwO1xyXG4gICAgICAgIHRoaXMubm9kZS5zZXRQb3NpdGlvbihwb3MpO1xyXG5cclxuICAgICAgICB2YXIganVtcEFjdGlvbiA9IHRoaXMucnVuSnVtcEFjdGlvbigpO1xyXG4gICAgICAgIGNjLnR3ZWVuKHRoaXMubm9kZSkudGhlbihqdW1wQWN0aW9uKS5zdGFydCgpXHJcbiAgICB9LFxyXG5cclxuICAgIHN0b3BNb3ZlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5ub2RlLnN0b3BBbGxBY3Rpb25zKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8vIGNhbGxlZCBldmVyeSBmcmFtZVxyXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoZHQpIHtcclxuICAgICAgICAvLyDmoLnmja7lvZPliY3liqDpgJ/luqbmlrnlkJHmr4/luKfmm7TmlrDpgJ/luqZcclxuICAgICAgICBpZiAodGhpcy5hY2NMZWZ0KSB7XHJcbiAgICAgICAgICAgIHRoaXMueFNwZWVkIC09IHRoaXMuYWNjZWwgKiBkdDtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYWNjUmlnaHQpIHtcclxuICAgICAgICAgICAgdGhpcy54U3BlZWQgKz0gdGhpcy5hY2NlbCAqIGR0O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDpmZDliLbkuLvop5LnmoTpgJ/luqbkuI3og73otoXov4fmnIDlpKflgLxcclxuICAgICAgICBpZiAoIE1hdGguYWJzKHRoaXMueFNwZWVkKSA+IHRoaXMubWF4TW92ZVNwZWVkICkge1xyXG4gICAgICAgICAgICAvLyBpZiBzcGVlZCByZWFjaCBsaW1pdCwgdXNlIG1heCBzcGVlZCB3aXRoIGN1cnJlbnQgZGlyZWN0aW9uXHJcbiAgICAgICAgICAgIHRoaXMueFNwZWVkID0gdGhpcy5tYXhNb3ZlU3BlZWQgKiB0aGlzLnhTcGVlZCAvIE1hdGguYWJzKHRoaXMueFNwZWVkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOagueaNruW9k+WJjemAn+W6puabtOaWsOS4u+inkueahOS9jee9rlxyXG4gICAgICAgIHRoaXMubm9kZS54ICs9IHRoaXMueFNwZWVkICogZHQ7XHJcblxyXG4gICAgICAgIC8vIGxpbWl0IHBsYXllciBwb3NpdGlvbiBpbnNpZGUgc2NyZWVuXHJcbiAgICAgICAgaWYgKCB0aGlzLm5vZGUueCA+IHRoaXMubm9kZS5wYXJlbnQud2lkdGgvMikge1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUueCA9IHRoaXMubm9kZS5wYXJlbnQud2lkdGgvMjtcclxuICAgICAgICAgICAgdGhpcy54U3BlZWQgPSAwO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5ub2RlLnggPCAtdGhpcy5ub2RlLnBhcmVudC53aWR0aC8yKSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS54ID0gLXRoaXMubm9kZS5wYXJlbnQud2lkdGgvMjtcclxuICAgICAgICAgICAgdGhpcy54U3BlZWQgPSAwO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=