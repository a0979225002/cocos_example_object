{"version":3,"sources":["assets\\scripts\\Player.js"],"names":["cc","Class","Component","properties","jumpHeight","jumpDuration","squashDuration","maxMoveSpeed","accel","jumpAudio","type","AudioClip","onLoad","enabled","accLeft","accRight","xSpeed","minPosX","node","parent","width","maxPosX","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","touchReceiver","Canvas","instance","onTouchStart","onTouchEnd","onDestroy","off","event","keyCode","macro","KEY","a","left","d","right","touchLoc","getLocation","x","winSize","runJumpAction","jumpUp","tween","by","y","easing","jumpDown","squash","to","scaleX","scaleY","stretch","scaleBack","sequence","call","playJumpSound","repeatForever","audioEngine","playEffect","getCenterPos","centerPos","v2","height","startMoveAt","pos","setPosition","jumpAction","then","start","stopMove","stopAllActions","update","dt","Math","abs"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 主角跳跃高度\r\n        jumpHeight: 0,\r\n        // 主角跳跃持续时间\r\n        jumpDuration: 0,\r\n        // 辅助形变动作时间\r\n        squashDuration: 0,\r\n        // 最大移动速度\r\n        maxMoveSpeed: 0,\r\n        // 加速度\r\n        accel: 0,\r\n        // 跳跃音效资源\r\n        jumpAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.enabled = false;\r\n        // 加速度方向开关\r\n        this.accLeft = false;\r\n        this.accRight = false;\r\n        // 主角当前水平方向速度\r\n        this.xSpeed = 0;\r\n        // screen boundaries\r\n        this.minPosX = -this.node.parent.width/2;\r\n        this.maxPosX = this.node.parent.width/2;\r\n\r\n        // 初始化键盘输入监听\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        \r\n        var touchReceiver = cc.Canvas.instance.node;\r\n        touchReceiver.on('touchstart', this.onTouchStart, this);\r\n        touchReceiver.on('touchend', this.onTouchEnd, this);\r\n    },\r\n\r\n    onDestroy () {\r\n        // 取消键盘输入监听\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        \r\n        var touchReceiver = cc.Canvas.instance.node;\r\n        touchReceiver.off('touchstart', this.onTouchStart, this);\r\n        touchReceiver.off('touchend', this.onTouchEnd, this);\r\n    },\r\n\r\n    onKeyDown (event) {\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = true;\r\n                this.accRight = false;\r\n                break;\r\n            case cc.macro.KEY.d:\r\n            case cc.macro.KEY.right:\r\n                this.accLeft = false;\r\n                this.accRight = true;\r\n                break;\r\n        }\r\n    },\r\n\r\n    onKeyUp (event) {\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = false;\r\n                break;\r\n            case cc.macro.KEY.d:\r\n            case cc.macro.KEY.right:\r\n                this.accRight = false;\r\n                break;\r\n        }\r\n    },\r\n\r\n    onTouchStart (event) {\r\n        var touchLoc = event.getLocation();\r\n        if (touchLoc.x >= cc.winSize.width/2) {\r\n            this.accLeft = false;\r\n            this.accRight = true;\r\n        } else {\r\n            this.accLeft = true;\r\n            this.accRight = false;\r\n        }\r\n    },\r\n\r\n    onTouchEnd (event) {\r\n        this.accLeft = false;\r\n        this.accRight = false;\r\n    },\r\n\r\n    runJumpAction: function () {\r\n        // 跳跃上升\r\n        var jumpUp = cc.tween().by(this.jumpDuration, { y: this.jumpHeight }, { easing: 'sineOut' });\r\n        // 下落\r\n        var jumpDown = cc.tween().by(this.jumpDuration, { y: -this.jumpHeight }, { easing: 'sineIn' });\r\n        // 形变\r\n        var squash = cc.tween().to(this.squashDuration, { scaleX: 1, scaleY: 0.6 });\r\n        var stretch = cc.tween().to(this.squashDuration, { scaleX: 1, scaleY: 1.2 });\r\n        var scaleBack = cc.tween().to(this.squashDuration, { scaleX: 1, scaleY: 1 });\r\n\r\n        // 创建一个缓动\r\n        var tween = cc.tween()\r\n                        // 按顺序执行动作\r\n                        .sequence(squash, stretch, jumpUp, scaleBack, jumpDown)\r\n                        // 添加一个回调函数，在前面的动作都结束时调用我们定义的 playJumpSound() 方法\r\n                        .call(this.playJumpSound, this);\r\n\r\n        // 不断重复\r\n        return cc.tween().repeatForever(tween);\r\n    },\r\n\r\n    playJumpSound: function () {\r\n        // 调用声音引擎播放声音\r\n        cc.audioEngine.playEffect(this.jumpAudio, false);\r\n    },\r\n\r\n    getCenterPos: function () {\r\n        var centerPos = cc.v2(this.node.x, this.node.y + this.node.height/2);\r\n        return centerPos;\r\n    },\r\n\r\n    startMoveAt: function (pos) {\r\n        this.enabled = true;\r\n        this.xSpeed = 0;\r\n        this.node.setPosition(pos);\r\n\r\n        var jumpAction = this.runJumpAction();\r\n        cc.tween(this.node).then(jumpAction).start()\r\n    },\r\n\r\n    stopMove: function () {\r\n        this.node.stopAllActions();\r\n    },\r\n\r\n    // called every frame\r\n    update: function (dt) {\r\n        // 根据当前加速度方向每帧更新速度\r\n        if (this.accLeft) {\r\n            this.xSpeed -= this.accel * dt;\r\n        } else if (this.accRight) {\r\n            this.xSpeed += this.accel * dt;\r\n        }\r\n        // 限制主角的速度不能超过最大值\r\n        if ( Math.abs(this.xSpeed) > this.maxMoveSpeed ) {\r\n            // if speed reach limit, use max speed with current direction\r\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\r\n        }\r\n\r\n        // 根据当前速度更新主角的位置\r\n        this.node.x += this.xSpeed * dt;\r\n\r\n        // limit player position inside screen\r\n        if ( this.node.x > this.node.parent.width/2) {\r\n            this.node.x = this.node.parent.width/2;\r\n            this.xSpeed = 0;\r\n        } else if (this.node.x < -this.node.parent.width/2) {\r\n            this.node.x = -this.node.parent.width/2;\r\n            this.xSpeed = 0;\r\n        }\r\n    },\r\n});\r\n"]}